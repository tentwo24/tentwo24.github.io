<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>React | 拾贰</title><meta name="keywords" content="React"><meta name="author" content="拾贰"><meta name="copyright" content="拾贰"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="React"><meta name="application-name" content="React"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="React"><meta property="og:url" content="http://example.com/2024/12/17/React/index.html"><meta property="og:site_name" content="拾贰"><meta property="og:description" content="起步一、React概述 官网：https:&amp;#x2F;&amp;#x2F;react.docschina.org&amp;#x2F;  1.什么是React？React是由Facebook研发的、用于解决UI复杂度的开源JavaScript库，目前由React联合社区维护。  它不是框架，只是为了解决UI复杂度而诞生的一个库  2.React的"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg"><meta property="article:author" content="拾贰"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg"><meta name="description" content="起步一、React概述 官网：https:&amp;#x2F;&amp;#x2F;react.docschina.org&amp;#x2F;  1.什么是React？React是由Facebook研发的、用于解决UI复杂度的开源JavaScript库，目前由React联合社区维护。  它不是框架，只是为了解决UI复杂度而诞生的一个库  2.React的"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/12/17/React/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 前端开发爱好者","🔍 分享与热心帮助","🔨 设计开发一条龙","🏃 脚踏实地行动派","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 拾贰","link":"链接: ","source":"来源: 拾贰","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '拾贰',
  title: 'React',
  postAI: '',
  pageFillDescription: '起步, 一、React概述, 1.什么是React？, 2.React的特点, 3.对比Vue, 4.学习路径, 二、Hello World, 1.React.createElement, 2.JSX, 三、使用脚手架搭建工程, 四、开发环境搭建, 1.VSCode配置, 2.VSCode插件安装, 3.Chrome插件安装, React核心概念, 一、JSX, 1.什么是JSX, 2.在JSX中嵌入表达式, 3.元素的不可变性, 4.demo图片切换, 二、组件和组件属性, 1.创建一个组件, 2.组件的属性, 三、组件状态, 四、事件, 五、深入认识setState, 六、生命周期, 1.旧版生命周期, 2.新版生命周期, 七、传递元素内容（vue中插槽）, 八、表单, React进阶, 一、属性默认值和类型检查, 1.属性默认值, 2.属性类型检查, 3.Demo, 二、HOC 高阶组件, 三、ref, 四、Ref转发, 五、Context, 1.旧的API, 2.新版API, 3.上下文应用场景, 六、PureComponent, 七、render props, 八、Portals, 九、错误边界, 十、React中的事件, 十一、渲染原理▲, 1.首次渲染(新节点渲染), 2.更新节点, 对比更新, 找到了对比的目标, 没有找到对比的目标, 十二、工具, 1.严格模式, 2.Profiler, HOOK, 一、HOOK简介, 二、State Hook, 三、Effect Hook, 四、自定义Hook, 五、Reducer Hook, 六、Context Hook, 七、Callback Hook, 八、Memo Hook, 九、Ref Hook, 十、ImperativeHandle Hook, 十一、LayoutEffect Hook, 十二、DebugValue Hook, 十三、React动画, Router, 一、概述, 1.站点, 2.React Router, 二、两种模式, 1.Hash Router 哈希路由, 2.Borswer History Router 浏览器历史记录路由, 三、路由组件, 1.Router组件, 2.Route组件, 3.Switch组件, 四、路由信息, 1.history, 2.location, 3.match, 4.非路由组件获取路由信息, 五、其他组件, 1.Link, 2.NavLink, 3.Redirect, 六、常见应用, 七、受保护的页面, 八、实现vue路由模式, 九、导航守卫, 十、常见应用 - 路由切换动画, 十一、滚动条复位, 1.高阶组件, 2.使用useEffect, 3.使用自定义的导航守卫, 十二、阻止跳转, Router源码, Redux, 一、Redux核心概念, 1.MVC, 2.前端需要一个独立的数据解决方案, 二、使用Redux管理数据, 三、Action, 四、Reducer, 五、Store, 六、手写createStores, 七、手写bindActionCreators, 八、手写combineReducers, 九、Redux中间件（Middleware）, 十、手写applyMiddleware, Redux中间件, 一、redux-logger, 二、redux-thunk, 三、手写thunk, 四、redux-promise, 五、迭代器和可迭代协议, 1.迭代, 2.迭代器 iterator, 迭代器创建函数 iterator creator, 3.可迭代协议, 4.for-of循环的原理, 六、生成器 generator, 1.generator, 2.generator function, 七、redux-saga, 1.saga基础, 2.saga指令1, 3.saga指令2, 八、手写saga, 九、redux-actions, 1.createAction(s), createAction, createActions, 2.handleAction(s), handleAction, handleActions, 3.combineActions, 组件、路由和数据, 一、react-redux, 二、手写react-redux, 三、react-redux额外的api, 1.connect, 2.connectAdvanced, 3.createProvider, 四、redux和router的结合（connected-react-router）, 1.connectRouter, 2.routerMiddleware, 3.ConnectedRouter, 4.一些action创建函数, 五、手写connected-react-router, 六、dva, 1.dva的使用, 2.手写dva, 3.dva插件, dva-loading, 七、umi, 1.umi简介, 全局安装umi起步一概述官网什么是是由研发的用于解决复杂度的开源库目前由联合社区维护它不是框架只是为了解决复杂度而诞生的一个库的特点轻量的开发版所有源码包含注释仅多行原生所有的的代码都是用原生书写而成的不依赖其他任何库易扩展对代码的封装程度较低也没有过多的使用魔法所以中的很多功能都可以扩展不依赖宿主环境只依赖原生语言不依赖任何其他东西包括运行环境因此它可以被轻松的移植到浏览器桌面应用移动端渐近式并非框架对整个工程没有强制约束力这对与那些已存在的工程可以逐步的将其改造为而不需要全盘重写单向数据流所有的数据自顶而下的流动用代码声明界面组件化对比对比项全球使用量国内使用量性能易上手灵活度大型企业中小型企业生态学习路径整体原则熟悉深入理解原理基础掌握的基本使用方法有能力制作各种组件并理解其基本运作原理进阶掌握中的一些黑科技提高代码质量相当于相当于本身各种中间件第三方脚手架库相当于的或源码部分源码分析源码分析二直接在页面上使用引用下面的跨域虽然元素本来就可以跨域但是跨域如果报错了不会显示完整的错误信息加上就可以了的核心库与宿主环境无关适用于多端依赖核心库将核心的功能与页面结合创建一个元素创建虚拟一个元素创建一个元素第一个元素渲染到中创建一个元素称作虚拟本质上是一个对象然后交给渲染到页面上参数元素类型如果是字符串一个普通的元素参数元素的属性一个对象后续参数元素的子节点的扩展语法因为标准不支持需要使用进行转义的核心库与宿主环境无关依赖核心库将核心的功能与页面结合编译因为不是标准语法浏览器执行会报错需要让浏览器忽略这部分让执行编译创建一个元素一个元素一个元素这种写法会转化成上面形式创建一个元素第一个元素第一个元素一个元素第一个元素一个元素三使用脚手架搭建工程官方会将补全为下载并运行第三方凡是使用的文件必须导入入口文件包看似没有使用其实它将语法编译成了元素四开发环境搭建配置配置方便书写元素增加代码提示插件安装代码风格检查快速代码编写插件安装开发者工具在谷歌商店下载核心概念一什么是起草的扩展语法本质是一个对象会被编译最终会被转换为每个表达式有且仅有一个根节点因为每次只能创建一个元素空的根节点不会影响页面元素布局是的语法糖可以替换成元素元素每个元素必须结束规范在中嵌入表达式等同在中使用注释使用注释写法将表达式作为内容的一部分不会显示普通对象不可以作为子元素可以放置元素对象如果放置的是一个数组它会遍历这个数组把数组每一个元素作为子元素加进去这是一个元素不会显示以下不会产生任何输出普通对象无法放置元素对象没问题将表达式作为元素属性属性使用小驼峰命名法防止注入攻击自动编码阿斯顿法定发送把文本解析为元素的不可变性虽然元素是一个对象但是该对象中的所有属性不可更改如果确实需要更改元素的属性需要重新创建元素会报错不能修改该对象被冻结了这种方法效率并不低因为它没有删除重建元素只是重新创建对象然后重新渲染创建对象的效率很高会对比两次的对象然后修改不同的地方这就是算法图片切换保存图片路径的数组显示的图片索引计时器根据的值显示某张图片路径必须要导入进来如果直接使用相对路径打包后路径会变化启动计时器每隔一段时间切换图片改变停止计时器二组件和组件属性组件包含内容样式和功能的单元创建一个组件特别注意组件的名称首字母必须大写函数组件现在更建议使用返回一个元素这种写法也可以函数组件目前的数字使用组件生成的仍然是一个元素变化的只是值是靠首字母的大小写来区分是我们自己写的组件还是普通的元素两种调用方法这种一般不用不符合组件结构无法被开发者工具管控常用当成元素使用类组件必须继承必须提供函数用于渲染组件该方法必须返回元素姓名年龄下面是传入的内容类组件的内容数字每调用这个类实际就是创建了一个新对象组件的属性对于函数组件属性会作为一个对象的属性传递给函数的参数父组件子组件函数组件目前的数字对于类组件属性会作为一个对象的属性传递给构造函数的参数父组件传递传递就是传了个对象子组件继承先调用父类的构造函数以上构造函数也可以不写类组件的内容数字注意组件的属性应该使用小驼峰命名法组件无法改变自身的属性也就是子组件不能直接修改父组件传递过来的数据和之前说的元素一样不能修改自身属性也就是元素的不可变性之前学习的元素本质上就是一个组件内置组件中的哲学数据属于谁谁才有权力改动中的数据自顶而下流动中如果传了对象过来子组件修改其中的内容不会报错但是建议不这样做补充父组件给子组件传参的简单写法河南使用子组件并传参把的所有属性传递过去子组件我是来自今年岁三组件状态组件状态组件可以自行维护的数据也就是这些数据属于自己不是传递过来的组件状态仅在类组件中有效注意引入后函数式组件也有组件状态了状态本质上是类组件的一个属性是一个对象状态是必须要初始化的状态初始化在构造函数中初始化计时器用作倒计时初始化状态这样无法重新渲染不能使用这个函数是自己调用的重新设置状态触发自动的重新渲染停止计时器倒计时剩余时间直接在类里面写计时器用作倒计时初始化状态语法目前处于实验阶段可以将它转化为正常语法这样无法重新渲染不能使用这个函数是自己调用的重新设置状态触发自动的重新渲染停止计时器倒计时剩余时间状态的变化不能直接改变状态因为无法监控到状态发生了变化必须使用改变状态中的内容会和进行混合一旦调用了会导致当前组件重新渲染组件中的数据该数据是由组件的使用者传递的数据所有权不属于组件自身因此组件无法改变该数组该数组是由组件自身创建的所有权属于组件自身因此组件有权改变该数据四事件在中组件的事件本质上就是一个属性按照之前对组件的约定由于事件本质上是一个属性因此也需要使用小驼峰命名法点击了两种写法鼠标移入了点击子组件倒计时完成倒计时父组件倒计时是否完成正在倒计时倒计时完成如果没有特殊处理在事件处理函数中指向倒计时是否完成使用函数绑定把原型上面的方法绑定到现在的对象上面涉及原型链如果不清楚回头在看看原型上和对象上面都有使用箭头函数结果是该函数不在原型上而在对象上面只有对象上有原型上没正在倒计时倒计时完成使用函数绑定但是这种写法每次渲染都会产生一个新的函数这样写会报错调用这个函数不是通过该类的对象调用的实际是组件中调用也就是通过调用的所以为了防止出问题就把这个当成了总不能当成组件中的吧写箭头函数可以是因为箭头函数的指向了外层当前对象如果没有特殊处理在事件处理函数中指向使用函数绑定使用箭头函数五深入认识它对状态的改变可能是异步的状态改变后触发该回调运行在后面可以接收第二个参数状态改变完成后再执行还没有重新渲染说明目前状态仍然没有改变如果是同步的就是修改完立即执行函数先输出在输出值如果改变状态的代码处于某个元素的事件中则其是异步的否则是同步如果遇到某个事件中需要同步调用多次需要使用函数的方式得到最新状态上面这种写法无论点多少次结果都只会加因为这是异步的状态更新前都是可以看成参数表示当前的状态该函数的返回结果会混合覆盖掉之前的状态该函数是异步执行所有状态全部更新完成并且重新渲染后执行更新完成可以把看成把这三次调用放到一个队列里面了每次都是把上一次的返回结果传给下个函数的后面分析源码会讲到上面三个执行完后才会重新渲染一次会对异步的进行优化将多次进行合并最佳实践把所有的当作是异步的永远不要信任调用之后的状态如果要使用改变之后的状态需要使用回调函数的第二个参数如果新的状态要根据之前的状态进行运算使用函数的方式改变状态的第一个函数会对异步的进行优化将多次进行合并将多次状态改变完成后再统一对进行改变然后触发为什么要这么做呢因为按照一般情况事件处理最后的事件往往都是元素的事件比如点击事件鼠标移入事件六生命周期生命周期组件从诞生到销毁会经历一系列的过程该过程就叫做生命周期在组件的生命周期中提供了一系列的钩子函数类似于事件可以让开发者在函数中注入代码这些代码会在适当的时候运行生命周期仅存在于类组件中函数组件每次调用都是重新运行函数旧的组件即刻被销毁类组件的生命周期相当于的对象的生命周期旧版生命周期在版本旧版生命周期还能使用同一个组件对象只会创建一次哪怕该组件使用的中的内容发生了改变也不会重新创建不能在第一次挂载到页面之前调用为了避免问题构造函数中严禁使用在计时器中可以调用是因为是异步的调用的时候组件已挂载完成新版已移除正常情况下和构造函数一样它只会运行一次可以使用但是为了避免不允许使用因为在某些特殊情况下该函数可能被调用多次在生命周期一开始的阶段还没挂载完成的时候该生命周期被打断然后重新来一次返回一个虚拟会被挂载到虚拟树中最终渲染到页面的真实中可能不只运行一次只要需要重新渲染就会重新运行严禁使用因为可能会导致无限递归渲染只会执行一次可以使用通常情况下会将网络请求启动计时器等一开始需要的操作书写到该函数中组件进入活跃状态就是已经完成等待组件状态发生改变新版已移除即将接收新的属性值会接收一个参数参数为新的属性对象该函数可能会导致一些所以不推荐使用有些开发者的操作可能是一种反模式不好的做法官方认为某个数据的来源是单一的不能既由属性控制也由状态控制这时这个的值既由父组件传过来的控制也由子组件自己的状态控制数字加指示是否要重新渲染该组件通过返回和来指定一般可以用于性能优化默认情况下会直接返回状态和属性变化都会重新运行该函数另外状态发生改变指的是状态被重新赋值调用重新也会重新运行可以通过来避免重新渲染组件即将被重新渲染往往在该函数中使用操作改变元素用法可以接收两个参数分别为更新前的属性和状态通常在该函数中销毁一些组件依赖的资源比如计时器一个新的组件诞生了组件即将被挂载挂载完成接收到新的属性值是否应该重新渲染组件即将被重新渲染组件已完成重新渲染组件被销毁渲染返回的元素会被挂载到虚拟树中旧版生命周期组件属性状态状态新版生命周期官方认为某个数据的来源必须是单一的通过参数可以获取新的属性和状态该函数是静态的是类本身的函数不是实例上的函数没有该函数的返回值会覆盖掉组件状态该函数几乎是没有什么用真实的构建完成但还未实际渲染到页面中在该函数中通常用于实现一些附加的操作该函数的返回值会作为的第三个参数用不了指向构造函数不改变当前状态用新的对象替换掉之前的状态此时用点击事件直接改变不管用因为改变状态也会触发这个函数是不变的所以不会改变之前的属性和状态七传递元素内容中插槽内置组件如果给自定义组件传递元素内容则会将元素内容作为属性传递过去父组件第组元素内容第组元素内容第组元素内容相当于传了个语法糖子组件组件自身的内容默认值补充可以设置弹性盒子的排列顺序层叠样式表八表单受控组件和非受控组件受控组件组件的使用者有能力完全控制该组件的行为和内容通常情况下受控组件往往没有自身的状态其内容完全收到属性的控制非受控组件组件的使用者没有能力控制该组件的行为和内容组件的行为和内容完全自行控制表单组件默认情况下是非受控组件一旦设置了表单组件的属性则其变为受控组件单选和多选框需要设置表单的简单使用足球篮球电影音乐其他读取表单的值读取表单的属性对进行特殊处理获取所有的爱好多选框也可以在这里调用这样修改后函数只会在组件实例化的时候被调用一次生成的多选框元素数组就会被缓存下来如果后续组件的中与多选框相关的状态比如等发生了改变界面上显示的多选框不会自动更新来反映新的状态因为它使用的是一开始缓存的结果男女北京上海成都获取表单数据简单的封装多选框属性一个数组数组每一项是一个对象对应一个多选框对象具有和属性多选框的值多选框的文本例如足球篮球电影每一个多选框的属性值数组表示当前选中的值当选中项发生改变时的事件一组多选框得到一组多选框进阶一属性默认值和类型检查属性默认值通过一个静态属性告知属性默认值函数式组件函数式组件已经完成了混合在调用函数之前就完成了属性默认值类组件类组件另外的写法已经完成了混合在运行构造函数之前就混合了先混合然后在用传过来属性默认值属性类型检查使用库官方出品只会控制台报错不会影响代码执行对组件使用静态属性告知如何检查属性状态不需要类型检查因为状态是自己管理的任意类型数组类型布尔类型函数类型数字类型对象类型字符串类型符号类型任何可以被渲染的内容字符串数字元素元素元素类型构造函数必须是指定构造函数的实例枚举属性类型必须是数组中的其中一个必须是某一类型组成的数组对象由某一类型的值组成对象属性必须是对象并且满足指定的对象要求对象必须精确匹配传递的数据和用法一样但是不能有额外的属性自定义属性检查如果有错误返回错误对象即可属性简单使用先混合属性再调用相应的函数进行验证属性必须是一个数字类型并且必填必须是一个属性并且必填必须是一个函数可以设置必填阵型保持整齐所有属性都在该对象中必填而且必须是一个可以渲染的内容字符串数字元素和可以因为会认为你什么都没传如果加了就不行了必须是一个元素必须是一个组件类型如果是函数组件就把函数名写进去类组件就把类名写进去也就是分别传入函数和构造函数比如叫做子组件接收到可以使用不能这样用因为语法不支持必须是的实例男女属性必须是数组当中的一个数组的每一项必须满足类型要求每一个属性必须满足类型要求属性必须满足该对象的要求必须是一个字符串必填必须是一个数字所有属性属性名组件名必填该属性必须是一个数字不支持直接调用这些函数并且取值范围是组件加类型约束一组多选框默认属性值得到一组多选框二高阶组件高阶函数以函数作为参数并返回一个函数高阶组件以组件作为参数并返回一个组件一般创建文件夹组件名称一般是开头通常可以利用实现横切关注点举例个组件每个组件在创建组件和销毁组件时需要作日志记录个组件它们需要显示一些内容得到的数据结构完全一致简单来说就是把一些组件的公共代码给抽离出去进行二次封装高阶组件组件日志组件被创建了日志组件被销毁了这样是为了让组件接收到属性这样是为了让组件接收到属性不要写在这里更改状态让重新运行点击注意不要在中使用高阶组件因为类组件会把类组件中的对象重用如果写在函数中每次调用都会创建一个新的类尽管这个类和以前完全一样但是它仍然需要重新创建对象也就是重新创建一个组件从而导致之前的组件被销毁不要在高阶组件内部更改传入的组件之用改造组件这里没看懂可以回去看视频暗含装饰器模式抽象思维写组件的时候不要直接想着咋抽象要慢慢来先完成再慢慢抽离实现根据数据渲染出的一组表单组件一组多选框三引用场景希望直接使用元素中的某个方法或者希望直接使用自定义组件中的某个方法和差不多在类组件中直接打印中会有一个属性里面会有绑定属性的组件相应的实例虽然写法有点像属性传递但是并不是一个属性子组件接收不到作用于内置的组件得到的将是真实的对象作用于类组件得到的将是类的实例不能作用于函数组件因为这样没有意义函数里面又没有实例方法调用了组件的方法组件组件调用对象实例里面的方法会报错因为没有意义聚焦不再推荐使用字符串赋值字符串赋值的方式将来可能会被移出目前推荐使用对象或者是函数对象通过函数创建一般是在构造函数里面直接创建好避免每次都会重新创建放在了当前对象的属性里面里面的属性就是相应的实例一开始为会在组件第一次渲染的时候赋值并且这时为这样写也可以但是这样写会涉及效率问题后面会说也可以直接写在这里聚焦函数函数的调用时间的时候会调用该函数在事件中可以使用如果的值发生了变动旧的函数被新的函数替代分别调用旧的函数以及新的函数时间点出现在之前旧的函数被调用时传递新的函数被调用时传递对象为了防止这种现象的发生应该不能使用箭头函数就像这样每次都会创建一个新的函数应该写成对象的实例方法这样每次给的都是同一个函数如果所在的组件被卸载会调用函数不用使用了函数被调用了显示隐藏谨慎使用能够使用属性和状态进行控制就不要使用它与理念不符合有点反模式调用真实的对象中的方法某个时候需要调用类组件的方法补充制作轮播图组件百度网盘视频播放有时候直接操作比重新渲染效率要高因为重新后重新会经过算法还有一系列生命周期等四转发引出转发在这里我们是想获取组件的组件实例但是组件是函数式组件无意义我们此时想获取组件中的标签的实例就需要使用转发组件实现方法没绑定的时候组件传递函数组件得到一个新组件和组件的使用方法一样相当于一个高阶组件什么都没得到因为还没确定转发给谁没绑定的时候等于把给组件来处理了它决定来绑定谁绑定的时候等于把传了进去方法参数传递的是函数组件不能是类组件并且函数组件需要有第二个参数来得到返回值返回一个新的组件类组件的转发组件这样写是为了优化一下看着舒服点组件可以直接传想要实现转发必须通过处理被处理过的组件它会对传递的属性做特殊处理也可以当属性直接传过去因为本质就是个对象处理高阶组件的一些问题在高阶组件里不进行处理的时候打印出来的是高阶组件的组件实例处理高阶组件高阶组件组件日志组件被创建了日志组件被销毁了正常的属性代表要转发的剩下的属性五上下文表示做某一些事情的环境上下文的主要作用是用来进行数据传递的比如说我们可以看到组件嵌套的比较多如果想要在组件中使用组件中的数据就要进行多层的属性传递此时我们可以使用上下文来解决在组件创建上下文让组件使用其中的数据注意不只有根组件才能创建上下文也就是不只是组件才能创建上下文组件等也可以中的上下文特点当某个组件创建了上下文后上下文中的数据会被所有后代组件共享如果某个组件依赖了上下文会导致该组件不再纯粹外部数据仅来源于属性所以上下文要谨慎使用一般情况下用于第三方组件通用组件旧的之前创建上下文只有类组件才可以创建上下文因为之前函数式组件没有状态就无法管理数据一般上下文的数据源来自组件自身状态给类组件书写静态属性使用该属性对上下文中的数据类型进行约束必须要做不是可选的添加实例方法该方法返回的对象即为上下文中的数据该数据必须满足类型约束该方法会在每次之后运行使用上下文中的数据要求如果要使用上下文中的数据组件必须有一个静态属性该属性描述了需要获取的上下文中的数据类型可以在组件的构造函数中通过第二个参数获取上下文数据从组件的属性中获取在函数组件中通过第二个参数获取上下文数据上下文的数据变化上下文中的数据不可以直接变化最终都是通过状态改变在上下文中加入一个处理函数可以用于后代组件更改上下文的数据在函数组件中通过第二个参数获取上下文数据声明需要使用哪些上下文中的数据声明需要使用哪些上下文中的数据这样设计是防止和传过来的数据混淆还可以知道使用了哪些上下文的数据如果这里不声明是取不到上下文给到的相应数据的将参数的上下文交给父类处理这里的构造函数可写可不写会自行处理运行的可以获取到上下文数据不在这里使用上下文数据是因为构造函数只会运行一次如果数据改变不会随之改变来自于上下文的数据子组件的按钮根组件创建上下文约束上下文中数据的类型得到上下文中的数据返回的数据类型需和约束的数据类型相同该方法会自行调用在生命周期调用一次之后会在每次之后运行保证拿到最新数据获取新的上下文在上下文中加入一个处理函数可以用于后代组件更改上下文的数据这里要用箭头函数不然指向有问题自身使用另外这个函数一般返回的是中的数据也可以直接用中的数据加新版补充上面有些遗漏的内容还是拿这个组件嵌套结构来讲如果组件创建了一个上下文并提供了相应数据而组件也创建了上下文提供了相同的数据这时如果想要取上下文中的数据会像作用域链一样就近来取如果取上下文中的数据会取到的而不是自己的另外还有函数的调用问题可以具体看下面的例子此时也有创建的上下文这个时候它获取上下文中的数据时获取的是父组件的上下文声明需要使用哪些上下文中的数据声明下不然接收不到此时取的是的上下文数据有点像的作用域链就近查找来自于上下文的数据这里会有一个问题这里的取的是中的数据用它修改了组件的状态有时候会出面试题子组件的按钮约束上下文中数据的类型得到上下文中的数据获取新的上下文加旧版存在严重的效率问题并且容易导致滥用创建上下文上下文是一个独立于组件的对象该对象通过默认值创建默认值指上下文中的默认数据返回的是一个包含两个属性的对象属性生产者一个组件该组件会创建一个上下文该组件有一个属性通过该属性可以为其数据赋值同一个不要用到多个组件中如果需要在其他组件中使用该数据应该考虑将数据提升到更高的层次属性消费者从生产者那里拿数据后续讲解还是这个例子我们用创建上下文结构可以看成这样例子中的结构是注意同一种数据内容的上下文最好不要重复创建把需要用到的数据直接提到外层即可比如组件中的两个组件的子组件都要使用同一份数据不要在和中都创建上下文提供同一份数据只需要在中创建上下文使用上下文中的数据在类组件中直接使用获取上下文数据要求必须拥有静态属性应赋值为创建的上下文对象函数式组件不需要已经明确了使用哪个上下文了在函数组件中需要使用来获取上下文数据类组件中也可以这样用这种写法比较好结构清晰是一个组件它的子节点是一个函数它的需要传递一个函数它会把上下文数据当成一个参数传给这个函数创建上下文对象如果把子组件拆出来在其他模块使用直接把导出子组件引入使用七插槽里学过写在这里就是传递了一个属性是一个语法糖类组件也可以中这种方式获取把静态属性赋值为上下文对象来自于上下文的数据后代组件的按钮点击父组件的按钮加注意细节如果上下文提供者中的属性发生变化用比较前后的会导致该上下文提供的所有后代元素全部重新渲染无论该子元素是否有优化无论函数返回什么结果可以看看下面的代码来进行优化运行了优化本来可以避免重新渲染的但是在这里不受影响上下文内容发生变化这个函数不会运行会重新渲染后面会学到叫强制更新优化前优化后不直接传因为每次都会变成一个新对象而的地址并不会改变不变哪怕中的数据比起现有没有改变也会触发强制更新因为每次的时候都会得到一个全新的对象那应该怎么进行性能优化呢可以看下上面解释父组件的按钮加上下文嵌套使用可以看出来结构比较清晰不同于旧的的就近原则组件和组件分别提供数据给使用来自于上下文的数据后代组件的按钮点击来自于的数据父组件的按钮加上下文应用场景上下文的应用场景编写一套组件有多个组件这些组件之间需要相互配合才能最终完成功能比如我们要开发一套表单组件使用方式如下由组件提供上下文然后经过多层给组件用获取表单中的所有数据对象账号密码提交简单封装一套组件地址进阶表单组件组合拾贰码云开源中国进阶表单组件组合这里不再写出完整代码具体查看上述地址这里把做了简单封装表单数据对象修改中的数据账号密码提交六纯组件用于避免不必要的渲染运行函数从而提升效率优化如果一个组件的属性和状态都没有发生变化重新渲染组件是没有必要的比如说有一个组件树组件是组件的子组件和是组件的子组件是组件的子组件只要组件进行了就会触发重新渲染哪怕是重新渲染之前会运行因为它默认返回所以就会重新渲染因为组件进行了重新渲染组件的子组件都会运行然后默认重新渲染优化点没有必要重新渲染的话在适当的时候让返回一个如果组件返回就不会重新渲染它的子组件就不会重新渲染补充是在函数运行后再运行的详情看生命周期所以正常来说如果在中进行了会再次运行函数也就是再次重新渲染举个栗子这里口头表述了没看到代码在哪里也不想自己敲就是有一个组件里面有一个状态包含任务信息并且一开始会发送请求获取信息然后该组件中有两个子组件一个一个接收一个方法用来添加任务接收用来渲染组件组件用来渲染单个任务这时有两个点需要优化因为在组件内组件添加文章时需要重新渲染从而导致组件也重新渲染但是并不需要重新渲染添加文章后也会重新渲染但是如果添加之前有条添加后条前条是不变的并不需要重新渲染是一个组件如果某个组件继承自该组件则该组件的会进行优化对属性和状态进行浅比较如果相等则不会重新渲染问题的解决浅比较在组件中加上下面这段代码会发现每添加一次组件中的函数只会运行一次因为其他之前的数据都没变这就是的原理该函数的运行次数取决于之前有多少条数据通过对比决定是否更新之前条数据就会运行次效果和上面处理完的一样继承就不用写上面的优化代码了相当于该函数的运行次数取决于之前有多少条数据通过对比决定是否更新之前条数据就会运行次把类组件继承改成就可以解决上面的两个问题了另外这里有个很重要的点之前就说过这里再重复一遍父组件传给子组件的函数尽量先定义好再传不要直接写个箭头函数进去不然每次等于传了个新的函数虽然长的一样但是地址并不一样依然会使得子组件重新渲染注意进行浅比较为了效率应该尽量使用深比较效率更低要求不要改动之前的状态永远是创建新的状态来覆盖之前的状态不可变对象有一个第三方库它专门用于制作不可变对象的原因如果继承的是执行函数后数据并不会增加因为这里没有新的数组产生给的还是之前的那个数组地址浅比较比较不出来产生新数组的方法函数组件使用函数制作纯组件其实是一个高阶组件七有时候某些组件的各种功能及其处理逻辑几乎完全相同只是显示的界面不一样建议下面的方式认选其一来解决重复代码的问题横切关注点一般用于渲染不一样某个组件需要某个属性该属性是一个函数函数的返回值用于渲染函数的参数会传递为需要的数据注意纯组件的属性尽量避免每次传递的的地址不一致通常该属性的名字叫做并没有强制要求该组件用于监听鼠标的变化把函数提出来不直接写箭头函数是为了纯组件的使用更新和的值默认值把需要的参数传递过去把函数提出来不直接写箭头函数是为了纯组件的使用横坐标纵坐标更牛扩展性更强更新和的值横坐标纵坐标八插槽将一个元素渲染到指定的容器中元素真实的容器该函数返回一个元素下面的例子中如果不加他会按照元素结构正常渲染加过之后就会将返回的内容渲染到这个元素里但是从调试工具上来看元素结构还是不变的说明虚拟的结构和真实结构是可以有差异的被点击了尽管在真实的中不在中但是点击仍然会冒泡触发事件说明事件冒泡是根据虚拟树来冒泡的与真实的树无关注意事件冒泡中的事件是包装过的看上去和真实的一样其实是有区别的比如有的事件参数不同它的事件冒泡是根据虚拟树来冒泡的与真实的树无关九错误边界默认情况下若一个组件在渲染期间发生错误会导致整个组件树全部被卸载无法渲染某一项这个地方会报错的原型上没有自己处理不了然后抛出错误给它的父组件处理它的父组件处理不了就会继续往上最后组件树卸载注意这个报错只会在开发的时候在页面报错生产环境直接白屏错误边界是一个组件该组件会捕获到渲染期间子组件发生的错误并有能力阻止错误继续传播让某个组件捕获错误编写生命周期函数版本后出现的中文文档静态函数运行时间点渲染子组件的过程中发生错误之后在更新页面之前注意只有子组件发生错误才会运行该函数自己发生错误不会运行该函数返回一个对象会将该对象的属性覆盖掉当前组件的类似于参数错误对象通常该函数用于改变状态编写生命周期函数实例方法运行时间点渲染子组件的过程中发生错误更新页面之后也就是组件树卸载后由于其运行时间点比较靠后因此不太会在该函数中改变状态通常该函数用于记录错误消息发生错误了记录错误信息捕获不到出现错误了用法细节某些错误错误边界组件无法捕获自身的错误异步的错误事件中的错误比如点击事件报错总结仅处理渲染子组件期间的同步错误十中的事件如果开发的是纯粹应用根本用不到如果和第三方基于原生插件混用需要注意一下因为事件和原生事件可能有些不一样这里讲的不深这里的事件内置的组件中的事件如按钮的当时设计的时候如果给每个真实的元素去写事件的话那页面中会充斥各种事件会影响执行效率给注册事件几乎所有的元素的事件处理均在的事件中处理不冒泡一些不冒泡的事件是直接在元素上监听一些上面没有的事件直接在元素上监听在的事件处理会根据虚拟树的完成事件函数的调用虚拟结构给三个子组件都绑定点击事件它是怎么进行事件冒泡的呢真实的结构事件监听全在上不会监听三个子组件生成的事件当中发生一个事件的时候它会去虚拟树上面去找上有一个队列从上的事件从下往上调用按钮被点击了如果给外面再包一层并绑定一个点击事件点击并不会触发上的点击事件阻止事件在虚拟树中冒泡按钮真实的事件为的元素被点击了点击如果是正常的执行顺序是先输出按钮被点击了然后事件冒泡再输出元素被点击了但是点击之后发现恰恰相反因为按钮事件的调用要等到冒泡到的时候才调用也就是冒泡到最外层元素才会调用所以先运行如果在这里阻止冒泡按钮的点击事件就不会运行了因为到那里就结束了的事件参数并非真实的事件参数是合成的一个对象该对象类似于真实的事件参数阻止事件在虚拟树中冒泡可以得到真实的事件对象为了提高执行效率使用事件对象池来处理事件对象事件参数被重用了被点击了文本获得了焦点按钮被点击了持久化后可以重用会报错不能重用因为为了节约内存空间第一次用完后中的属性都会设为上面的写法无法阻止真实事件冒泡因为触发该事件时都冒泡到上了虚拟的也阻止不了因为是真实的事件对象一般遇不到我也不太理解如果为就是阻止了事件冒泡后面不再进行按钮阻止事件冒泡这个不会运行因为事件根本不冒泡事件仍然会运行注意事项如果给真实的注册事件阻止了事件冒泡则会导致的相应事件无法触发如果给真实的注册事件事件会先于事件运行通过的事件中阻止事件冒泡无法阻止真实的事件冒泡可以通过阻止上剩余事件的执行在事件处理程序中不要异步的使用事件对象如果一定要使用需要调用函数十一渲染原理复杂官网讲的不多资料也少官网主要说的是算法是渲染原理的一个步骤听不懂就再看看视频渲染生成用于显示的对象以及将这些对象形成真实的对象元素通过创建语法糖例如标题节点专门用于渲染到界面的对象会通过元素创建节点一定是通过节点来进行渲染的但是节点不一定来自于元素比如文本节点空节点数组节点注普通对象不能创建文本节点节点类型节点创建该节点的元素类型是一个字符串组件节点创建该节点的元素类型是一个函数或是一个类类组件或函数组件文本节点由字符串数字创建的空节点由数组节点该节点由一个数组创建真实通过创建的元素首次渲染新节点渲染通过参数的值创建节点参数参数不能为普通对象普通对象不能渲染根据不同的节点做不同的事情文本节点通过创建真实的文本节点空节点什么都不做但是该节点对象是存在的数组节点遍历数组将数组每一项递归创建节点回到第步通过参数的值创建节点进行反复操作直到遍历结束节点通过创建真实的对象然后立即设置该真实元素的各种属性然后遍历对应元素的属性递归操作回到第步进行反复操作直到遍历结束注意元素创建完真实的对象后都会将该真实加入到父元素的真实对象中第一个根节点要最后才加入到容器中组件节点函数组件调用函数该函数必须返回一个可以生成节点的内容将该函数的返回结果递归生成节点回到第步进行反复操作直到遍历结束类组件创建该类的实例立即调用对象的生命周期方法运行该对象的方法拿到节点对象将该节点递归操作回到第步进行反复操作第三步完成后将该组件的加入到执行队列先进先出先进先执行当整个虚拟树全部构建完毕并且将真实的对象加入到容器中后执行该队列注意在这个队列中子组件的先执行之后才是父组件执行因为我们看执行步骤可以知道要等到第步完成后才会执行第四步当子组件执行完第四步的时候父组件还处于第三步呢如果是两个并列的组件节点就是先执行上面的再执行下面的因为是遍历来的先是第一个再是第二个生成出虚拟树之后将该树保存起来以便后续使用将之前生成的真实的对象加入到容器中标题段落以上代码生成的虚拟树以上代码生成的虚拟树以上代码生成的虚拟树更新节点更新的场景重新调用触发根节点更新在类组件的实例对象中调用会导致该实例所在的节点更新子组件实例更新不会导致父组件更新此时体现了单项数据流的好处提高了效率节点的更新如果调用的是进入根节点的对比更新如果调用的是下面的是调用的组件节点执行的也就是运行生命周期函数运行如果该函数返回终止当前流程运行得到一个新的节点组件节点只有一个子节点进入该新的节点的对比更新将生命周期函数加入执行队列以待将来执行将生命周期函数加入执行队列以待将来执行后续步骤上面的两种后续步骤都是这样更新虚拟树完成真实的更新依次调用执行队列中的依次调用执行队列中的依次调用执行队列中的对比更新将新产生的节点也就是从组件节点返回的节点开始不包含组件节点对比之前虚拟中的节点发现差异完成更新问题对比之前树中哪个节点为了提高对比效率做出以下假设假设节点不会出现层次的移动对比时直接找到旧树中对应位置的节点进行对比不同的节点类型会生成不同的结构比如说相同的节点类型节点本身类型相同之前是文本节点现在还是如果是由元素生成值还必须一致类型相同其他的都属于不相同的节点类型多个兄弟通过唯一标识来确定对比的新节点值的作用用于通过旧节点寻找对应的新节点如果某个旧节点有值则其更新时会寻找相同层级中的相同值的节点进行对比没有会去找同一层次同一位置的节点值应该在一个范围内唯一兄弟节点中并且应该保持稳定如果元素结构相同节点就不会更新比如两个表单登录和注册结构相同通过按钮切换两个表单发现切换后账号和密码输入框中的值都没有清空就是因为元素结构相同节点没有更新此时可以给两个表单中的输入框分别加上不同的就可以解决没有找到相同的就会进入没有找到对比目标执行相应逻辑注意在同一层次是不能重复的不同层次可以重复因为对比是对比的同一层次的数组节点用渲染的时候需要添加就是这个原因如果不加如果数组发生了某种变化的时候除外可能整个数组节点生成的真实都要卸载重建严重影响效率找到了对比的目标判断节点类型是否一致一致根据不同的节点类型做不同的事情空节点不做任何事情节点直接重用之前的真实对象将其属性的变化记录下来一定会做以待将来统一完成更新现在不会真正的变化变化发生在后续步骤遍历该新的元素返回的元素的子元素递归对比更新文本节点直接重用之前的真实对象将新的文本变化记录下来将来统一完成更新组件节点函数组件重新调用函数得到一个节点对象进入递归对比更新类组件重用之前的实例调用生命周期方法调用生命周期方法若该方法返回终止运行得到新的节点对象进入递归对比更新将该对象的加入队列将该对象的加入队列数组节点遍历数组进行递归对比更新不一致整体上卸载旧的节点全新创建新的节点只要层级节点不一致就会当作不一致来执行下面步骤比如说并不会重用会重用因为节点类型一样所以如果页面局部变化尽量保持节点类型和节点结构不变或者通过给同一层次加上解决创建新节点先进入新节点的挂载流程新节点首次渲染卸载旧节点后文本节点节点数组节点空节点函数组件节点直接放弃该节点如果节点有子节点递归卸载节点类组件节点直接放弃该节点调用该节点的函数递归卸载子节点没有找到对比的目标新的树中有节点被删除新的树中有节点添加创建新加入的节点卸载多余的旧节点十二工具严格模式本质是一个组件该组件不进行渲染像它的作用是在渲染内部组件时发现不合适的代码例如识别不安全的生命周期关于使用过时字符串的警告关于使用废弃的方法的警告检测意外的副作用要求副作用代码仅出现在以下生命周期函数中副作用一个函数中做了一些会影响函数外部数据的事情例如异步处理改变参数值可能是异步的本地存储改变函数外部的变量相反的如果一个函数没有副作用则可以认为该函数是一个纯函数在严格模式下虽然不能监控到具体的副作用代码但它会将不能具有副作用的函数调用两遍以便发现问题这种情况仅在开发模式下有效检测过时的用法如下性能分析工具在开发者工具里用的分析某一次或多次提交更新涉及到的组件的渲染时间火焰图得到某一次提交每个组件总的渲染时间以及自身的渲染时间排序图得到某一次提交每个组件自身渲染时间的排序组件图某一个组件在多次提交中自身渲染花费的时间一简介是之后出现组件无状态组件函数组件类组件类组件中的麻烦指向问题繁琐的生命周期其他问题专门用于增强函数组件的功能在类组件中是不能使用的使之理论上可以成为类组件的替代品官方强调没有必要更改已经完成的类组件官方目前没有计划取消类组件只是鼓励使用函数组件钩子本质上是一个函数命名上总是以开头该函数可以挂载任何功能种类其他二是一个在函数组件中使用的函数用于在函数组件中使用状态函数有一个参数这个参数的值表示状态的默认值函数的返回值是一个数组该数组一定包含两项建议用解构的方式来写第一项当前状态的值第二项改变状态的函数一个函数组件中可以有多个状态这种做法非常有利于横向切分关注点注意的细节最好写到函数的起始位置便于阅读严禁出现在代码块判断循环中可能会影响状态表格某项的位置返回的函数数组的第二项引用不变节约内存空间使用函数改变数据若数据和之前的数据完全相等使用比较不会导致重新渲染以达到优化效率的目的使用函数改变数据传入的值不会和原来的数据进行合并而是直接替换如果要实现强制刷新组件类组件使用函数函数组件使用一个空对象的不会运行强制重新渲染强制刷新强制刷新如果某些状态之间没有必然的联系应该分化为不同的状态而不要合并成一个对象和类组件的状态一样函数组件中改变状态可能是异步的在事件中多个状态变化会合并以提高效率此时不能信任之前的状态而应该使用回调函数的方式改变状态如果状态变化要使用到之前的状态尽量传递函数使用一个状态该状态的默认值是传入的函数在事件完成之后统一运行不会立即改变事件运行完成之后一起改变此时的值仍然是传入的函数在事件完成之后统一运行原理函数式组件只要状态值发生改变就会重新渲染每次重新渲染都会重新调用函数重新调用函数时按道理来说也会重新运行应该被再赋予初始值为什么会看到状态的改变呢这就涉及的原理了当运行一个函数组件时调用该函数会生成一个组件节点该节点会持有一个引用因为这个函数组件是通过创建的元素所以它会持有一个元素对象该元素对象中有该函数的引用比如组件函数所以我们可以通过该元素节点找到元素对象然后找到函数引用函数组件在渲染的时候直接运行该函数即可运行该函数时它会做这些事情另外如果有两个组件它们的状态并不会共享这是因为状态表格是附着在节点上的两个是两个节点但是它们的函数引用是同一个三用于在函数组件中处理副作用副作用请求计时器其他异步操作更改真实对象本地存储其他会对外部产生影响的操作函数该函数接收一个函数作为参数接收的函数就是需要进行副作用操作的函数细节副作用函数的运行时间点是在页面完成真实的渲染之后组件销毁不会运行因此它的执行是异步的并且不会阻塞浏览器与类组件中和的区别和更改了真实但是用户还没有看到更新同步的中的副作用函数更改了真实并且用户已经看到了更新异步的每个函数组件中可以多次使用但不要放入判断或循环等代码块中原因同中的副作用函数可以有返回值返回值必须是一个函数该函数叫做清理函数该函数运行时间点在每次运行副作用函数之前首次渲染组件不会运行组件被销毁时一定会运行函数可以传递第二个参数第二个参数是一个数组数组中记录该副作用的依赖数据当组件重新渲染后只有依赖数据与上一次不一样的时才会执行副作用所以当传递了依赖数据之后如果数据没有发生变化如果你想实现下面两点可以只传一个空数组副作用函数仅在第一次渲染后运行清理函数仅在卸载组件后运行副作用函数中如果使用了函数上下文中的变量则由于闭包的影响会导致副作用函数中变量不会实时变化首次渲染点击次会依次打印使用的是外部作用域的值每次点击会重新调用函数因为闭包的存在打印的还是之前的变量指向当前函数调用时的副作用函数在每次注册时会覆盖掉之前的副作用函数因此尽量保持副作用函数稳定否则控制起来会比较复杂副作用函数清理函数副作用函数清理函数不稳定强制刷新四自定义自定义将一些常用的跨越多个组件的功能抽离出去形成一个函数该函数就是自定义自定义由于其内部需要使用功能所以它本身也需要按照的规则实现函数名必须以开头调用自定义函数时应该放到顶层例如很多组件都需要在第一次加载完成后获取所有学生数据很多组件都需要在第一次加载完成后启动一个计时器然后在组件销毁时卸载使用的时候如果没有严格按照的规则进行的一个插件会报出警告使用高阶组件也可以实现代码抽离效果但是比起自定义比较繁琐且会让组件层次变深而且如果有多个层次的代码需要抽离就要定义多个高阶组件不如自定义方便简洁能完成更细粒度的封装也可以实现具体可以回看前面的当组件首次加载完成后获取所有学生数据根据页码和页容量获取学生数据得到一个响应结果并且当页码和页容量变化时将重新获取学生数据用法就等于把上述代码放到一个函数里执行了五出品的一个数据流框架规定了数据是单向流动的数据存储在数据仓库中目前可以认为就是一个存储数据的仓库是改变数据的唯一原因本质上就是一个对象有两个属性字符串动作的类型任意类型动作发生后的附加信息例如如果是添加一个学生可以描述为学生对象的各种信息例如如果要删除一个学生可以描述为学生具体改变数据的是一个函数该函数叫做该函数接收两个参数表示当前数据仓库中的数据描述了如何去改变数据以及改变数据的一些附加信息该函数必须有一个返回结果用于表示数据仓库变化之后的数据要求对象是不可变的如果返回对象必须创建新的对象必须是纯函数不能有任何副作用如果要触发不可以直接调用而是应该调用一个辅助函数该函数仅接收一个参数该函数会间接去调用以达到改变数据的目的一个简单的数据流该函数根据当前的数据已经生成一个新的数据在这里只改变数据与组件无关纯净通用的函数官方提供相同的方法函数标准格式初始状态用于计算初始值的函数该函数的返回值会作为初始值第二个参数会当作参数传入到该函数中日志的值将下面两段代码抽离成通用的函数作用同上六用于获取上下文数据比起过去的方法可以减少组件嵌套上下文的值上下文的值七函数名用于得到一个固定引用值的函数通常用它进行性能优化该函数有两个参数函数会固定该函数的引用只要依赖项没有发生变化则始终返回之前函数的地址数组记录依赖项该函数返回引用相对固定的函数地址改变文本这样写的话每次调用同样会生成一个新的函数地址函数的地址每次渲染都发生了变化导致了子组件跟着重新渲染若子组件是经过优化的组件则可能导致优化失效这样写组件和组件都不会重新渲染因为的值没变不会重新渲染从而也就不会重新渲染这样写组件和组件都会重新渲染改变了组件重新渲染理所当然但是没变为什么组件也会重新渲染呢这里的前提是组件传入的是一个箭头函数因为每次调用都会生成一个新的箭头函数地址改变了八用于保持一些比较稳定的数据通常用于性能优化如果元素本身的引用没有发生变化一定不会重新渲染一般用于固定函数引用可以用于固定任何值为什么要做这些事情呢因为相比于类组件每次只运行一次构造函数之后都是调用生命周期和方法而函数组件每次都会调用这个函数有些东西需要在多次调用函数的时候保持统一不管是为了效率或是其他仔细看与那个函数的区别固定的是传递的函数的地址而是传递的函数的返回值的地址举例使用只要不变就不会重新计算补充数组和上次是一样的不像之前都是用得到一个新数组元素是通过创建的数组也是通过这种方式创建的生成一个数组节点数组没变化数组里面的元素也不会变化如果这个元素本身没有发生变化一定不会重新渲染甚至连对比更新都不会进行如果改了会重新运行函数从而这段代码也会重新运行严重影响效率九函数一个参数默认值返回一个固定的对象值直接写在这里如果创建了两个组件实例它们会使用同一个对象我们会发现每次重新运行函数都会创建一个对象这些对象都不相同然后添加到数组中没必要每次都重新创建一个新的这种写法不会有上述问题都是同一个对象得到的值补充案例可以用给每个节点一个固定的对象计时器案例之前是写在这里的但是会有一个问题如果使用多次其中一个组件卸载就会导致其他组件的被卸载每一个节点用一个十函数类组件中直接在父组件中调用子组件内部的方法点击调用组件的方法转发后会把传递到包装的那个组件上去然后自行处理即可第一个参数是传一个第二个参数是给赋一个初值如果不给依赖项则每次运行函数组件都会调用该方法如果使用了依赖项则第一次调用后会进行缓存只有依赖项发生变化时才会重新调用函数相当于给下面返回的对象回忆一下高阶组件包装函数组件实现转发点击调用组件的方法十一浏览器渲染完成后用户看到新的渲染结果之后完成了改动但还没有呈现给用户它们两个除了时间点不一样其他没区别应该尽量使用因为它不会导致渲染阻塞如果出现了问题再考虑使用补充如果对进行了改动同步它不会立即渲染而是要等到浏览器下一次渲染时间点到达然后对比差异进行渲染异步用户看到效果如果要操纵尽量在进行操作但是会阻塞渲染十二用于将自定义的关联数据显示到调试栏如果创建的自定义通用性比较高可以选择使用方便调试学生集合十三动画这里先跳过回头补充一概述路由站点无论是使用还是开发的单页应用程序可能只是该站点的一部分某一个功能块一个单页应用里可能会划分为多个页面几乎完全不同的页面效果组件如果要在单页应用中完成组件的切换需要实现下面两个功能根据不同的页面地址展示不同的组件核心完成无刷新的地址切换我们把实现了以上两个功能的插件称之为路由路由核心库包含诸多和路由功能相关的核心代码利用路由核心库结合实际的页面实现跟页面路由密切相关的功能如果是在页面中实现路由需要安装库该库依赖二两种模式路由根据不同的页面地址展示不同的组件地址组成例协议名主机名地址预设值域名局域网中电脑名称端口号如果协议是端口号是则可以省略端口号如果协议是端口号是则可以省略端口号路径地址参数附带的数据格式属性名属性值属性名属性值哈希锚点附带的数据哈希路由根据地址中的哈希值来确定显示的组件原因的变化不会导致页面刷新这种模式的兼容性最好浏览器获取的方式浏览器历史记录路由出现后新增了从此以后浏览器拥有了改变路径而不刷新页面的方式表示浏览器的历史记录它使用栈的方式存储历史记录是和窗口标签页绑定的每个窗口不相通获取栈中数据量向当前历史记录栈中加入一条新的记录参数附加的数据自定义的数据可以是任何类型参数页面标题目前大部分浏览器不支持参数新的地址将当前指针指向的历史记录替换为某个记录参数附加的数据自定义的数据可以是任何类型参数页面标题目前大部分浏览器不支持参数新的地址根据页面的路径决定渲染哪个组件三路由组件为我们提供了两个重要组件组件它本身不做任何展示仅提供路由模式配置另外该组件会产生一个上下文上下文中会提供一些实用的对象和方法供其他相关组件使用该组件使用模式匹配该组件使用模式匹配通常情况下组件只有一个将该组件包裹整个页面组件根据不同的地址展示不同的组件重要属性匹配的路径默认情况下不区分大小写可以设置属性为来区分大小写默认情况下只匹配初始目录如果要精确匹配配置属性为如果不是精准匹配浏览器路径改为组件的路径为组件的路径为则两个组件都会显示如果不写则会匹配任意路径匹配成功后要显示的组件传递元素无论是否匹配一定会显示并且会忽略属性传递一个函数该函数有多个参数这些参数来自于上下文该函数返回元素则一定会显示返回的元素并且忽略属性组件可以写到任意的地方只要保证它是组件的后代元素组件写到组件中的组件当匹配到第一个后会立即停止匹配用组件包裹组件即可由于组件会循环所有子元素然后让每个子元素去完成匹配若匹配到则渲染对应的组件然后停止循环因此不能在的子元素中使用除外的其他组件组件组件任意路径找不到页面组件可以写到任意的地方只要保证它是组件的后代元素组件组件可以认为是是否匹配只要进行了对的匹配也就是渲染了组件不理解看注释代码不管是否能匹配到必定会看到并忽略属性如果被包裹就无法显示因为现在的匹配是进行的匹配到才会渲染组件后面的可以再看下主要学习路由怎么设计四路由信息组件会创建一个上下文并且向上下文中注入一些信息该上下文对开发者是隐藏的组件若匹配到了地址则会将这些上下文中的信息作为属性传入对应的组件它并不是对象我们利用该对象无刷新跳转地址为什么没有直接使用对象中有两种模式如果直接使用只能支持一种模式当使用方法时没有办法收到任何通知将导致无法知晓地址发生了变化结果导致无法重新渲染组件将某个新的地址入栈历史记录栈参数新的地址参数可选附带的状态数据将某个新的地址替换掉当前栈中的地址与一致与一致与一致参数跳转完成后上下文数据发生变化组件重新渲染拿到传递的参数这个并不常用因为一般参数都写在路径上面与完全一致是同一个对象但是与不同对象中记录了当前地址的相关信息我们通常使用第三方库用于解析地址栏中的数据比如把传递的参数字符串给解析成一个对象具体查看该库文档该对象中保存了路由匹配的相关信息事实上当前的路径和路由配置的路径是否是精确匹配的获取路径规则中对应的数据实际上在书写组件的属性时可以书写一个字符串正则和正则一样加上问号代表这个参数可有可无参数都要是数字前面的年月日得符合规则后面还需要有内容什么都行补充路径可以写数组符合其中一个就会匹配成功使用了第三方库该库的作用是将一个字符串正则转换成一个真正的正则表达式向某个页面传递数据的方式使用在页面时加入利用把数据填写到地址栏中的后利用把数据填写到后把数据填写到路径中例如非路由组件获取路由信息某些组件并没有直接放到中而是嵌套在其他普通组件中因此它的中没有路由信息如果这些组件需要获取到路由信息可以使用下面两种方式将路由信息从父组件一层一层传递到子组件使用提供的高阶组件包装要使用的组件该高阶组件会返回一个新组件新组件将向提供的组件注入路由信息获取上下文中的信息上下文中的新闻列表如果不用包装会报错因为没有直接放到中因此它的中没有路由信息点击返回首页找不到页面后面的也可以再看下主要学习根据页面路径重新查询主要在于将页面路径和查询条件混合页面路径改变就等于路由上下文改变会触发重新渲染用条件查询的时候也用改变页面路径参数五其他组件已学习高阶函数生成一个无刷新跳转的元素字符串跳转的目标地址对象路径附加的状态信息表示是否是替换当前地址默认是可以将内部的元素的附着在传递的对象或函数参数上函数对象打印的是内部元素的去页去页手写是一种特殊的组件具备的功能它都有它具备的额外功能是根据当前地址和链接地址来决定该链接的样式匹配时使用的类名匹配时使用的内联样式是否精确匹配匹配时是否区分大小写是否严格匹配最后一个斜杠重定向组件当加载到该组件时会自动跳转无刷新到另外一个地址跳转的地址字符串对象默认为表示跳转使用替换的方式设置为后则使用的方式跳转当匹配到地址规则时才进行跳转的那个地址可以拿到那个地址传的是否精确匹配匹配时是否区分大小写是否严格匹配最后一个斜杠六常见应用路由嵌套组件固定的区域用户信息充值这样写的目的是防止上级路由路径更换这里还得一个个改得到的是匹配地方的路径组件变化的区域根据地址的不同发生变化修改用户信息用户充值其他组件抽离路径规则将该对象的每一个字符串属性前面添加如果属性名为则直接添加如果属性名不是则添加属性值如果属性不是字符串递归调用该方法组件固定的区域用户信息充值组件变化的区域根据地址的不同发生变化修改用户信息用户充值其他组件七受保护的页面就是某些页面需要某种认证才能访问例如登录访问某个页面需要判断用户是否登录就是看仓库是否有登录信息可以在生命周期或者进行判断但是需要校验的页面多了就会有很多重复性的代码受到之前高阶组件和自定义的启发我们可以自定义一个路由组件需要校验的路由直接把组件换成该组件即可该组件封装主要用到属性去除掉传过来的属性和的区别在于是匹配后才会运行无论是否匹配都会运行可以正常展示页面把当前路径带过去方便登录后重新返回该页地址栏里有返回路径把当前路径带过去方便登录后重新返回该页地址栏里没有返回路径八实现路由模式路由配置文件实现看不懂的话可以选择性看看视频这节主要是为了说明的灵活性根据一个路由配置数组遍历该数组得到一组组件使用组件根据不同的路径渲染顶级页面返回一组可以根据路由配置中的跳转属性值无效根据的值查找对应的没有考虑有的情况如果有会比较复杂需要用到第三方库九导航守卫导航守卫当离开一个页面进入另一个页面时触发的事件对象添加一个监听器监听地址的变化当地址发生变化时会调用传递的函数参数函数运行时间点发生在即将跳转到新页面时参数对象记录当前的地址信息参数一个字符串表示进入该地址的方式出栈通过点击浏览器后退前进调用调用调用入栈替换返回结果函数可以调用该函数取消监听设置一个阻塞并同时设置阻塞消息当页面发生跳转时会进入阻塞并将阻塞消息传递到路由根组件的方法返回一个回调函数用于取消阻塞器路由根组件该函数不设置阻塞是没用的参数函数参数阻塞消息这里的参数是传过来的所以这两种类型也是的参数类型字符串消息函数函数的返回结果是一个字符串用于表示阻塞消息参数对象参数值参数回调函数调用该函数并传递则表示进入到新页面否则不做任何操作写一个监听功能将在阻塞中获取的信息保存在全局变量里方便在中拿到添加阻塞可以控制页面能不能跳转阻塞只能设置一个如果写了多个后面会覆盖前面的阻塞不管在哪个组件中添加都会触发因为上下文对象是同一个添加一个监听器不能控制页面能不能跳转取消阻塞卸载监听器获取上下文调用该函数才会跳转默认值是简单使用页面想要从跳转到跳转方式是允许跳转取消阻塞仅阻塞了一次日志从进入页面进入方式取消监听仅监听了一次页面页面十常见应用路由切换动画第三方动画库用于为内部的元素添加类样式通过属性决定内部的处于退出还是进入阶段这里不太重要什么时候需要使用再看该组件外不能套通过路由信息中的判断判断路径是否匹配从而判断内部的处于退出还是进入阶段十一滚动条复位单页应用程序的通病因为是无刷新跳转因为浏览器不知道页面变化了滚动条不会恢复到顶部滚动条横向和纵向动画复位在毫秒之内从指定的初始值变化到结束值每隔毫秒完成一次变化总时间为毫秒变化的次数总距离次数每次运动的距离高阶组件使用使用自定义的导航守卫防止点击跳转相同的页面也会调用页面页面十二阻止跳转封装通用的添加阻塞组件当为的时候添加阻塞当阻塞时跳转页面的提示消息添加阻塞简单使用别乱来会导致数据丢失真的要跳转吗源码先跳过一核心概念它是一个的解决方案用于降低以及关联的数据的复杂度传统的服务器端的环境服务端需要响应一个完整的该中包含页面需要的数据浏览器仅承担渲染页面的作用以上的这种方式叫做服务端渲染即服务器端将完整的页面组装好之后一起发送给客户端服务器端需要处理中要用到的数据并且要将数据嵌入到页面中最终生成一个完整的页面响应为了降低处理这个过程的复杂度出现了模式处理请求组装这次请求需要的数据需要用于渲染的数据模型视图用于将模型组装到界面中前端模式的困难解决了数据视图的问题前端的要比服务器复杂很多因为前端中的处理的是用户的操作而用户的操作场景是复杂的对于那些组件化的框架比如它们使用的是单向数据流若需要共享数据则必须将数据提升到顶层组件然后数据再一层一层传递极其繁琐虽然可以使用上下文来提供共享数据但对数据的操作难以监控容易导致调试错误的困难以及数据还原的困难比如数据出了问题难以定位并且若开发一个大中型项目共享的数据很多会导致上下文中的数据变得非常复杂比如上下文中有如下格式的数据前端需要一个独立的数据解决方案提出的数据解决方案它的最大历史意义在于它引入了的概念是一个普通的对象用于描述要干什么是触发数据变化的唯一原因表示数据仓库用于存储共享数据还可以根据不同的更改仓库中的数据示例用户为在基础上引入了的概念处理器用于根据来处理数据处理后的数据会被仓库重新保存二使用管理数据假设仓库中仅存放了一个数字该数字的变化可能是或约定的格式操作类型附加数据本质上就是一个普通函数之前仓库中的状态数据描述要作什么的对象返回一个新的状态如果是一个无效的操作类型数据不变创建数据仓库数据默认值返回一个仓库对象得到仓库中当前的数据向仓库分发得到仓库中当前的数据三是一个平面对象也就是一个普通对象它的指向通常使用属性表示附加数据没有强制要求中必须有属性该属性用于描述操作的类型但是没有对的类型做出要求在大型项目由于操作类型非常多为了避免硬编码会将的类型存放到一个或一些单独的文件中样板代码用避免名字冲突为了方面传递通常会使用创建函数来创建创建函数应为无副作用的纯函数就是简单的输入输出不能以任何形式改动参数不可以有异步不可以对外部环境中的数据造成影响得到一个用于增加数字操作的为了方便利用创建函数来分发触发提供了一个函数该函数用于增强创建函数的功能使它不仅可以创建并且创建后会自动完成分发假设仓库中仅存放了一个数字该数字的变化可能是或约定的格式操作类型附加数据本质上就是一个普通函数之前仓库中的状态数据描述要作什么的对象返回一个新的状态如果是一个无效的操作类型数据不变第一个参数是创建函数合并的对象第二个参数是仓库的函数得到一个新的对象新对象中的属性名与第一个参数的属性名一致得到仓库中当前的数据得到一个并直接分发向仓库分发得到仓库中当前的数据得到仓库中当前的数据四是用于改变数据的函数一个数据仓库有且仅有一个并且通常情况下一个工程只有一个仓库因此一个系统只有一个为了方便管理通常会将放到单独的文件中被调用的时机通过分发了一个此时会调用当创建一个的时候会调用一次可以利用这一点用初始化状态创建仓库时不传递任何默认状态将的参数设置一个默认值本质上就是一个普通函数之前仓库中的状态数据描述要作什么的对象当创建仓库不传递任何默认状态时也就是默认状态为会给设为默认值返回一个新的状态内部通常使用来判断值必须是一个没有副作用的纯函数为什么需要纯函数纯函数有利于测试和调式有利于还原数据有利于将来和结合时的优化具体要求不能改变参数因此若要让状态变化必须得到一个新的状态不能有异步不能对外部环境造成影响由于在大中型项目中操作比较复杂数据结构也比较复杂因此需要对进行细分提供了方法可以帮助我们更加方便的合并合并得到一个新的该新的管理一个对象该对象中的每一个属性交给对应的管理手写合并等同于上述代码同上返回一个函数五用于保存数据通过方法创建的对象该对象的成员分发一个得到仓库中当前的状态替换掉当前的基本不会用注册一个监听器监听器是一个无参函数该分发一个之后会运行注册的监听器该函数会返回一个函数用于取消监听监听器可以注册多个很重要后面会讲因为需要监听用到的仓库数据数据变化视图需要更新六手写返回一个对象分发一个得到仓库中当前的状态注册一个监听器监听器是一个无参函数该分发一个之后会运行注册的监听器该函数会返回一个函数用于取消监听判断某个对象是否是一个得到一个指定长度的随机字符串实现的功能默认的状态值当前使用的当前仓库中的状态记录所有的监听器订阅者验证验证的属性是否存在运行所有的订阅者监听器添加一个监听器订阅器将监听器加入到数组中是否已经移除掉了将从数组中移除创建仓库时需要分发一次初始的也就是之前提到过的创建仓库时先调用一次七手写传函数返回函数传对象返回对象返回结果取出对应的属性值得到一个自动分发的创建函数八手写组装返回一个数据使用一个对象表示对象的属性名与传递的参数对象保持一致会自行触发传过去的验证的返回结果是不是拿到传递一个特殊的值防止里面有硬编码例如如果以开头就返回验证返回的是一个函数要返回的新的状态返回状态九中间件中间件类似于插件可以在不影响原本功能并且不改动原本代码的基础上对其功能进行增强在中中间件主要用于增强函数实现中间件的基本原理是更改仓库中的函数保留原本的函数更改中的中间件旧数据调用原本的函数新数据如果有多个中间件需要链式调用每一次都把前面的重新保存一层包一层洋葱模型保留原本的函数更改中的中间件旧数据新数据中间件书写中间件本身是一个函数该函数接收一个参数表示创建的仓库该仓库并非一个完整的仓库对象仅包含该函数运行的时间是在仓库创建之后运行由于创建仓库后需要自动运行设置的中间件函数因此需要在创建仓库时告诉仓库有哪些中间件需要调用函数将函数的返回结果作为的第二或第三个参数有数据默认值则为第三个参数中间件函数必须返回一个创建函数函数用于记录有哪些中间件它会返回一个函数该函数用于记录创建仓库的方法然后又返回一个函数用于创建仓库优雅的写法中间件旧数据新数据中间件旧数据新数据一个中间件函数中的是最终的如果在第一个中间件中调用会无限递归是被上一个中间件包装过的也就是下一个中间件的下面返回的函数是最终要应用的中间件旧数据新数据下面返回的函数是最终要应用的中间件旧数据新数据应用中间件方式方式方式一等同于方式二十手写的本质是一个调用后可以得到创建函数的函数函数组合将一个数组中的函数进行组合形成一个新的函数该函数调用时实际上是反向调用之前组合的函数没咋懂如果没有要组合的函数则返回的函数原封不动的返回参数要组合的函数只有一个记录上一个函数返回的值它将作为下一个函数的参数数组最后一项注册中间件所有的中间件给我创建仓库的函数下面的函数用于创建仓库创建仓库初始化一个临时的在中间件还未对进行处理之前调用了这个会抛出一个错误从而避免使用未经处理的原始目前还不能使用不能直接传入因为这是最原始的它的地址并没有发生变化并不是混合之后更新的在中中间件的主要作用是在被到之前对其进行拦截和处理为了实现这个功能我们需要对原始的方法进行增强让它依次经过所有中间件的处理而是一个指向外部变量的函数当外部的变量被更新为经过中间件处理后的函数时自然也就跟着更新了简而言之下面这句代码是为了让每个中间件中如果调用调用的是最终经过处理的就像在中传入的异步函数中调用就调用的是混合的而不是原来的这点很难理解不懂的话可以问问豆包给赋值根据中间件数组得到一个创建函数的数组用多个中间件处理传入最初的进行包装修改手写应用中间件版实现的功能默认的状态值中间件返回的函数表示返回的函数第二个参数是应用中间件的函数返回值进入的处理逻辑当前使用的当前仓库中的状态记录所有的监听器订阅者验证验证的属性是否存在运行所有的订阅者监听器添加一个监听器订阅器将监听器加入到数组中是否已经移除掉了将从数组中移除创建仓库时需要分发一次初始的中间件一第三方中间件日志记录注意中间件要放到最后一个与有关引入应用二利用中间件进行副作用处理该中间件一般都放到第一个允许本来都是对象是一个带有副作用的函数当是一个函数被分发时会阻止继续向后移交即会直接调用函数会向函数中传递三个参数来自于不是也就是不是被下一个中间件包装后的来自于来自于用户设置的额外参数平时用不到由于的存在允许是一个带有副作用的函数触发如果只有这一行代码会阻止继续向后移交日志并不会打印而且此时是函数这就是中间件要放到最后一个的原因如果是第一个会先调用第一个中间件中的从而因为不是对象而报错注意这里要分清移交是从前往后调用之前说的是从后往前传递是中间件注册的时候在这里又触发了此时不是一个函数会继续往后移交所以日志可以打印正在加载异步返回带有副作用的一个函数三手写该函数返回一个中间件下一节的是具体的使用可以看一下学习把数据分离四用到的比较少如果是一个则会等待完成将完成的结果作为触发如果不是一个则判断其是否是一个如果是等待完成然后将得到的结果作为的值触发由于使用了中间件因此允许是一个在中如果要触发则使用此时是一个的源码如果不是一个标准的如果是一个则将其的值否则不做任何处理交给下一个中间件判断一个是不是标准的的必须是一个平面对象必须是一个字符串的属性不能包含其他非标准属性标准属性五迭代器和可迭代协议解决副作用的中间件需要改动可接收是一个函数需要改动可接收是一个对象或的是一个对象以上两个中间件会导致或创建函数不再纯净将解决这样的问题它不仅可以保持创建函数的纯净而且可以用模块化的方式解决副作用并且功能非常强大是建立在的生成器基础上的要熟练的使用必须理解生成器要理解生成器必须先理解迭代器和可迭代协议迭代类似于遍历遍历有多个数据组成的集合数据结构等其他类数组需要从该结构中依次取出数据进行某种处理迭代按照某种逻辑依次取出下一个数据进行处理类数组都能进行迭代但是能迭代的不一定能进行遍历迭代器语言规定如果一个对象具有方法并且方法满足一定的约束则该对象是一个迭代器方法的约束该方法必须返回一个对象该对象至少具有两个属性类型下一个数据的值如果属性为通常会将设置为类型是否已经迭代完成通过迭代器的方法可以依次取出数据并可以根据返回的属性判定是否迭代结束是一个迭代器可迭代次当前的迭代次数当前这一次迭代到的数据可无限迭代的随机数当前这一次迭代到的数据要输出斐波拉契数列的前位一个无限的斐波拉契数列当前取到斐波拉契的第几位了从开始一个一个迭代直到不能迭代位置可迭代次当前的迭代次数当前这一次迭代到的数据若当前迭代的数据不是迭代器的结束如果当前还有数据迭代器创建函数它是指一个函数调用该函数后返回一个迭代器则该函数称之为迭代器创建函数可以简称位迭代器函数当前这一次迭代到的数据若当前迭代的数据不是迭代器的结束如果当前还有数据创建一个用户迭代数组的迭代器下标从开始迭代可迭代协议中出现了循环该循环就是用于迭代某个对象的因此循环要求对象必须是可迭代的对象必须满足可迭代协议可迭代协议是用于约束一个对象的如果一个对象满足下面的规范则该对象满足可迭代协议也称之为该对象是可以被迭代的可迭代协议的约束如下对象必须有一个知名符号属性该属性必须是一个无参的迭代器创建函数满足可迭代协议可被迭代当前这一次迭代到的数据模拟循环有数据执行循环体循环的原理调用对象的方法得到一个迭代器不断调用方法只有返回的为则将返回的传递给变量然后进入循环体执行一次六生成器生成器由构造函数创建的对象该对象既是一个迭代器同时又是一个可迭代对象满足可迭代协议的对象伪代码它是迭代器具有方法它也是一个可迭代对象具有属性由于它是一个可迭代对象因此也可以使用循环注意构造函数不提供给开发者使用仅作为引擎内部使用生成器函数生成器创建函数该函数用于创建一个生成器新增了一个特殊的函数叫做生成器函数只要在函数名与关键字之间加上一个号则该函数会自动返回一个生成器下面的函数是一个生成器函数用于创建生成器生成器函数的函数体开始生成器函数的函数体运行生成器函数的函数体运行生成器函数的函数体运行结束调用后一定得到一个生成器生成器函数的特点调用生成器函数会返回一个生成器而不是执行函数体因为生成器函数的函数体执行受到生成器控制每当调用了生成器的方法生成器的函数体会从上一次的位置或开始位置运行到下一个关键字只能在生成器内部使用不可以在普通函数内部使用它表示暂停并返回一个当前迭代的数据如果没有下一个到了函数结束则生成器的方法得到的结果中的为关键字后面的表达式返回的数据会作为当前迭代的数据生成器函数的返回值会作为迭代结束时的但是如果在结束过后仍然反复调用则为用生成器函数生成一个迭代器第次迭代函数结束生成器调用的时候可以传递参数该参数会作为生成器函数体上一次表达式的值生成器第一次调用函数时传递参数没有任何意义下面的函数是一个生成器函数用于创建生成器生成器函数的函数体开始将作为第一次的迭代的值并不是给的值而是外面给的参数生成器函数的函数体运行将作为第二次迭代的值生成器函数的函数体运行后续操作如果不给传递参数打印为生成器函数的函数体运行结束调用后一定得到一个生成器第一次调用如果传参无意义因为第一次运行会停止在下一次才会给函数体中的赋值第二次调用打印生成器函数的函数体运行会将当作的返回结果传递给有迭代的值保证函数体中的正确在和出现之前用生成器解决异步问题看不懂再看视频也不太难懂成哥开始获取数据获取到数据又获取到了数据又获取到了数据通用函数运行一个生成器任务得到一个生成器封装了的方法进行下一次迭代迭代结束了拿到迭代的数据迭代的数据是一个等待拿到数据后再进行下一步循环中能写异步操作吗生成器带有一个方法该方法与的效果相同唯一的区别在于方法传递的参数会被返回成一个正常值方法传递的参数是一个错误对象会导致生成器函数内部发生一个错误报错将无法往下继续运行和正常报错一样生成器带有一个方法该方法会直接结束生成器函数就等于函数体中若需要在生成器内部调用其他生成器注意如果直接调用得到的是一个生成器如果加入号调用则进入其生成器内部执行如果是函数调用生成器函数则该函数的返回结果为该表达式的结果开始运行下面的函数是一个生成器函数用于创建生成器生成器函数的函数体开始将作为第一次的迭代的值等于运行函数体里面的内容这里的为函数的返回值不会被传递的参数影响生成器函数的函数体运行将作为第二次迭代的值生成器函数的函数体运行生成器函数的函数体运行结束调用后一定得到一个生成器七基础中文文档地址注意没有要求必须是第一个中间件因为它不会污染且不会拦截阻止的移交纯净强大灵活用于创建仓库并导出创建一个的中间件启动任务在任务中如果了一个普通数据不作任何处理仅仅将数据传递给表达式把得到的数据放到的参数中因此在中一个普通数据没什么意义任务启动了和上面讲的生成器一样把的传递到函数中需要你在后面放上一些合适的指令如果放的是指令中间件会根据不同的指令进行特殊处理以控制整个任务的流程每个指令本质上就是一个函数该函数调用后会返回一个指令对象会接收到该指令对象进行各种处理一旦任务完成生成器函数运行完成则中间件一定结束指令前面必须使用以确保该指令的返回结果被控制指令阻塞监听某个如果发生了才会进行下一步处理指令仅监听一次得到的是完整的对象任务写一个死循环防止任务完成生成器函数运行完成保证中间件不会结束持续监听发生了异步的也就是了后该语句才会输出如果没有死循环运行完这句话再不会再次输出因为任务结束了指令阻塞该函数传入一个数组数组中放入生成器会等待所有的生成器全部完成后才会进一步处理任务注意要调用传入因为传递的是生成器不是生成器函数完成所有生成器完成后才能输出如果是死循环始终将无法输出监听到了指令不断的监听某个当某个到达之后运行一个函数永远不会结束当前的生成器任务注意要调用传入因为传递的是生成器不是生成器函数完成所有生成器完成后才能输出之所以使用生成器函数是因为普通函数中不能用指令不能用如果有些副作用要处理就无法解决触发了触发了永远不会结束当前的生成器所以完成将无法输出参数一监听的参数二运行的某个生成器函数正在监听指令指令阻塞阻塞指定的毫秒数任务注意要调用传入因为传递的是生成器不是生成器函数完成所有生成器完成后才能输出如果我们希望某些操作延迟一段时间执行不要这样写因为里面的函数不能受到控制里面不能使用指令这样写这样写结果为没啥用触发了默认结果为触发了参数一监听的参数二运行的某个生成器函数正在监听指令用于重新触发相当于一个任务注意要调用传入因为传递的是生成器不是生成器函数完成所有生成器完成后才能输出处理完副作用后再次进行有点像参数一监听的参数二运行的某个生成器函数正在监听每个都会触发都会往后续移交并不会被拦截触发了两个先触发再触发指令可能阻塞如果是会阻塞用于副作用通常是异步函数调用任务完成请求学生数据设置为正在加载中当发现得到的结果是一个对象它会自动等待该完成完成之后会把完成的结果作为值传递到下一次如果对象被拒绝会使用抛出一个错误这种写法可以但是不推荐因为中一般都是指令统一格式方便单元测试使用指令参数一函数名参数二函数的参数格式为参数列表如如果中要用到可以这样绑定此时为正在监听指令可能阻塞用于副作用通常是异步函数调用用法同传参方式不同函数名参数指令用于得到当前仓库中的数据设置为正在加载中拿到仓库中的全部数据对仓库中的数据进行筛选使用指令按照当前仓库中的条件指令可能阻塞看回调函数什么时候调用用于调用那些传统的回调方式的异步函数传统回调模式的异步风格出错了参数一错误对象参数二数据设置为正在加载中使用指令按照当前仓库中的条件它会自动传递一个回调函数无论有没有错误都执行正在监听补充如果没有副作用即普通函数可以不使用指令指令用于开启一个新的任务该任务不会阻塞该函数需要传递一个生成器函数返回了一个对象类型为这块代码没写全太复杂了难理解这样写调用次会发现只运行了一次是因为在第一次调用的时候已经监听结束由于现在还在阻塞中新的监听还没开始这样写则会运行三次因为会开一个新的线程不会阻塞当前任务以最后一次调用为准比如说调用三次只执行第三次前两次都取消有点类似于防抖监听到了并且在开启新任务之前取消之前的任务之前有任务可以取消多个任务之前的任务被取消掉了调用次运行了三次就是通过来实现的正在监听先打印出来说明不会阻塞就像开了一个新的线程它内部会阻塞与外面无关用存在的问题拿不到上次开启的任务线自增任务取消的是的任务与它开启的子任务无关并且取消后就无法开启了这点靠自己理解监听到了第一次会运行第二次不会运行因为第一次运行时把任务取消掉了第二次无法触发该任务了如果调用三次会开启三个自增任务且三个互不干扰这个说法要忽略上面里面的内容正在监听解决上述问题取消掉之前开启的任务线正在监听用于取消一个或多个任务分叉的任务可以被主任务取消实际上取消的实现原理是利用可以不传递参数如果不传递参数则取消当前任务线功能和一致只不过会自动取消掉之前开启的任务自增任务实现上面解决的效果正在监听高级用法流程控制真滴牛叉自动增加和停止的流程控制流程自动增加停止自动增加停止只监听自动增加任务被取消掉了转而监听正在监听判断当前任务线是否被取消掉了阻塞竞赛可以传递多个指令当其中任何一个指令结束后会直接结束与类似返回的结果是最先完成的指令结果并且该函数会自动取消其他的任务异步的得到一个生成一个毫秒的随机时间改造流程控制自动增加和停止的流程控制流程自动增加停止自动增加停止只监听正在监听八手写先行跳过九该库用于简化以及官网文档该函数用于帮助你创建一个创建函数但是一般用的是实现原理用大写符合标准异步增加异步减少需要为函数元数据该函数用于帮助你创建多个创建函数异步增加异步减少没有直接写是类型是根据传递的对象生成相应函数手写取出属性值得到一个小驼峰命名的属性名重写让传递函数名时可以拿到字符串得到小驼峰命名法简化针对单个类型的处理当它匹配到对应的类型后会执行对应的函数参数一类型不仅可以写字符串还能写解构出来的函数参数二匹配后的函数参数三默认值简化针对多个类型的处理可以换成默认值为因为代码简化可以直接把和放一个文件内具体使用还可以看看视频或文档百度网盘视频播放配合和两个函数用于处理多个对应同一个处理函数可以看出来几个都是一个处理函数合并只要匹配其中一个就触发相关组件路由和数据一组件化的界面处理方案根据地址匹配路由最终渲染不同的组件处理数据以及数据变化的方案主要用于处理共享数据如果一个组件仅用于渲染一个界面而没有状态通常是一个函数组件该组件叫做展示组件如果一个组件仅用于提供数据没有任何属于自己的界面则该组件叫做容器组件容器组件纯粹是为了给其他组件提供数据库链接和先不用手写试试补充一下如果一个组件依赖的中的某项数据没有发生改变该组件不会重新渲染类似纯组件展示组件异步减减加异步加将整个仓库的状态映射到当前需要的数据容器组件监听仓库仓库数据改变改变数据组件没有任何界面该组件的作用是将的仓库放到一个上下文中提供上下文该组件是容器组件可以传到展示组件中高阶组件用于链接仓库和组件的展示组件异步减减加异步加将整个仓库的状态映射到当前需要的数据映射事件处理函数这种写法最为推荐返回一个高阶组件传入展示组件返回一个容器组件参数一映射的属性可以传参数二映射的函数可传或不传细节一如果对返回的容器组件加上额外的属性则这些属性会直接传递到展示组件也是一样第一个参数参数整个仓库的状态参数使用者传递的属性对象第二个参数情况传递一个函数参数函数参数使用者传递的属性对象函数返回的对象会作为属性传递到展示组件中作为事件处理函数存在情况传递一个对象对象的每个属性是一个创建函数当事件触发时会自动的函数返回的展示组件异步减减加异步加将整个仓库的状态映射到当前需要的数据情况细节二如果不传递第二个参数通过连接的组件会自动得到一个属性使得组件有能力自行触发但是不推荐这样做流程二手写先跳过三额外的详情参考一个函数参数该参数的值来自于返回的值参数该参数的值来自于返回的值参数来自于组件使用者传递的属性返回值一个对象该对象的属性最终会被传递到包装的组件中配置对象该函数和一样也是用于连接组件和仓库的只不过它的配置比少一些该函数需要传递两个参数参数参数配置返回函数参数参数返回的是一个对象该对象的属性最终会成为包装的组件的属性字符串通过一个唯一的值创建一个组件用于有多个的时候但一般用不到四和的结合课前知识插件该插件不能直接使用需要安装第三方库使用安装第三方库需要修改部分代码具体使用去看文档吧不再细说用于将和进行结合文档如果使用到还是看文档吧因为讲解的版本比较老用该库是为了保证数据源统一路由信息也从仓库中拿到本质上中的某些数据可能会跟数据仓库中的数据进行联动该组件会将下面的路由数据和仓库保持同步它不是的它表示当前路由跳转的方式它记录了当前的地址信息该库中的内容这是一个函数调用它会返回一个用于管理仓库中路由信息的该函数需要传递一个参数参数是一个对象该对象可以使用第三方库得到中提供的对象也是通过该库得到的该函数会返回一个中间件用于拦截一些特殊的这是一个组件用于向上下文提供一个对象和其他的路由信息与提供的信息一致之所以需要新制作一个组件是因为该库必须保证整个过程使用的是同一个对象一些创建函数就是使用提供的路由跳转方法会触发五手写这块需要理解的源码六官方网站介绍不仅仅是一个第三方库更是一个框架它主要整合了的相关内容让我们处理数据更加容易实际上依赖了很多等的使用默认导出一个函数通过调用该函数可以得到一个对象对象路由方法传入一个函数该函数返回一个节点将来应用程序启动后会自动渲染该节点对象该方法用于启动应用程序可以认为启动的就是程序该函数传入一个选择器用于选中页面中的某个元素会将内容渲染到该元素内部对象该方法用于定义一个模型该模型可以理解为的副作用处理的整合整合成一个对象将该对象传入方法即可命名空间该属性是一个字符串字符串的值会被作为仓库中的属性保存必写该模型的默认状态必写该属性配置为一个对象对象中的每个方法就是一个约定方法的名字就是匹配的类型处理副作用底层是使用实现的该属性配置为一个对象对象中的每隔方法均处理一个副作用方法的名字就是匹配的类型函数的参数参数封装好的对象配置为一个对象该对象中可以写任意数量任意名称的属性每个属性是一个函数这些函数会在模型加入到仓库中后立即运行得到一个对象在启动之前定义模型设置根路由即启动后要运行的函数函数的返回结果会被渲染可以看成触发自己模型中的可以不用加前缀订阅窗口尺寸变化每次变化让数字增加异步减异步加加上需要加上命名空间触发里的方法在中同步路由到仓库其实也是依赖了在调用函数时配置对象使用提供路由上下文配置同步到仓库的对象创建仓库时使用的默认状态通常不会配置因为模型里已经配置了当仓库的运行发生错误的时候运行的函数可以配置中间件触发做的事情传入一个中间件对象传入一个中间件数组当仓库中的状态发生变化时运行的函数对模型中的的进一步封装类似于对模型中的的进一步封装用于配置额外的它是一个对象对象的每一个属性是一个方法每个方法就是一个需要合并的方法名即属性名它是用于封装函数的会将原来的仓库创建函数作为参数传递返回一个新的用于创建仓库的函数函数必须放置到数组中老状态新状态得到一个对象该参数是原来的类似于之前讲过的封装即将被执行执行结束即将执行副作用代码副作用代码执行完毕即将创建仓库即将创建仓库在启动之前定义模型设置根路由即启动后要运行的函数函数的返回结果会被渲染里面包含了所有的东西首页中会传过来一个我们自己配置的对象首页计数器手写跳过插件通过对象插件来使用插件插件本质上就是一个对象该对象与配置对象相同会在启动时将传递的插件对象混合到配置中老状态新状态得到一个对象使用插件混合配置在启动之前定义模型设置根路由即启动后要运行的函数函数的返回结果会被渲染该插件会在仓库中加入一个状态名称为它是一个对象其中有以下属性全局是否正在处理副作用加载只要有任何一个模型在处理副作用则该属性为一个对象对象中的属性名以及属性的值表示哪个对应的模型是否在处理副作用中加载中一个对象对象中的属性名以及属性的值表示是哪个触发了副作用七简介官网插件化开箱即用约定式路由全局安装提供了一个命令行工具通过该命令可以对工程进行操作还可以使用对应的脚手架使用开发模式启动工程打包',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-08 14:58:03',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">拾贰</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://s2.loli.net/2023/09/01/q6Stn5jbXVzxHmC.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://s2.loli.net/2023/09/01/q6Stn5jbXVzxHmC.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2023/09/01/Qa1oSxc3nlEeGOt.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://s2.loli.net/2023/09/01/Qa1oSxc3nlEeGOt.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/HTML-CSS/" style="font-size: 1.05rem;">HTML+CSS<sup>4</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>4</sup></a><a href="/tags/React/" style="font-size: 1.05rem;">React<sup>2</sup></a><a href="/tags/TypeScript/" style="font-size: 1.05rem;">TypeScript<sup>1</sup></a><a href="/tags/Uniapp/" style="font-size: 1.05rem;">Uniapp<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 1.05rem;">Vue<sup>2</sup></a><a href="/tags/Vue2/" style="font-size: 1.05rem;">Vue2<sup>2</sup></a><a href="/tags/Vue3/" style="font-size: 1.05rem;">Vue3<sup>1</sup></a><a href="/tags/Webpack/" style="font-size: 1.05rem;">Webpack<sup>2</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7%E5%BA%93/" style="font-size: 1.05rem;">工具库<sup>1</sup></a><a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 1.05rem;">工程化<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%A1%E4%B8%80%E5%A4%A7%E5%B8%88%E8%AF%BE%E4%B9%8B%E5%B0%B1%E4%B8%9A%E6%8F%90%E5%8D%87/" itemprop="url">渡一大师课之就业提升</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/React/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>React</span></a></span></div></div><h1 class="post-title" itemprop="name headline">React</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-12-17T03:10:03.971Z" title="发表于 2024-12-17 11:10:03">2024-12-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-08T06:58:03.190Z" title="更新于 2025-02-08 14:58:03">2025-02-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为新乡"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>新乡</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/12/17/React/"><header><a class="post-meta-categories" href="/categories/%E6%B8%A1%E4%B8%80%E5%A4%A7%E5%B8%88%E8%AF%BE%E4%B9%8B%E5%B0%B1%E4%B8%9A%E6%8F%90%E5%8D%87/" itemprop="url">渡一大师课之就业提升</a><a href="/tags/React/" tabindex="-1" itemprop="url">React</a><h1 id="CrawlerTitle" itemprop="name headline">React</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">拾贰</span><time itemprop="dateCreated datePublished" datetime="2024-12-17T03:10:03.971Z" title="发表于 2024-12-17 11:10:03">2024-12-17</time><time itemprop="dateCreated datePublished" datetime="2025-02-08T06:58:03.190Z" title="更新于 2025-02-08 14:58:03">2025-02-08</time></header><h1 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h1><h2 id="一、React概述"><a href="#一、React概述" class="headerlink" title="一、React概述"></a>一、React概述</h2><blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://react.docschina.org/">https://react.docschina.org/</a></p>
</blockquote>
<h3 id="1-什么是React？"><a href="#1-什么是React？" class="headerlink" title="1.什么是React？"></a>1.什么是React？</h3><p>React是由<strong>Facebook</strong>研发的、用于<strong>解决UI复杂度</strong>的开源<strong>JavaScript库</strong>，目前由React联合社区维护。</p>
<blockquote>
<p>它不是框架，只是为了解决UI复杂度而诞生的一个库</p>
</blockquote>
<h3 id="2-React的特点"><a href="#2-React的特点" class="headerlink" title="2.React的特点"></a>2.React的特点</h3><ul>
<li>轻量：React的开发版所有源码（包含注释）仅3000多行</li>
<li>原生：所有的React的代码都是用原生JS书写而成的，不依赖其他任何库</li>
<li>易扩展：React对代码的封装程度较低，也没有过多的使用魔法，所以React中的很多功能都可以扩展。</li>
<li>不依赖宿主环境：React只依赖原生JS语言，不依赖任何其他东西，包括运行环境。因此，它可以被轻松的移植到浏览器、桌面应用、移动端。</li>
<li>渐近式：React并非框架，对整个工程没有强制约束力。这对与那些已存在的工程，可以逐步的将其改造为React，而不需要全盘重写。</li>
<li>单向数据流：所有的数据自顶而下的流动</li>
<li>用JS代码声明界面</li>
<li>组件化</li>
</ul>
<h3 id="3-对比Vue"><a href="#3-对比Vue" class="headerlink" title="3.对比Vue"></a>3.对比Vue</h3><table>
<thead>
<tr>
<th align="center">对比项</th>
<th align="center">Vue</th>
<th align="center">React</th>
</tr>
</thead>
<tbody><tr>
<td align="center">全球使用量</td>
<td align="center"></td>
<td align="center">✔</td>
</tr>
<tr>
<td align="center">国内使用量</td>
<td align="center">✔</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">性能</td>
<td align="center">✔</td>
<td align="center">✔</td>
</tr>
<tr>
<td align="center">易上手</td>
<td align="center">✔</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">灵活度</td>
<td align="center"></td>
<td align="center">✔</td>
</tr>
<tr>
<td align="center">大型企业</td>
<td align="center"></td>
<td align="center">✔</td>
</tr>
<tr>
<td align="center">中小型企业</td>
<td align="center">✔</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">生态</td>
<td align="center"></td>
<td align="center">✔</td>
</tr>
</tbody></table>
<h3 id="4-学习路径"><a href="#4-学习路径" class="headerlink" title="4.学习路径"></a>4.学习路径</h3><p>整体原则：熟悉API –&gt; 深入理解原理</p>
<ol>
<li>React<ol>
<li>基础：掌握React的基本使用方法，有能力制作各种组件，并理解其基本运作原理</li>
<li>进阶：掌握React中的一些黑科技，提高代码质量</li>
</ol>
</li>
<li>React-Router：相当于vue-router</li>
<li>Redux：相当于Vuex<ol>
<li>Redux本身</li>
<li>各种中间件</li>
</ol>
</li>
<li>第三方脚手架：umi</li>
<li>UI库：Ant Design，相当于Vue的Element-UI 或 IView</li>
<li>源码部分<ol>
<li>React源码分析</li>
<li>Redux源码分析</li>
</ol>
</li>
</ol>
<h2 id="二、Hello-World"><a href="#二、Hello-World" class="headerlink" title="二、Hello World"></a>二、Hello World</h2><p>直接在页面上使用React，引用下面的JS</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- crossorigin 跨域，虽然script元素本来就可以跨域，但是跨域如果报错了，不会显示完整的错误信息，加上就可以了 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- React的核心库，与宿主环境无关，适用于多端 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@16/umd/react.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 依赖核心库，将核心的功能与页面结合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@16/umd/react-dom.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//创建一个span元素，创建虚拟dom</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> span = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>, &#123;&#125;, <span class="string">&quot;一个span元素&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//创建一个H1元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> h1 = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h1&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: <span class="string">&quot;第一个React元素&quot;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;World&quot;</span>, span);</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(h1, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>)); <span class="comment">// 渲染h1到root中</span></span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-React-createElement"><a href="#1-React-createElement" class="headerlink" title="1.React.createElement"></a>1.React.createElement</h3><p>创建一个React元素，称作虚拟DOM，本质上是一个对象，然后交给ReactDOM渲染到页面上</p>
<ol>
<li>参数1：元素类型，如果是字符串，一个普通的HTML元素</li>
<li>参数2：元素的属性，一个对象</li>
<li>后续参数：元素的子节点</li>
</ol>
<h3 id="2-JSX"><a href="#2-JSX" class="headerlink" title="2.JSX"></a>2.JSX</h3><p>JS的扩展语法，因为标准不支持，需要使用babel进行转义。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- React的核心库，与宿主环境无关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react@16/umd/react.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 依赖核心库，将核心的功能与页面结合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">crossorigin</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/react-dom@16/umd/react-dom.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 编译JSX --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/babel-standalone@6/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span>&gt;</span><span class="language-javascript"> <span class="comment">// 因为不是标准语法，浏览器执行会报错，需要让浏览器忽略这部分，让babel执行编译，text/babel-&gt;text/javascript</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//创建一个span元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var span = React.createElement(&quot;span&quot;, &#123;&#125;, &quot;一个span元素&quot;);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> span = <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>一个span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span> <span class="comment">// 这种写法会转化成上面形式</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//创建一个H1元素</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// var h1 = React.createElement(&quot;h1&quot;, &#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//     title: &quot;第一个React元素&quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;, &quot;Hello&quot;, &quot;World&quot;, span);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> h1 = <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">title</span>=<span class="string">&quot;第一个React元素&quot;</span>&gt;</span>Hello World <span class="tag">&lt;<span class="name">span</span>&gt;</span>一个span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(h1);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">title</span>=<span class="string">&quot;第一个React元素&quot;</span>&gt;</span>Hello World <span class="tag">&lt;<span class="name">span</span>&gt;</span>一个span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="三、使用脚手架搭建工程"><a href="#三、使用脚手架搭建工程" class="headerlink" title="三、使用脚手架搭建工程"></a>三、使用脚手架搭建工程</h2><p>官方：create-react-app</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn create react-app react-learn <span class="comment"># yarn会将 react-app 补全为create-react-app</span></span><br><span class="line"><span class="comment"># yarn create 下载并运行 </span></span><br></pre></td></tr></table></figure>

<p>第三方：next.js、umijs</p>
<p>凡是使用JSX的文件，必须导入React</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js 入口文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="comment">// React包看似没有使用，其实它将jsx语法编译成了React.createElement()</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World <span class="tag">&lt;<span class="name">span</span>&gt;</span>span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="四、开发环境搭建"><a href="#四、开发环境搭建" class="headerlink" title="四、开发环境搭建"></a>四、开发环境搭建</h2><h3 id="1-VSCode配置"><a href="#1-VSCode配置" class="headerlink" title="1.VSCode配置"></a>1.VSCode配置</h3><p>emmet配置：方便jsx书写html元素，增加代码提示</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;emmet.includeLanguages&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;javascript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;javascriptreact&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-VSCode插件安装"><a href="#2-VSCode插件安装" class="headerlink" title="2.VSCode插件安装"></a>2.VSCode插件安装</h3><ul>
<li>ESLint：代码风格检查</li>
<li>ES7 React&#x2F;Redux&#x2F;GraphQL&#x2F;React-Native snippets：快速代码编写</li>
</ul>
<h3 id="3-Chrome插件安装"><a href="#3-Chrome插件安装" class="headerlink" title="3.Chrome插件安装"></a>3.Chrome插件安装</h3><p>React Developer Tools 开发者工具在谷歌商店下载</p>
<h1 id="React核心概念"><a href="#React核心概念" class="headerlink" title="React核心概念"></a>React核心概念</h1><h2 id="一、JSX"><a href="#一、JSX" class="headerlink" title="一、JSX"></a>一、JSX</h2><h3 id="1-什么是JSX"><a href="#1-什么是JSX" class="headerlink" title="1.什么是JSX"></a>1.什么是JSX</h3><ul>
<li><p>Facebook起草的JS扩展语法</p>
</li>
<li><p>本质是一个JS对象，会被babel编译，最终会被转换为React.createElement</p>
</li>
<li><p>每个JSX表达式，有且仅有一个根节点，因为<code>React.createElement()</code>每次只能创建一个元素</p>
<ul>
<li>React.Fragment</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="comment">// &lt;&gt; 空的根节点，不会影响页面元素布局，是React.Fragment的语法糖，可以替换成&lt;React.Fragment&gt;&lt;/React.Fragment&gt;</span></span><br><span class="line"><span class="keyword">const</span> h1 = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World <span class="tag">&lt;<span class="name">span</span>&gt;</span>span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>asdfafdafd<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(h1);</span><br><span class="line"></span><br><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h1&quot;</span>, &#123;&#125;, <span class="string">&quot;Hello World&quot;</span>, <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;span&quot;</span>,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    <span class="string">&quot;span元素&quot;</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(h1, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure></li>
<li><p>每个JSX元素必须结束（XML规范）</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2962719555,3613138778&amp;fm=27&amp;gp=0.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span> ❌</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2962719555,3613138778&amp;fm=27&amp;gp=0.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span> ✅</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2962719555,3613138778&amp;fm=27&amp;gp=0.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span>✅</span><br></pre></td></tr></table></figure>

<h3 id="2-在JSX中嵌入表达式"><a href="#2-在JSX中嵌入表达式" class="headerlink" title="2.在JSX中嵌入表达式"></a>2.在JSX中嵌入表达式</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">12</span>,b = <span class="number">13</span>;</span><br><span class="line"><span class="keyword">const</span> div = (</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;a&#125; * &#123;b&#125; = &#123;a * b&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 等同</span></span><br><span class="line"><span class="keyword">const</span> div = <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>,&#123;&#125;,<span class="string">`<span class="subst">$&#123;a&#125;</span> * <span class="subst">$&#123;b&#125;</span> = <span class="subst">$&#123;a*b&#125;</span>`</span>)</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(div, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>在JSX中使用注释使用js注释写法 <code>&#123;/*  */&#125;</code></li>
<li>将表达式作为内容的一部分<ul>
<li>null、undefined、false不会显示</li>
<li>普通对象，不可以作为子元素  <code>const obj = &#123; a: 5 &#125;</code></li>
<li>可以放置React元素对象  <code>const div = &lt;div&gt;React&lt;/div&gt; </code></li>
<li>如果放置的是一个数组，它会遍历这个数组，把数组每一个元素作为子元素加进去</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="number">1234</span>, b = <span class="number">4321</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const obj = &#123;</span></span><br><span class="line"><span class="comment">//     a: 1,</span></span><br><span class="line"><span class="comment">//     b: 2</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>这是一个span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">2</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">undefined</span>, <span class="number">3</span>]; <span class="comment">// null, false, undefined 不会显示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> numbers = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">30</span>);</span><br><span class="line">numbers.<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">var</span> lis = numbers.<span class="title function_">map</span>(<span class="function">(<span class="params">item, i</span>) =&gt;</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span>&gt;</span>&#123;i&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> div = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;a&#125; * &#123;b&#125; = &#123;a * b&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 以下不会产生任何输出 */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;null&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;undefined&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;false&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 普通对象无法放置 */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;/* &#123;obj&#125; */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* React元素对象没问题 */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;obj&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;arr&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;lis&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(div);</span><br><span class="line"></span><br><span class="line"><span class="comment">// const div = React.createElement(&quot;div&quot;, &#123;&#125;, `$&#123;a&#125; * $&#123;b&#125; = $&#123;a*b&#125;`)</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(div, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>将表达式作为元素属性</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=2962719555,3613138778&amp;fm=27&amp;gp=0.jpg&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> cls = <span class="string">&quot;image&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> div = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;url&#125;</span> <span class="attr">className</span>=<span class="string">&#123;cls&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">marginLeft:</span> &quot;<span class="attr">50px</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width:</span>&quot;<span class="attr">200px</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125; <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(div, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>属性使用小驼峰命名法</li>
<li>防止注入攻击<ul>
<li>自动编码</li>
<li>dangerouslySetInnerHTML</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> content = <span class="string">&quot;&lt;h1&gt;afasfasfd&lt;/h1&gt;&lt;p&gt;阿斯顿法定发送&lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="comment">// dangerouslySetInnerHTML 把文本解析为html</span></span><br><span class="line"><span class="keyword">const</span> div = (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">__html:</span> <span class="attr">content</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(div, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="3-元素的不可变性"><a href="#3-元素的不可变性" class="headerlink" title="3.元素的不可变性"></a>3.元素的不可变性</h3><ul>
<li>虽然JSX元素是一个对象，但是该对象中的所有属性不可更改</li>
<li>如果确实需要更改元素的属性，需要重新创建JSX元素</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    num++;</span><br><span class="line">    <span class="keyword">const</span> div = (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">title</span>=<span class="string">&quot;asdfadf&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;num&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// div.props.children = 2 会报错，不能修改，该对象被Object.freeze(div)冻结了</span></span><br><span class="line">    <span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(div, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 这种方法效率并不低，因为它没有删除重建dom元素，只是重新创建对象，然后重新渲染。js创建对象的效率很高，会对比两次的对象，然后修改不同的地方，这就是diff算法</span></span><br></pre></td></tr></table></figure>

<h3 id="4-demo图片切换"><a href="#4-demo图片切换" class="headerlink" title="4.demo图片切换"></a>4.demo图片切换</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> src1 <span class="keyword">from</span> <span class="string">&quot;./assets/1.jpg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> src2 <span class="keyword">from</span> <span class="string">&quot;./assets/2.jpg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> src3 <span class="keyword">from</span> <span class="string">&quot;./assets/3.jpg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> srcs = [src1, src2, src3]; <span class="comment">//保存图片路径的数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>; <span class="comment">//显示的图片索引</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> timer; <span class="comment">//计时器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据index的值，显示某张图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 路径必须要导入进来，如果直接使用相对路径，打包后路径会变化</span></span><br><span class="line">    <span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;srcs[index]&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span>, container);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动计时器，每隔一段时间，切换图片</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">stop</span>();</span><br><span class="line">    timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        index = (index + <span class="number">1</span>) % <span class="number">3</span>; <span class="comment">//改变index</span></span><br><span class="line">        <span class="title function_">render</span>();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 停止计时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">stop</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">start</span>();</span><br><span class="line"></span><br><span class="line">container.<span class="property">onmouseenter</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">stop</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.<span class="property">onmouseleave</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、组件和组件属性"><a href="#二、组件和组件属性" class="headerlink" title="二、组件和组件属性"></a>二、组件和组件属性</h2><p>组件：包含内容、样式和功能的UI单元</p>
<h3 id="1-创建一个组件"><a href="#1-创建一个组件" class="headerlink" title="1.创建一个组件"></a>1.创建一个组件</h3><p><strong>特别注意：组件的名称首字母必须大写</strong></p>
<ol>
<li>函数组件&lt;现在更建议使用&gt;</li>
</ol>
<p>返回一个React元素</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MyFuncComp</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// return React.createElement() 这种写法也可以</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>函数组件，目前的数字：&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> comp = <span class="language-xml"><span class="tag">&lt;<span class="name">MyFuncComp</span> /&gt;</span></span> <span class="comment">// 使用组件生成的仍然是一个React元素，变化的只是type值</span></span><br><span class="line"><span class="comment">// React 是靠首字母的大小写，来区分是我们自己写的组件还是普通的html元素</span></span><br><span class="line"><span class="comment">// 两种调用方法</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;MyFuncComp()&#125; // 这种一般不用，不符合组件结构，无法被react开发者工具管控</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">MyFuncComp</span>&gt;</span><span class="tag">&lt;/<span class="name">MyFuncComp</span>&gt;</span> // 常用，当成元素使用</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>类组件</li>
</ol>
<p>必须继承React.Component</p>
<p>必须提供render函数，用于渲染组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>,&#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyClassComp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constructor(props) &#123;</span></span><br><span class="line">    <span class="comment">//     super(props); // this.props = props;</span></span><br><span class="line">    <span class="comment">//     console.log(props, this.props, props === this.props);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该方法必须返回React元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">obj</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        姓名：&#123;this.props.obj.name&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        年龄：&#123;this.props.obj.age&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">ui</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>下面是传入的内容<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;this.props.ui&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>类组件的内容，数字：&#123;this.props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 每调用这个类实际就是创建了一个新对象</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MyClassComp</span>&gt;</span><span class="tag">&lt;/<span class="name">MyClassComp</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-组件的属性"><a href="#2-组件的属性" class="headerlink" title="2.组件的属性"></a>2.组件的属性</h3><ol>
<li><p>对于函数组件，属性会作为一个对象的属性，传递给函数的参数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">&lt;<span class="title class_">MyFuncComp</span> number=&#123;<span class="number">2</span>&#125;&gt;&lt;/<span class="title class_">MyFuncComp</span>&gt;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MyFuncComp</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>函数组件，目前的数字：&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于类组件，属性会作为一个对象的属性，传递给构造函数的参数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line">&lt;<span class="title class_">MyClassComp</span> number=&#123;<span class="number">2</span>&#125; ui=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>传递<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>&#125;&gt;&lt;<span class="regexp">/MyClassComp&gt; /</span><span class="regexp">/ ui=&#123;&lt;h1&gt;传递&lt;/</span>h1&gt;&#125; 就是传了个对象</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MyClassComp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props); <span class="comment">// 继承先调用父类的构造函数 this.props = props;</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(props, <span class="variable language_">this</span>.<span class="property">props</span>, props === <span class="variable language_">this</span>.<span class="property">props</span>); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 以上构造函数也可以不写</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">ui</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">ui</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>类组件的内容，数字：&#123;this.props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>注意：组件的属性，应该使用小驼峰命名法</p>
<p><strong>组件无法改变自身的属性</strong>。</p>
<blockquote>
<p>也就是子组件不能直接修改父组件传递过来的数据，和之前说的react元素一样，不能修改自身属性，也就是元素的不可变性</p>
</blockquote>
<p>之前学习的React元素，本质上，就是一个组件（内置组件）</p>
<p>React中的哲学：数据属于谁，谁才有权力改动</p>
<p><strong>React中的数据，自顶而下流动</strong></p>
<blockquote>
<p>props中如果传了对象过来，子组件修改其中的内容不会报错，但是建议不这样做</p>
</blockquote>
<p><strong>补充</strong>：父组件给子组件传参的简单写法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;tentwo&#x27;</span>,</span><br><span class="line">	<span class="attr">address</span>: <span class="string">&#x27;河南&#x27;</span>,</span><br><span class="line">	<span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line">	<span class="attr">phone</span>: <span class="string">&#x27;16616522170&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用子组件并传参，把obj的所有属性传递过去</span></span><br><span class="line">&lt;<span class="title class_">MyFuncComp</span> &#123;...obj&#125;&gt;&lt;/<span class="title class_">MyFuncComp</span>&gt;</span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">MyFuncComp</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>我是&#123;props.name&#125;,来自&#123;props.address&#125;,今年&#123;props.age&#125;岁...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三、组件状态"><a href="#三、组件状态" class="headerlink" title="三、组件状态"></a>三、组件状态</h2><p>组件状态：组件可以自行维护的数据，也就是这些数据属于自己，不是传递过来的</p>
<p>组件状态仅在类组件中有效，注意：引入hooks后，函数式组件也有组件状态了</p>
<p>状态（state），本质上是类组件的一个属性，是一个对象，状态是必须要初始化的</p>
<p><strong>状态初始化</strong></p>
<ul>
<li>在构造函数中初始化</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计时器，用作倒计时</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Tick</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="comment">//初始化状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">number</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// this.state.left = this.state.left-- 这样无法重新渲染，不能使用this.render(),这个函数是react自己调用的</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">left</span> - <span class="number">1</span></span><br><span class="line">            &#125;); <span class="comment">//重新设置状态，触发自动的重新渲染</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">left</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//停止计时器</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    倒计时剩余时间：&#123;this.state.left&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>直接在类里面写</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计时器，用作倒计时</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Tick</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//初始化状态，JS Next 语法，目前处于实验阶段,bable可以将它转化为正常语法</span></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">number</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// this.state.left = this.state.left-- 这样无法重新渲染，不能使用this.render(),这个函数是react自己调用的</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">left</span> - <span class="number">1</span></span><br><span class="line">            &#125;); <span class="comment">//重新设置状态，触发自动的重新渲染</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">left</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//停止计时器</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    倒计时剩余时间：&#123;this.state.left&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>状态的变化</strong></p>
<p>不能直接改变状态：因为React无法监控到状态发生了变化</p>
<p>必须使用this.setState({})改变状态，this.setState({})中的内容会和this.state进行混合</p>
<p>一旦调用了this.setState，会导致当前组件重新渲染，</p>
<p><strong>组件中的数据</strong></p>
<ol>
<li>props：该数据是由组件的使用者传递的数据，所有权不属于组件自身，因此组件无法改变该数组</li>
<li>state：该数组是由组件自身创建的，所有权属于组件自身，因此组件有权改变该数据</li>
</ol>
<h2 id="四、事件"><a href="#四、事件" class="headerlink" title="四、事件"></a>四、事件</h2><p>在React中，组件的事件，本质上就是一个属性</p>
<p>按照之前React对组件的约定，由于事件本质上是一个属性，因此也需要使用小驼峰命名法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;点击了！！！&quot;</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> btn = <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> <span class="attr">onMouseEnter</span>=<span class="string">&#123;(e)</span>=&gt;</span>&#123; // 两种写法</span></span><br><span class="line"><span class="language-xml">    console.log(&quot;鼠标移入了&quot;, e)</span></span><br><span class="line"><span class="language-xml">&#125;&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(btn, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Tick</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">number</span>: props.<span class="property">number</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">number</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">number</span> - <span class="number">1</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">number</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">                <span class="comment">//倒计时完成</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onOver</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onOver</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                倒计时：&#123;this.state.number&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tick</span> <span class="keyword">from</span> <span class="string">&quot;./Tick&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">TickControl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">isOver</span>: <span class="literal">false</span> <span class="comment">//倒计时是否完成</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">handleOver</span>(<span class="params"></span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> status = <span class="string">&quot;正在倒计时&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isOver</span>) &#123;</span><br><span class="line">            status = <span class="string">&quot;倒计时完成&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Tick</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onOver</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            isOver: true</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">                    number=&#123;10&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;status&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>如果没有特殊处理，在事件处理函数中，this指向undefined</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Tick</span> <span class="keyword">from</span> <span class="string">&quot;./Tick&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">TickControl</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">isOver</span>: <span class="literal">false</span> <span class="comment">//倒计时是否完成</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 1.使用bind函数，绑定this</span></span><br><span class="line">    <span class="comment">// constructor(props)&#123;</span></span><br><span class="line">    <span class="comment">//     super(props);</span></span><br><span class="line">    <span class="comment">//     this.handleClick = this.handleClick.bind(this); // 把原型上面的方法绑定到现在的对象上面，涉及原型链，如果不清楚，回头在看看，原型上和                                                            // 对象上面都有</span></span><br><span class="line">    <span class="comment">//     this.handleOver = this.handleOver.bind(this);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">handleOver</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>) <span class="comment">// undefined</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">isOver</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.使用箭头函数,结果是该函数不在原型上，而在对象上面，只有对象上有，原型上没</span></span><br><span class="line">	handleOver = <span class="function">()=&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">isOver</span>: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> status = <span class="string">&quot;正在倒计时&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isOver</span>) &#123;</span><br><span class="line">            status = <span class="string">&quot;倒计时完成&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Tick</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onOver</span>=<span class="string">&#123;this.handleClick.bind(this)&#125;</span> // <span class="attr">1.使用bind函数</span>，<span class="attr">绑定this</span>，<span class="attr">但是这种写法每次渲染都会产生一个新的函数</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    // <span class="attr">onOver</span>=<span class="string">&#123;this.handleOver&#125;</span> <span class="attr">这样写会报错</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    // <span class="attr">调用这个函数不是通过该类的对象调用的</span>，<span class="attr">实际是Tick组件中调用this.props.onOver</span>，<span class="attr">也就是通过props调用的</span>，<span class="attr">所以为了防止出问题</span>，						// <span class="attr">react就把这个this当成了undefined</span>,<span class="attr">总不能当成Tick组件中的props吧</span>。<span class="attr">写箭头函数可以是因为箭头函数的this指向了外层</span>(<span class="attr">当前对象</span>)</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    // <span class="attr">如果没有特殊处理</span>，<span class="attr">在事件处理函数中</span>，<span class="attr">this指向undefined</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">number</span>=<span class="string">&#123;10&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;status&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>使用bind函数，绑定this</li>
<li>使用箭头函数</li>
</ol>
<h2 id="五、深入认识setState"><a href="#五、深入认识setState" class="headerlink" title="五、深入认识setState"></a>五、深入认识setState</h2><p>setState，它对状态的改变，<strong>可能</strong>是异步的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">n</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">n</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">n</span> + <span class="number">1</span></span><br><span class="line">        &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">n</span>); <span class="comment">// 状态改变后触发，该回调运行在render后面</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// setState可以接收第二个参数，状态改变完成后再执行</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">n</span>); <span class="comment">//0 还没有重新渲染，说明目前状态仍然没有改变。如果是同步的就是修改完立即执行render函数，先输出render,在输出值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;this.state.n&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果改变状态的代码处于某个HTML元素的事件中，则其是异步的，否则是同步</p>
</blockquote>
<p>如果遇到某个事件中，需要同步调用多次，需要使用函数的方式得到最新状态</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">n</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// constructor(props) &#123;</span></span><br><span class="line">    <span class="comment">//     super(props);</span></span><br><span class="line">    <span class="comment">//     setInterval(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//         this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//             n: this.state.n + 1</span></span><br><span class="line">    <span class="comment">//         &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//         this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//             n: this.state.n + 1</span></span><br><span class="line">    <span class="comment">//         &#125;);</span></span><br><span class="line">    <span class="comment">//         this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//             n: this.state.n + 1</span></span><br><span class="line">    <span class="comment">//         &#125;);</span></span><br><span class="line">    <span class="comment">//     &#125;, 1000)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     n: this.state.n + 1</span></span><br><span class="line">        <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     n: this.state.n + 1</span></span><br><span class="line">        <span class="comment">// &#125;);</span></span><br><span class="line">        <span class="comment">// this.setState(&#123;</span></span><br><span class="line">        <span class="comment">//     n: this.state.n + 1</span></span><br><span class="line">        <span class="comment">// &#125;);</span></span><br><span class="line">        <span class="comment">// 上面这种写法无论点多少次，结果都只会加1，因为这是异步的，状态更新前n都是0，可以看成this.setState(&#123; n: 1&#125;)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function"><span class="params">cur</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//参数cur表示当前的状态</span></span><br><span class="line">            <span class="comment">//该函数的返回结果，会混合（覆盖）掉之前的状态</span></span><br><span class="line">            <span class="comment">//该函数是异步执行</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">n</span>: cur.<span class="property">n</span> + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">//所有状态全部更新完成，并且重新渲染后执行</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;state更新完成&quot;</span>, <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">n</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function"><span class="params">cur</span> =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">n</span>: cur.<span class="property">n</span> + <span class="number">1</span></span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="function"><span class="params">cur</span> =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">n</span>: cur.<span class="property">n</span> + <span class="number">1</span></span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="comment">// 可以把看成把这三次调用放到一个队列里面了，每次都是把上一次的返回结果，传给下个函数的cur。后面分析源码会讲到</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 上面三个setState执行完后才会重新渲染一次，React会对异步的setState进行优化，将多次setState进行合并</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;this.state.n&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>最佳实践：</p>
<ol>
<li>把所有的setState当作是异步的</li>
<li>永远不要信任setState调用之后的状态</li>
<li>如果要使用改变之后的状态，需要使用回调函数（setState的第二个参数）</li>
<li>如果新的状态要根据之前的状态进行运算，使用函数的方式改变状态（setState的第一个函数）</li>
</ol>
<p>React会对异步的setState进行优化，将多次setState进行合并（将多次状态改变完成后，再统一对state进行改变，然后触发render）</p>
<blockquote>
<p>为什么要这么做呢，因为按照一般情况，事件处理最后的事件往往都是html元素的事件，比如点击事件，鼠标移入事件…</p>
</blockquote>
<h2 id="六、生命周期"><a href="#六、生命周期" class="headerlink" title="六、生命周期"></a>六、生命周期</h2><p>生命周期：组件从诞生到销毁会经历一系列的过程，该过程就叫做生命周期。React在组件的生命周期中提供了一系列的钩子函数（类似于事件），可以让开发者在函数中注入代码，这些代码会在适当的时候运行。</p>
<p><strong>生命周期仅存在于类组件中，函数组件每次调用都是重新运行函数，旧的组件即刻被销毁</strong></p>
<blockquote>
<p>类组件的生命周期，相当于new的对象的生命周期</p>
</blockquote>
<h3 id="1-旧版生命周期"><a href="#1-旧版生命周期" class="headerlink" title="1.旧版生命周期"></a>1.旧版生命周期</h3><p>React &lt; 16.0.0，在16.18.6版本旧版生命周期还能使用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/12/19/6763e63d98568.png" alt="旧版生命周期"></p>
<ol>
<li><p>constructor</p>
<ol>
<li>同一个组件对象只会创建一次。&lt;哪怕该组件使用的props中的内容发生了改变，也不会重新创建&gt;</li>
<li>不能在第一次挂载到页面之前，调用setState，为了避免问题，构造函数中严禁使用setState。&lt;在计时器中可以调用是因为是异步的，调用的时候组件已挂载完成&gt;</li>
</ol>
</li>
<li><p>componentWillMount&lt;新版已移除&gt;</p>
<ol>
<li>正常情况下，和构造函数一样，它只会运行一次</li>
<li>可以使用setState，但是为了避免bug，不允许使用，因为在某些特殊情况下，该函数可能被调用多次。&lt;在生命周期一开始的阶段，还没挂载完成的时候，该生命周期被打断，然后重新来一次&gt;</li>
</ol>
</li>
<li><p><strong>render</strong></p>
<ol>
<li>返回一个虚拟DOM，会被挂载到虚拟DOM树中，最终渲染到页面的真实DOM中</li>
<li>render可能不只运行一次，只要需要重新渲染，就会重新运行</li>
<li>严禁使用setState，因为可能会导致无限递归渲染</li>
</ol>
</li>
<li><p><strong>componentDidMount</strong></p>
<ol>
<li>只会执行一次</li>
<li>可以使用setState</li>
<li>通常情况下，会将网络请求、启动计时器等一开始需要的操作，书写到该函数中</li>
</ol>
</li>
<li><p>组件进入活跃状态，就是已经完成，等待组件状态发生改变</p>
</li>
<li><p>componentWillReceiveProps&lt;新版已移除&gt;</p>
<ol>
<li>即将接收新的属性值</li>
<li>会接收一个参数，参数为新的属性对象</li>
<li>该函数可能会导致一些bug，所以不推荐使用。有些开发者的操作可能是一种反模式&lt;不好的做法&gt;，React官方认为，某个数据的来源是单一的，不能既由属性控制，也由状态控制。</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">n</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">n</span> <span class="comment">// 这时这个state.n的值，既由父组件传过来的props控制，也由子组件自己的状态控制</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillReceiveProps</span>(<span class="params">nextProps</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">n</span>: nextProps.<span class="property">n</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>数字：&#123;this.state.n&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            n: this.state.n + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;n加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>shouldComponentUpdate</strong></p>
<ol>
<li>指示React是否要重新渲染该组件，通过返回true和false来指定，一般可以用于性能优化</li>
<li>默认情况下，会直接返回true</li>
<li>状态和属性变化都会重新运行该函数，另外状态发生改变指的是状态被重新赋值调用，<code>state.n = 1</code>，重新<code>setState(&#123; n: 1 &#125;)</code>，也会重新运行。可以通过<code>return false</code> 来避免重新渲染</li>
</ol>
</li>
<li><p>componentWillUpdate</p>
<ol>
<li>组件即将被重新渲染</li>
</ol>
</li>
<li><p>componentDidUpdate</p>
<ol>
<li>往往在该函数中使用dom操作，改变元素(用法)</li>
<li>可以接收两个参数，分别为更新前的属性和状态</li>
</ol>
</li>
<li><p><strong>componentWillUnmount</strong></p>
<ol>
<li>通常在该函数中销毁一些组件依赖的资源，比如计时器</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">OldLifeCycle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">n</span>: <span class="number">0</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;一个新的组件诞生了！！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentWillMount&quot;</span>, <span class="string">&quot;组件即将被挂载&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidMount&quot;</span>, <span class="string">&quot;挂载完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillReceiveProps</span>(<span class="params">nextProps</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentWillReceiveProps&quot;</span>, <span class="string">&quot;接收到新的属性值&quot;</span>, <span class="variable language_">this</span>.<span class="property">props</span>, nextProps);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;shouldComponentUpdate&quot;</span>, <span class="string">&quot;是否应该重新渲染&quot;</span>, <span class="variable language_">this</span>.<span class="property">props</span>, nextProps, <span class="variable language_">this</span>.<span class="property">state</span>, nextState)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">n</span> === nextProps.<span class="property">n</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">n</span> === nextState.<span class="property">n</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">// return false;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentWillUpdate&quot;</span>, <span class="string">&quot;组件即将被重新渲染&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps, prevState</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>, <span class="string">&quot;组件已完成重新渲染&quot;</span>, prevProps, prevState);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentWillUnmount&quot;</span>, <span class="string">&quot;组件被销毁&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;render&quot;</span>, <span class="string">&quot;渲染，返回的React元素会被挂载到虚拟DOM树中&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>旧版生命周期组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>属性n: &#123;this.props.n&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span>状态n：&#123;this.state.n&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                        n: this.state.n + 1</span></span><br><span class="line"><span class="language-xml">                    &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;&gt;状态n+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-新版生命周期"><a href="#2-新版生命周期" class="headerlink" title="2.新版生命周期"></a>2.新版生命周期</h3><p>React &gt;&#x3D; 16.0.0</p>
<p>React官方认为，某个数据的来源必须是单一的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2024/12/19/6763e6b1cf9ee.png" alt="新版生命周期"></p>
<ol>
<li>getDerivedStateFromProps<ol>
<li>通过参数可以获取新的属性和状态</li>
<li>该函数是静态的，是类本身的函数，不是实例上的函数，没有this</li>
<li>该函数的返回值会覆盖掉组件状态</li>
<li>该函数几乎是没有什么用</li>
</ol>
</li>
<li>getSnapshotBeforeUpdate<ol>
<li>真实的DOM构建完成，但还未实际渲染到页面中。</li>
<li>在该函数中，通常用于实现一些附加的dom操作</li>
<li>该函数的返回值，会作为componentDidUpdate的第三个参数</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewLifeCycle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">n</span>: <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">n</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// static getDerivedStateFromProps(props, state) &#123;</span></span><br><span class="line">    <span class="comment">//     this.setState(&#123; n: props &#125;); 用不了，this指向构造函数</span></span><br><span class="line">    <span class="comment">//     console.log(&quot;getDerivedStateFromProps&quot;);</span></span><br><span class="line">    <span class="comment">//     // return null;//不改变当前状态</span></span><br><span class="line">    <span class="comment">//     return &#123; //用新的对象替换掉之前的状态，此时用点击事件直接改变state不管用，因为改变状态，也会触发这个函数，props是不变的，所以n不会改变</span></span><br><span class="line">    <span class="comment">//         n: props.n</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    getSnapshotBeforeUpdate = <span class="function">(<span class="params">prevProps, prevState</span>) =&gt;</span> &#123;<span class="comment">// 之前的属性和状态</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getSnapshotBeforeUpdate&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">132</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps, prevState, snap</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;componentDidUpdate&quot;</span>, snap);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.state.n&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            n: this.state.n + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、传递元素内容（vue中插槽）"><a href="#七、传递元素内容（vue中插槽）" class="headerlink" title="七、传递元素内容（vue中插槽）"></a>七、传递元素内容（vue中插槽）</h2><p>内置组件：div、h1、p</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">	asdfafasfafasdfasdf</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果给自定义组件传递元素内容，则React会将元素内容作为children属性传递过去。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Comp</span> <span class="keyword">from</span> <span class="string">&quot;./Comp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>((</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Comp</span> <span class="attr">content1</span>=<span class="string">&#123;</span>&lt;<span class="attr">h2</span>&gt;</span>第2组元素内容<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>&#125; content2=&#123;<span class="tag">&lt;<span class="name">h2</span>&gt;</span>第3组元素内容<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>第1组元素内容<span class="tag">&lt;/<span class="name">h2</span>&gt;</span> // 相当于传了个children,语法糖</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Comp</span>&gt;</span></span></span><br><span class="line">), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Comp</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;comp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>组件自身的内容<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* &#123;props.children || <span class="tag">&lt;<span class="name">h1</span>&gt;</span>默认值<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>&#125; */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;props.children&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;props.content1&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;props.content2&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>补充</strong>：<code>order</code>可以设置弹性盒子的排列顺序<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/order">order - CSS：层叠样式表 | MDN</a></p>
<h2 id="八、表单"><a href="#八、表单" class="headerlink" title="八、表单"></a>八、表单</h2><p>受控组件和非受控组件</p>
<p>受控组件：组件的使用者，有能力完全控制该组件的行为和内容。通常情况下，受控组件往往没有自身的状态，其内容完全收到属性的控制。</p>
<p>非受控组件：组件的使用者，没有能力控制该组件的行为和内容，组件的行为和内容完全自行控制。</p>
<p><strong>表单组件，默认情况下是非受控组件，一旦设置了表单组件的value属性，则其变为受控组件(单选和多选框需要设置checked)</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表单的简单使用</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">FormTest</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">loginId</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">loginPwd</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">sex</span>: <span class="string">&quot;male&quot;</span>,</span><br><span class="line">        <span class="attr">chooseLoves</span>: [],</span><br><span class="line">        <span class="attr">loves</span>: [</span><br><span class="line">            &#123; <span class="attr">value</span>: <span class="string">&quot;football&quot;</span>, <span class="attr">text</span>: <span class="string">&quot;足球&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">value</span>: <span class="string">&quot;basetball&quot;</span>, <span class="attr">text</span>: <span class="string">&quot;篮球&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">value</span>: <span class="string">&quot;movie&quot;</span>, <span class="attr">text</span>: <span class="string">&quot;电影&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">value</span>: <span class="string">&quot;music&quot;</span>, <span class="attr">text</span>: <span class="string">&quot;音乐&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">value</span>: <span class="string">&quot;other&quot;</span>, <span class="attr">text</span>: <span class="string">&quot;其他&quot;</span> &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">city</span>: <span class="string">&quot;beijing&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> val = e.<span class="property">target</span>.<span class="property">value</span>; <span class="comment">//读取表单的值</span></span><br><span class="line">        <span class="keyword">let</span> name = e.<span class="property">target</span>.<span class="property">name</span>; <span class="comment">//读取表单的name属性</span></span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">type</span> === <span class="string">&quot;checkbox&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">//对val进行特殊处理</span></span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">checked</span>) &#123;</span><br><span class="line">                val = [...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">chooseLoves</span>, val];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                val = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">chooseLoves</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">it</span> =&gt;</span> it !== val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// const newPartialState = &#123;&#125;;</span></span><br><span class="line">        <span class="comment">// newPartialState[name] = val;</span></span><br><span class="line">        <span class="comment">// this.setState(newPartialState)</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            [name]: val</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有的爱好多选框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getLoveCheckBoxes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> bs = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">loves</span>.<span class="title function_">map</span>(<span class="function"><span class="params">it</span> =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">key</span>=<span class="string">&#123;it.value&#125;</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;chooseLoves&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">value</span>=<span class="string">&#123;it.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">checked</span>=<span class="string">&#123;this.state.chooseLoves.includes(it.value)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;it.text&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        ));</span><br><span class="line">        <span class="keyword">return</span> bs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// const bs = this.getLoveCheckBoxes(); </span></span><br><span class="line">    <span class="comment">// 也可以在这里调用，这样修改后，getLoveCheckBoxes函数只会在组件实例化的时候被调用一次，生成的多选框元素数组就会被缓存下来。如果后续组件的state中与		 多选框相关的状态（比如chooseLoves等）发生了改变，界面上显示的多选框不会自动更新来反映新的状态，因为它使用的是一开始缓存的结果。</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> bs = <span class="variable language_">this</span>.<span class="title function_">getLoveCheckBoxes</span>();</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">name</span>=<span class="string">&quot;loginId&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">value</span>=<span class="string">&#123;this.state.loginId&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">name</span>=<span class="string">&quot;loginPwd&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">value</span>=<span class="string">&#123;this.state.loginPwd&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">value</span>=<span class="string">&quot;male&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">checked</span>=<span class="string">&#123;this.state.sex</span> === <span class="string">&quot;male&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        男</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">value</span>=<span class="string">&quot;female&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">checked</span>=<span class="string">&#123;this.state.sex</span> === <span class="string">&quot;female&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                            <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        女</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;bs&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;city&quot;</span> <span class="attr">value</span>=<span class="string">&#123;this.state.city&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    &gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;beijing&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;shanghai&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;chengdu&quot;</span>&gt;</span>成都<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        console.log(this.state)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;获取表单数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>简单的封装多选框CheckBoxGroup</strong></p>
<p><strong>属性</strong></p>
<ol>
<li>datas：一个数组，数组每一项是一个对象，对应一个多选框<ol>
<li>对象具有value和text属性</li>
<li>value：多选框的值</li>
<li>text：多选框的文本</li>
</ol>
</li>
</ol>
<p>例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">datas = [</span><br><span class="line">    &#123;<span class="attr">value</span>:<span class="string">&quot;football&quot;</span>, <span class="attr">text</span>:<span class="string">&quot;足球&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">value</span>:<span class="string">&quot;basketball&quot;</span>, <span class="attr">text</span>:<span class="string">&quot;篮球&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">value</span>:<span class="string">&quot;movie&quot;</span>, <span class="attr">text</span>:<span class="string">&quot;电影&quot;</span>&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>name：每一个多选框的name属性值</li>
<li>chooseDatas: 数组，表示当前选中的value值</li>
<li>onChange：当选中项发生改变时的事件</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一组多选框</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">CheckBoxGroup</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> newArr;</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">checked</span>) &#123;</span><br><span class="line">            newArr = [...<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>, e.<span class="property">target</span>.<span class="property">value</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            newArr = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">it</span> =&gt;</span> it !== e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onChange</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onChange</span>(newArr, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">name</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到一组多选框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getCheckBoxes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">datas</span>.<span class="title function_">map</span>(<span class="function"><span class="params">it</span> =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">key</span>=<span class="string">&#123;it.value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">name</span>=<span class="string">&#123;this.props.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">value</span>=<span class="string">&#123;it.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">checked</span>=<span class="string">&#123;this.props.chooseDatas.includes(it.value)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;it.text&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> bs = <span class="variable language_">this</span>.<span class="title function_">getCheckBoxes</span>();</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;bs&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="React进阶"><a href="#React进阶" class="headerlink" title="React进阶"></a>React进阶</h1><h2 id="一、属性默认值和类型检查"><a href="#一、属性默认值和类型检查" class="headerlink" title="一、属性默认值和类型检查"></a>一、属性默认值和类型检查</h2><h3 id="1-属性默认值"><a href="#1-属性默认值" class="headerlink" title="1.属性默认值"></a>1.属性默认值</h3><p>通过一个静态属性<code>defaultProps</code>告知react属性默认值</p>
<p><em>函数式组件</em></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数式组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">FuncDefault</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props);<span class="comment">//已经完成了混合，在调用函数之前就完成了</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            a:&#123;props.a&#125;，b:&#123;props.b&#125;，c:&#123;props.c&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//属性默认值</span></span><br><span class="line"><span class="title class_">FuncDefault</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>类组件</em></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ClassDefault</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 另外的写法</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">c</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(props); <span class="comment">// 已经完成了混合，在运行构造函数之前就混合了，先混合然后在用props传过来</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                a:&#123;this.props.a&#125;，b:&#123;this.props.b&#125;，c:&#123;this.props.c&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// //属性默认值</span></span><br><span class="line"><span class="comment">// ClassDefault.defaultProps = &#123;</span></span><br><span class="line"><span class="comment">//     a: 1,</span></span><br><span class="line"><span class="comment">//     b: 2,</span></span><br><span class="line"><span class="comment">//     c: 3</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-属性类型检查"><a href="#2-属性类型检查" class="headerlink" title="2.属性类型检查"></a>2.属性类型检查</h3><p>使用库：<code>prop-types</code>，react官方出品，只会控制台报错，不会影响代码执行</p>
<p>对组件使用静态属性<code>propTypes</code>告知react如何检查属性，状态不需要类型检查，因为状态是自己管理的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">any</span>：<span class="comment">//任意类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">array</span>：<span class="comment">//数组类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">bool</span>：<span class="comment">//布尔类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">func</span>：<span class="comment">//函数类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">number</span>：<span class="comment">//数字类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">object</span>：<span class="comment">//对象类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">string</span>：<span class="comment">//字符串类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">symbol</span>：<span class="comment">//符号类型</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">node</span>：<span class="comment">//任何可以被渲染的内容，字符串、数字、React元素</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">element</span>：<span class="comment">//react元素</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="property">elementType</span>：<span class="comment">//react元素类型</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">instanceOf</span>(构造函数)：<span class="comment">//必须是指定构造函数的实例</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">oneOf</span>([xxx, xxx])：<span class="comment">//枚举</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">oneOfType</span>([xxx, xxx]);  <span class="comment">//属性类型必须是数组中的其中一个</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">arrayOf</span>(<span class="title class_">PropTypes</span>.<span class="property">XXX</span>)：<span class="comment">//必须是某一类型组成的数组</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">objectOf</span>(<span class="title class_">PropTypes</span>.<span class="property">XXX</span>)：<span class="comment">//对象由某一类型的值组成</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(对象): <span class="comment">//属性必须是对象，并且满足指定的对象要求</span></span><br><span class="line"><span class="title class_">PropTypes</span>.<span class="title function_">exact</span>(&#123;...&#125;)：<span class="comment">//对象必须精确匹配传递的数据，和shape用法一样，但是不能有额外的属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义属性检查，如果有错误，返回错误对象即可</span></span><br><span class="line">属性: <span class="keyword">function</span>(<span class="params">props, propName, componentName</span>) &#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>简单使用</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ValidationComp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="comment">//先混合属性</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        <span class="attr">b</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//再调用相应的函数进行验证</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span>,  <span class="comment">//a属性必须是一个数字类型,并且必填</span></span><br><span class="line">        <span class="attr">b</span>: <span class="title class_">PropTypes</span>.<span class="property">bool</span>.<span class="property">isRequired</span>, <span class="comment">//b必须是一个bool属性,并且必填</span></span><br><span class="line">        <span class="attr">onClick</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>, <span class="comment">//onClick必须是一个函数</span></span><br><span class="line">        <span class="attr">c</span>: <span class="title class_">PropTypes</span>.<span class="property">any</span>, <span class="comment">//1. 可以设置必填   2. 阵型保持整齐（所有属性都在该对象中）</span></span><br><span class="line">        <span class="attr">d</span>: <span class="title class_">PropTypes</span>.<span class="property">node</span>.<span class="property">isRequired</span>, <span class="comment">//d必填，而且必须是一个可以渲染的内容，字符串、数字、React元素,null和undefind可以，因为react会认为你什么都没传，如果加了isRequired就不行了</span></span><br><span class="line">        <span class="attr">e</span>: <span class="title class_">PropTypes</span>.<span class="property">element</span>, <span class="comment">//e必须是一个React元素</span></span><br><span class="line">        <span class="attr">F</span>: <span class="title class_">PropTypes</span>.<span class="property">elementType</span>, <span class="comment">//F必须是一个组件类型，如果是函数组件就把函数名写进去，类组件就把类名写进去，也就是分别传入函数和构造函数，比如叫做Com,子组件接收到可以使用 const C = this.props.F;&#123; &lt; F/&gt; &#125;。&#123; &lt; this.props.F /&gt;&#125; 不能这样用因为语法不支持</span></span><br><span class="line">        <span class="attr">g</span>: <span class="title class_">PropTypes</span>.<span class="title function_">instanceOf</span>(A), <span class="comment">//g必须是A的实例</span></span><br><span class="line">        <span class="attr">sex</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOf</span>([<span class="string">&quot;男&quot;</span>, <span class="string">&quot;女&quot;</span>]), <span class="comment">//属性必须是数组当中的一个</span></span><br><span class="line">        <span class="attr">h</span>: <span class="title class_">PropTypes</span>.<span class="title function_">arrayOf</span>(<span class="title class_">PropTypes</span>.<span class="property">number</span>), <span class="comment">//数组的每一项必须满足类型要求</span></span><br><span class="line">        <span class="attr">i</span>: <span class="title class_">PropTypes</span>.<span class="title function_">objectOf</span>(<span class="title class_">PropTypes</span>.<span class="property">number</span>), <span class="comment">//每一个属性必须满足类型要求</span></span><br><span class="line">        <span class="attr">j</span>: <span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123; <span class="comment">//属性必须满足该对象的要求</span></span><br><span class="line">            <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>, <span class="comment">//name必须是一个字符串，必填</span></span><br><span class="line">            <span class="attr">age</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>, <span class="comment">//age必须是一个数字</span></span><br><span class="line">            <span class="attr">address</span>: <span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123;</span><br><span class="line">                <span class="attr">province</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>,</span><br><span class="line">                <span class="attr">city</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">k</span>: <span class="title class_">PropTypes</span>.<span class="title function_">arrayOf</span>(<span class="title class_">PropTypes</span>.<span class="title function_">shape</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>.<span class="property">isRequired</span></span><br><span class="line">        &#125;)),</span><br><span class="line">        <span class="attr">m</span>: <span class="title class_">PropTypes</span>.<span class="title function_">oneOfType</span>([<span class="title class_">PropTypes</span>.<span class="property">string</span>, <span class="title class_">PropTypes</span>.<span class="property">number</span>]),</span><br><span class="line">        <span class="attr">score</span>: <span class="keyword">function</span> (<span class="params">props, propName, componentName</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(props, propName, componentName); <span class="comment">// 所有属性，属性名，组件名</span></span><br><span class="line">            <span class="keyword">const</span> val = props[propName];</span><br><span class="line">            <span class="comment">//必填</span></span><br><span class="line">            <span class="keyword">if</span> (val === <span class="literal">undefined</span> || val === <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`invalid prop <span class="subst">$&#123;propName&#125;</span> in <span class="subst">$&#123;componentName&#125;</span>，<span class="subst">$&#123;propName&#125;</span> is Required`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//该属性必须是一个数字</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> val !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`invalid prop <span class="subst">$&#123;propName&#125;</span> in <span class="subst">$&#123;componentName&#125;</span>，<span class="subst">$&#123;propName&#125;</span> is not a number`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// const err = PropTypes.number.isRequired(props, propName, componentName); 不支持直接调用这些函数</span></span><br><span class="line">            <span class="comment">// if(err)&#123;</span></span><br><span class="line">            <span class="comment">//     return err;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">//并且取值范围是0~100</span></span><br><span class="line">            <span class="keyword">if</span> (val &lt; <span class="number">0</span> || val &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`invalid prop <span class="subst">$&#123;propName&#125;</span> in <span class="subst">$&#123;componentName&#125;</span>，<span class="subst">$&#123;propName&#125;</span> must is between 0 and 100`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> F = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">F</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;this.props.a&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;this.props.d&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">F</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Demo"><a href="#3-Demo" class="headerlink" title="3.Demo"></a>3.Demo</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CheckBoxGroup组件加类型约束</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> types <span class="keyword">from</span> <span class="string">&quot;../../../utils/commonTypes&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一组多选框</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">CheckBoxGroup</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认属性值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> defaulProps = &#123;</span><br><span class="line">        <span class="attr">datas</span>: [],</span><br><span class="line">        <span class="attr">chooseDatas</span>: []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">datas</span>: types.<span class="property">groupDatas</span>.<span class="property">isRequired</span>, <span class="comment">// PropTypes.arrayOf(PropTypes.shape(&#123;value: PropTypes.string.isRequired,text: 		                                                PropTypes.string.isRequired&#125;)),</span></span><br><span class="line">        <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">chooseDatas</span>: types.<span class="property">chooseDatas</span>, <span class="comment">// PropTypes.arrayOf(PropTypes.string)</span></span><br><span class="line">        <span class="attr">onChange</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> newArr;</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">checked</span>) &#123;</span><br><span class="line">            newArr = [...<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>, e.<span class="property">target</span>.<span class="property">value</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            newArr = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">it</span> =&gt;</span> it !== e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onChange</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onChange</span>(newArr, <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">name</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到一组多选框</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getCheckBoxes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">datas</span>.<span class="title function_">map</span>(<span class="function"><span class="params">it</span> =&gt;</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">label</span> <span class="attr">key</span>=<span class="string">&#123;it.value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">name</span>=<span class="string">&#123;this.props.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">value</span>=<span class="string">&#123;it.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">checked</span>=<span class="string">&#123;this.props.chooseDatas.includes(it.value)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;it.text&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> bs = <span class="variable language_">this</span>.<span class="title function_">getCheckBoxes</span>();</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;bs&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、HOC-高阶组件"><a href="#二、HOC-高阶组件" class="headerlink" title="二、HOC 高阶组件"></a>二、HOC 高阶组件</h2><p>HOF：Higher-Order Function, 高阶函数，以函数作为参数，并返回一个函数<br>HOC: Higher-Order Component, 高阶组件，以组件作为参数，并返回一个组件</p>
<p>一般创建HOC文件夹，组件名称一般是with开头</p>
<p>通常，可以利用HOC实现横切关注点。</p>
<blockquote>
<p>举例：20个组件，每个组件在创建组件和销毁组件时，需要作日志记录<br>20个组件，它们需要显示一些内容，得到的数据结构完全一致</p>
<p>简单来说就是把一些组件的公共代码给抽离出去进行二次封装</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/HOC/withLog.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 高阶组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; comp 组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withLog</span>(<span class="params">Comp, str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">LogWrapper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志：组件<span class="subst">$&#123;Comp.name&#125;</span>被创建了！<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志：组件<span class="subst">$&#123;Comp.name&#125;</span>被销毁了！<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;str&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span> // 这样是为了让Comp组件接收到属性</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/HOC/withLogin.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withLogin</span>(<span class="params">Comp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">LoginWrapper</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (props.<span class="property">isLogin</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span> <span class="comment">// 这样是为了让Comp组件接收到属性</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; A, B &#125; <span class="keyword">from</span> <span class="string">&quot;./components/Comps&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> withLog <span class="keyword">from</span> <span class="string">&quot;./HOC/withLog&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> withLogin <span class="keyword">from</span> <span class="string">&quot;./HOC/withLogin&quot;</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">AComp</span> = <span class="title function_">withLogin</span>(<span class="title function_">withLog</span>(A, <span class="string">&quot;abc&quot;</span>));</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">BComp</span> = <span class="title function_">withLogin</span>(<span class="title function_">withLog</span>(B, <span class="string">&quot;Bcd&quot;</span>));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// let AComp = withLogin(withLog(A, &quot;abc&quot;)); 不要写在这里</span></span><br><span class="line">		<span class="comment">// let BComp = withLogin(withLog(B, &quot;Bcd&quot;));</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">AComp</span> <span class="attr">isLogin</span> <span class="attr">a</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">BComp</span> <span class="attr">isLogin</span> <span class="attr">b</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    this.setState(&#123;&#125;) // 更改状态让render重新运行</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;&gt;点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ol>
<li>不要在render中使用高阶组件</li>
</ol>
<blockquote>
<p>因为类组件会把类组件中的对象重用，如果写在render函数中每次调用render都会创建一个新的类，尽管这个类和以前完全一样，但是它仍然需要重新创建对象，也就是重新创建一个组件，从而导致之前的组件被销毁。</p>
</blockquote>
<ol start="2">
<li>不要在高阶组件内部更改传入的组件</li>
</ol>
<p><strong>Demo之用hoc改造CheckBoxGroup组件</strong>：这里没看懂可以回去看视频，暗含装饰器模式，抽象思维。写组件的时候不要直接想着咋抽象，要慢慢来，先完成再慢慢抽离。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> types <span class="keyword">from</span> <span class="string">&quot;../../../utils/commonTypes&quot;</span></span><br><span class="line"><span class="comment">//实现根据数据渲染出的一组表单组件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withDataGroup</span>(<span class="params">Comp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">DataGroupWrapper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">            <span class="attr">datas</span>: []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">            <span class="attr">datas</span>: types.<span class="property">groupDatas</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> comps = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">datas</span>.<span class="title function_">map</span>(<span class="function"><span class="params">it</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Comp</span> <span class="attr">key</span>=<span class="string">&#123;it.value&#125;</span> <span class="attr">info</span>=<span class="string">&#123;it&#125;</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;comps&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> types <span class="keyword">from</span> <span class="string">&quot;../../../utils/commonTypes&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span></span><br><span class="line"><span class="keyword">import</span> withDataGroup <span class="keyword">from</span> <span class="string">&quot;../hoc/withDataGroup&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CheckBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">onChange</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span>,</span><br><span class="line">        <span class="attr">info</span>: types.<span class="property">singleData</span>.<span class="property">isRequired</span>,</span><br><span class="line">        <span class="attr">chooseDatas</span>: types.<span class="property">chooseDatas</span>.<span class="property">isRequired</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> newArr;</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">checked</span>) &#123;</span><br><span class="line">            newArr = [...<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>, e.<span class="property">target</span>.<span class="property">value</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            newArr = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">chooseDatas</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">it</span> =&gt;</span> it !== e.<span class="property">target</span>.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onChange</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onChange</span>(newArr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">name</span>=<span class="string">&#123;this.props.name&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;this.props.info.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">checked</span>=<span class="string">&#123;this.props.chooseDatas.includes(this.props.info.value)&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;this.props.info.text&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一组多选框</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withDataGroup</span>(<span class="title class_">CheckBox</span>);</span><br></pre></td></tr></table></figure>

<h2 id="三、ref"><a href="#三、ref" class="headerlink" title="三、ref"></a>三、ref</h2><p>reference: 引用</p>
<p>场景：希望直接使用dom元素中的某个方法，或者希望直接使用自定义组件中的某个方法</p>
<blockquote>
<p>和vue2差不多，在类组件中直接打印this，this中会有一个refs’属性’，里面会有绑定ref属性的组件相应的dom实例。</p>
<p>ref虽然写法有点像属性传递，但是并不是一个属性，子组件接收不到</p>
</blockquote>
<ol>
<li>ref作用于内置的html组件，得到的将是真实的dom对象</li>
<li>ref作用于类组件，得到的将是类的实例</li>
<li>ref不能作用于函数组件 ，因为这样没有意义，函数里面又没有实例方法…</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">method</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;调用了组件A的方法&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>组件A<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function B()&#123;</span></span><br><span class="line"><span class="comment">//     return &lt;h1&gt;组件B&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">refs</span>.<span class="property">txt</span>.<span class="title function_">focus</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">refs</span>.<span class="property">compA</span>.<span class="title function_">method</span>(); <span class="comment">// 调用对象实例里面的方法</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&quot;txt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">A</span> <span class="attr">ref</span>=<span class="string">&quot;compA&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* <span class="tag">&lt;<span class="name">B</span> <span class="attr">ref</span>=<span class="string">&quot;compB&quot;</span> /&gt;</span> */&#125; // 会报错因为没有意义 </span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>聚焦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ref不再推荐使用字符串赋值，字符串赋值的方式将来可能会被移出</p>
<p>目前，ref推荐使用对象或者是函数</p>
<p><strong>对象</strong></p>
<p>通过 React.createRef 函数创建</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">txt</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>(); <span class="comment">// 一般是在构造函数里面直接创建好，避免每次render都会重新创建。放在了当前对象的txt属性里面，txt里面的											 current属性就是相应的实例，一开始为null，会在组件第一次渲染的时候赋值。并且这时this.refs为null</span></span><br><span class="line">        <span class="comment">// this.text= &#123; current:null &#125;; 这样写也可以，但是这样写会涉及效率问题，后面会说</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// txt = React.createRef(); 也可以直接写在这里</span></span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">txt</span>.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;this.txt&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>聚焦<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>函数</strong></p>
<p>函数的调用时间：</p>
<ol>
<li>componentDidMount的时候会调用该函数<ol>
<li>在componentDidMount事件中可以使用ref</li>
</ol>
</li>
<li>如果ref的值发生了变动（旧的函数被新的函数替代），分别调用旧的函数以及新的函数，时间点出现在componentDidUpdate之前<ol>
<li>旧的函数被调用时，传递null</li>
<li>新的函数被调用时，传递对象</li>
<li>为了防止这种现象的发生，ref应该不能使用箭头函数，就像<code>ref = &#123; el =&gt; this.txt = el&#125;</code>，这样每次都会创建一个新的函数。应该写成对象的实例方法，这样每次给的都是同一个函数。</li>
</ol>
</li>
<li>如果ref所在的组件被卸载，会调用函数</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Comp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleClick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// this.txt.focus(); 不用使用current了</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">show</span>: !<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">show</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;didMount&quot;</span>, <span class="variable language_">this</span>.<span class="property">txt</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getRef = <span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数被调用了&quot;</span>, el);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">txt</span> = el;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    this.state.show &amp;&amp; <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;this.getRef&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>显示/隐藏<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>谨慎使用ref</strong></p>
<p>能够使用属性和状态进行控制，就不要使用ref，它与react理念不符合，有点反模式。</p>
<ol>
<li>调用真实的DOM对象中的方法</li>
<li>某个时候需要调用类组件的方法</li>
</ol>
<p><strong>补充</strong>:demo制作轮播图组件<a target="_blank" rel="noopener" href="https://pan.baidu.com/pfile/video?path=/%E6%88%91%E7%9A%84/%E6%B8%A1%E4%B8%80%E6%95%99%E8%82%B2-%E5%89%8D%E7%AB%AF%E5%A4%A7%E5%B8%88%E8%AF%BE/02+%E5%B0%B1%E4%B8%9A%E6%8F%90%E5%8D%87/07+React/3-6.+%5Bdemo%5D%E5%88%B6%E4%BD%9C%E8%BD%AE%E6%92%AD%E5%9B%BE%E7%BB%84%E4%BB%B6%E3%80%90itjc8.com%E3%80%91.mp4">百度网盘 - 视频播放</a></p>
<ul>
<li>有时候直接操作<code>dom</code>比<code>setState</code>重新渲染效率要高，因为<code>setState</code>重新后重新<code>render</code>会经过<code>diff</code>算法，还有一系列生命周期等。</li>
</ul>
<h2 id="四、Ref转发"><a href="#四、Ref转发" class="headerlink" title="四、Ref转发"></a>四、Ref转发</h2><p>forwardRef</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引出Ref转发。在这里我们是想获取A组件的组件实例，但是A组件是函数式组件无意义。我们此时想获取A组件中的h1标签的dom实例，就需要使用ref转发</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        组件A</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">ARef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">A</span> <span class="attr">ref</span>=<span class="string">&#123;this.ARef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* this.ARef.current:  h1 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>实现方法</em></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">props, ref</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;<span class="attr">words</span>:<span class="string">&quot;asfsafasfasfs&quot;</span>&#125;,&#123;<span class="attr">current</span>:<span class="literal">null</span>&#125;) <span class="comment">// h1没绑定ref的时候</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        组件A</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;props.words&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//传递函数组件A，得到一个新组件NewA,和组件A的使用方法一样，React.forwardRef相当于一个高阶组件。</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewA</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(A);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">ARef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ARef</span>); </span><br><span class="line">        <span class="comment">// .current = null 什么都没得到，因为ref还没确定转发给谁(h1没绑定ref的时候),等于把ref给A组件来处理了，它决定来绑定谁</span></span><br><span class="line">        <span class="comment">// h1绑定ref的时候，.urrent = h1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* 等于把ref传了进去 */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">NewA</span> <span class="attr">ref</span>=<span class="string">&#123;this.ARef&#125;</span> <span class="attr">words</span>=<span class="string">&quot;asfsafasfasfs&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* this.ARef.current:  h1 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forwardRef方法：</p>
<ol>
<li>参数，传递的是函数组件，不能是类组件，并且，函数组件需要有第二个参数来得到ref</li>
<li>返回值，返回一个新的组件</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类组件的ref转发</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">ref</span>=<span class="string">&#123;this.props.abc&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            组件A</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;this.props.words&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这样写是为了优化一下，看着舒服点，NewA组件可以直接传ref。想要实现ref转发必须通过forwardRef处理，被forwardRef处理过的组件，它会对传递的ref属性做特殊处理</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">NewA</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">A</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">abc</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">ARef</span> = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ARef</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">NewA</span> <span class="attr">ref</span>=<span class="string">&#123;this.ARef&#125;</span> <span class="attr">words</span>=<span class="string">&quot;asfsafasfasfs&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* this.ARef.current:  h1 */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">A</span> <span class="attr">abc</span>=<span class="string">&#123;this.ARef&#125;</span> <span class="attr">words</span>=<span class="string">&quot;asfsafasfasfs&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;/* 也可以当属性直接传过去,因为本质就是个对象&#123; current:null &#125; */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> </span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理高阶组件的一些问题</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; A &#125; <span class="keyword">from</span> <span class="string">&quot;./components/Comps&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> withLog <span class="keyword">from</span> <span class="string">&quot;./HOC/withLog&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">AComp</span> = <span class="title function_">withLog</span>(A);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    myRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">myRef</span>); <span class="comment">// 在高阶组件里不进行处理的时候，打印出来的是高阶组件的组件实例</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">AComp</span> <span class="attr">ref</span>=<span class="string">&#123;this.myRef&#125;</span> <span class="attr">isLogin</span> <span class="attr">a</span>=<span class="string">&#123;1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理高阶组件withLog</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 高阶组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; comp 组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withLog</span>(<span class="params">Comp</span>) &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">LogWrapper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">        <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志：组件<span class="subst">$&#123;Comp.name&#125;</span>被创建了！<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志：组件<span class="subst">$&#123;Comp.name&#125;</span>被销毁了！<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">//正常的属性</span></span><br><span class="line">            <span class="comment">//forwardRef代表要转发的ref  &#123;current:null&#125;  ...rest剩下的属性</span></span><br><span class="line">            <span class="keyword">const</span> &#123; forwardRef, ...rest &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Comp</span> <span class="attr">ref</span>=<span class="string">&#123;forwardRef&#125;</span> &#123;<span class="attr">...rest</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">LogWrapper</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">forwardRef</span>=<span class="string">&#123;ref&#125;</span> /&gt;</span></span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、Context"><a href="#五、Context" class="headerlink" title="五、Context"></a>五、Context</h2><p>上下文：Context，表示做某一些事情的环境</p>
<blockquote>
<p>上下文的主要作用是用来进行数据传递的，比如说app-&gt;subNode-&gt;childA-&gt;child1，我们可以看到组件嵌套的比较多，如果想要在child1组件中使用app组件中的数据就要进行多层的属性传递。此时我们可以使用上下文来解决，在app组件创建上下文，让child1组件使用其中的数据。</p>
<p>注意：不只有根组件才能创建上下文，也就是不只是app组件才能创建上下文，subNode组件等也可以。</p>
</blockquote>
<p>React中的上下文特点：</p>
<ol>
<li>当某个组件创建了上下文后，上下文中的数据，会被所有后代组件共享</li>
<li>如果某个组件依赖了上下文，会导致该组件不再纯粹（外部数据仅来源于属性props）,所以上下文要谨慎使用</li>
<li>一般情况下，用于第三方组件（通用组件）</li>
</ol>
<h3 id="1-旧的API"><a href="#1-旧的API" class="headerlink" title="1.旧的API"></a>1.旧的API</h3><p><em>react16之前</em></p>
<p><strong>创建上下文</strong></p>
<p>只有类组件才可以创建上下文（因为之前函数式组件没有状态就无法管理数据，一般上下文的数据源来自组件自身状态）</p>
<ol>
<li>给类组件书写静态属性 childContextTypes，使用该属性对上下文中的数据类型进行约束&lt;必须要做，不是可选的&gt;</li>
<li>添加实例方法 getChildContext，该方法返回的对象，即为上下文中的数据，该数据必须满足类型约束，该方法会在每次render之后运行。</li>
</ol>
<p><strong>使用上下文中的数据</strong></p>
<p>要求：如果要使用上下文中的数据，组件必须有一个静态属性 contextTypes，该属性描述了需要获取的上下文中的数据类型</p>
<ol>
<li>可以在组件的构造函数中，通过第二个参数，获取上下文数据</li>
<li><strong>从组件的context属性中获取</strong></li>
<li>在函数组件中，通过第二个参数，获取上下文数据</li>
</ol>
<p><strong>上下文的数据变化</strong></p>
<p>上下文中的数据不可以直接变化，最终都是通过状态改变</p>
<p>在上下文中加入一个处理函数，可以用于后代组件更改上下文的数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> types = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">    <span class="attr">onChangeA</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildA</span>(<span class="params">props, context</span>) &#123; <span class="comment">// 在函数组件中，通过第二个参数，获取上下文数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>a:&#123;context.a&#125;，b:&#123;context.b&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 声明需要使用哪些上下文中的数据</span></span><br><span class="line"><span class="title class_">ChildA</span>.<span class="property">contextTypes</span> = types;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明需要使用哪些上下文中的数据，这样设计是防止和props传过来的数据混淆，还可以知道使用了哪些上下文的数据。</span></span><br><span class="line"><span class="comment">     * 如果这里不声明是取不到上下文给到的相应数据的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> contextTypes = types</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constructor(props, context)&#123;</span></span><br><span class="line">    <span class="comment">//		super(props);</span></span><br><span class="line">    <span class="comment">//      // super(props， context); // 将参数的上下文交给父类处理，这里的构造函数可写可不写，会自行处理运行的</span></span><br><span class="line">    <span class="comment">//      console.log(context); 可以获取到上下文数据，不在这里使用上下文数据是因为构造函数只会运行一次，如果数据改变，不会随之改变</span></span><br><span class="line">	<span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ChildB，来自于上下文的数据：a: &#123;this.context.a&#125;, b:&#123;this.context.b&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                this.context.onChangeA(this.context.a + 2);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;子组件的按钮，a+2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根组件创建上下文</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">OldContext</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 约束上下文中数据的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = types</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&quot;abc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到上下文中的数据,返回的数据类型需和约束的数据类型相同。</span></span><br><span class="line"><span class="comment">     * 该方法会自行调用，在生命周期componentDidMount调用一次，之后会在每次render之后运行，保证拿到最新数据。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getChildContext</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取新的上下文&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">a</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>,</span><br><span class="line">            <span class="attr">b</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">b</span>,</span><br><span class="line">            <span class="attr">onChangeA</span>: <span class="function">(<span class="params">newA</span>) =&gt;</span> &#123; <span class="comment">// 在上下文中加入一个处理函数，可以用于后代组件更改上下文的数据。这里要用箭头函数，不然this指向有问题</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                    <span class="attr">a</span>: newA</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = <span class="variable language_">this</span>.<span class="title function_">getChildContext</span>() <span class="comment">// 自身使用，另外这个函数一般返回的是state中的数据，也可以直接用state中的数据</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildA</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                        a: this.state.a + 1</span></span><br><span class="line"><span class="language-xml">                    &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">                &#125;&gt;a加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-新版API"><a href="#2-新版API" class="headerlink" title="2.新版API"></a>2.新版API</h3><p><strong>补充</strong>:上面有些遗漏的内容</p>
<blockquote>
<p>app-&gt;subNode-&gt;childA-&gt;child1。还是拿这个组件嵌套结构来讲，如果app组件创建了一个上下文并提供了相应数据，而组件childA也创建了上下文提供了相同的数据。这时如果child1想要取上下文中的数据a，会像js作用域链一样，就近来取。如果childA取上下文中的数据会取到app的而不是自己的，另外还有函数onChangeA的调用问题，可以具体看下面的例子。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> types = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">    <span class="attr">onChangeA</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildA</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> contextTypes = types;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="title class_">PropTypes</span>.<span class="property">number</span>,</span><br><span class="line">        <span class="attr">c</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">getChildContext</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">a</span>: <span class="number">789</span>,</span><br><span class="line">            <span class="attr">c</span>: <span class="string">&quot;hello&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123; /** 此时ChildA也有创建的上下文，这个时候它获取上下文中的数据时，获取的是父组件的上下文 */ &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>a:&#123;this.context.a&#125;，b:&#123;this.context.b&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明需要使用哪些上下文中的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        ...types,</span><br><span class="line">        <span class="attr">c</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span> <span class="comment">// 声明下c不然接收不到</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123; /** 此时ChildB取的是ChildA的上下文数据，有点像js的作用域链，就近查找 */ &#125;</span></span><br><span class="line"><span class="language-xml">            ChildB，来自于上下文的数据：a: &#123;this.context.a&#125;, b:&#123;this.context.b&#125;</span></span><br><span class="line"><span class="language-xml">            ，c: &#123;this.context.c&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                this.context.onChangeA(this.context.a + 2); </span></span><br><span class="line"><span class="language-xml">                // 这里会有一个问题，这里的context.a取的是childA中的数据，用它修改了OldContext组件的状态。有时候会出面试题</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;子组件的按钮，a+2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">OldContext</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 约束上下文中数据的类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> childContextTypes = types</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&quot;abc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到上下文中的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">getChildContext</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取新的上下文&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">a</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">a</span>,</span><br><span class="line">            <span class="attr">b</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">b</span>,</span><br><span class="line">            <span class="attr">onChangeA</span>: <span class="function">(<span class="params">newA</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                    <span class="attr">a</span>: newA</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildA</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                        a: this.state.a + 1</span></span><br><span class="line"><span class="language-xml">                    &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">                &#125;&gt;a加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>react16</em></p>
<p>旧版API存在严重的效率问题，并且容易导致滥用</p>
<p><strong>创建上下文</strong></p>
<p>上下文是一个独立于组件的对象，该对象通过React.createContext(默认值)创建&lt;默认值指上下文中的默认数据&gt;</p>
<p>返回的是一个包含两个属性的对象</p>
<ol>
<li>Provider属性：生产者。一个组件，该组件会创建一个上下文，该组件有一个value属性，通过该属性，可以为其数据赋值<ol>
<li>同一个Provider，不要用到多个组件中，如果需要在其他组件中使用该数据，应该考虑将数据提升到更高的层次</li>
</ol>
</li>
<li>Consumer属性：消费者，从生产者那里拿数据，后续讲解</li>
</ol>
<blockquote>
<p>app-&gt;subNode-&gt;childA-&gt;child1,还是这个例子，我们用React.createContext()创建上下文，结构可以看成这样:</p>
<p>app-&gt;provider-&gt;subNode-&gt;childA-&gt;child1。例子中的结构是newContext-&gt;provider-&gt;childB</p>
<p>注意：同一种数据内容的上下文最好不要重复创建，把需要用到的数据直接提到外层即可。比如<br>App-&gt;NewContent1-&gt;ChildA</p>
<p>APP-&gt;NewContent2-&gt;ChildB</p>
<p>组件App中的两个组件的子组件都要使用同一份数据，不要在NewContent1和NewContent2中都创建上下文提供同一份数据，只需要在App中创建上下文</p>
</blockquote>
<p><strong>使用上下文中的数据</strong></p>
<ol>
<li>在类组件中，直接使用this.context获取上下文数据<ol>
<li>要求：必须拥有静态属性 contextType , 应赋值为创建的上下文对象&lt;函数式组件不需要，ctx.Consumer已经明确了使用哪个上下文了&gt;</li>
</ol>
</li>
<li>在函数组件中，需要使用Consumer来获取上下文数据&lt;类组件中也可以这样用，这种写法比较好，结构清晰&gt;<ol>
<li>Consumer是一个组件</li>
<li>它的子节点，是一个函数（它的props.children需要传递一个函数，它会把上下文数据当成一个参数传给这个函数）</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title class_">React</span>.<span class="title function_">createContext</span>();<span class="comment">// 创建上下文对象，如果把子组件拆出来，在其他模块使用直接把ctx导出，子组件引入使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildA</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ctx.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;value =&gt; <span class="tag">&lt;&gt;</span>&#123;value.a&#125;，&#123;value.b&#125;<span class="tag">&lt;/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                &#123; /** 七、插槽里学过，写在这里就是传递了一个children属性，是一个语法糖，类组件也可以中这种方式获取 */ &#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ctx.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> contextType = ctx;<span class="comment">// 把静态属性contextType赋值为上下文对象</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">        &#123; <span class="comment">/** &lt;ctx.Consumer&gt;</span></span><br><span class="line"><span class="comment">            &#123;value =&gt; &lt;&gt;&#123;value.a&#125;，&#123;value.b&#125;&lt;/&gt;&#125;</span></span><br><span class="line"><span class="comment">        &lt;/ctx.Consumer&gt; */</span>&#125;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            <span class="title class_">ChildB</span>，来自于上下文的数据：<span class="attr">a</span>: &#123;<span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">a</span>&#125;, <span class="attr">b</span>:&#123;<span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">b</span>&#125;</span><br><span class="line">            &lt;button onClick=&#123;<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">changeA</span>(<span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">a</span> + <span class="number">2</span>);</span><br><span class="line">            &#125;&#125;&gt;后代组件的按钮，点击a+<span class="number">2</span>&lt;/button&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">       );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewContext</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">        <span class="attr">changeA</span>: <span class="function">(<span class="params">newA</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">a</span>: newA</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ctx.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ChildA</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            a: this.state.a + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;父组件的按钮，a加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ctx.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意细节</strong></p>
<p>如果，上下文提供者（Context.Provider）中的value属性发生变化(用Object.is比较前后的value)，会导致该上下文提供的所有后代元素全部重新渲染，无论该子元素是否有优化（无论shouldComponentUpdate函数返回什么结果），可以看看下面的代码来进行优化</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title class_">React</span>.<span class="title function_">createContext</span>();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> contextType = ctx;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;运行了优化&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        <span class="comment">// 本来return false 可以避免重新渲染的，但是在这里不受影响，上下文内容发生变化这个函数不会运行，会重新渲染。后面会学到叫强制更新</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;childB render&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                a:&#123;this.context.a&#125;，b:&#123;this.context.b&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewContext</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* 优化前</span></span><br><span class="line"><span class="comment">    state = &#123;</span></span><br><span class="line"><span class="comment">        a: 0,</span></span><br><span class="line"><span class="comment">        b: &quot;abc&quot;,</span></span><br><span class="line"><span class="comment">        changeA: (newA) =&gt; &#123;</span></span><br><span class="line"><span class="comment">            this.setState(&#123;</span></span><br><span class="line"><span class="comment">                a: newA</span></span><br><span class="line"><span class="comment">            &#125;)</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 优化后</span></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">ctx</span>: &#123;</span><br><span class="line">            <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">b</span>: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">            <span class="attr">changeA</span>: <span class="function">(<span class="params">newA</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                    <span class="attr">a</span>: newA</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ctx.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state.ctx&#125;</span>&gt;</span>  &#123;/** 不直接传state,因为state每次都会变成一个新对象，而ctx的地址并不会改变,value不变 */&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;&#125;) </span></span><br><span class="line"><span class="language-xml">                        // 哪怕setState中的数据比起现有state没有改变也会触发强制更新，因为每次setState的时候都会得到一个全新的对象</span></span><br><span class="line"><span class="language-xml">                        // 那应该怎么进行性能优化呢，可以看下上面解释</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;父组件的按钮，a加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ctx.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>上下文嵌套使用</strong>：可以看出来结构比较清晰，不同于旧的API的就近原则。组件NewContext和组件ChildA分别提供数据给ChildB使用。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx1 = <span class="title class_">React</span>.<span class="title function_">createContext</span>();</span><br><span class="line"><span class="keyword">const</span> ctx2 = <span class="title class_">React</span>.<span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildA</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">ctx2.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">a:</span> <span class="attr">789</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">c:</span> &quot;<span class="attr">hello</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ctx1.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123;value =&gt; <span class="tag">&lt;&gt;</span>&#123;value.a&#125;，&#123;value.b&#125;<span class="tag">&lt;/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">ctx1.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &lt;/ctx2.<span class="property">Provider</span>&gt;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChildB</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ctx1.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;value =&gt; (</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            ChildB，来自于上下文的数据：a: &#123;value.a&#125;, b:&#123;value.b&#125;</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                                value.changeA(value.a + 2);</span></span><br><span class="line"><span class="language-xml">                            &#125;&#125;&gt;后代组件的按钮，点击a+2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">ctx2.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                &#123;val =&gt; (</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        来自于ctx2的数据：</span></span><br><span class="line"><span class="language-xml">                                        a: &#123;val.a&#125;， c:&#123;val.c&#125;</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line"><span class="language-xml">                                )&#125;</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;/<span class="name">ctx2.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">                    &lt;/&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;/ctx1.<span class="property">Consumer</span>&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">NewContext</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">a</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">b</span>: <span class="string">&quot;abc&quot;</span>,</span><br><span class="line">        <span class="attr">changeA</span>: <span class="function">(<span class="params">newA</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">a</span>: newA</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">ctx1.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">ChildA</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            a: this.state.a + 1</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;&gt;父组件的按钮，a加1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ctx1.Provider</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-上下文应用场景"><a href="#3-上下文应用场景" class="headerlink" title="3.上下文应用场景"></a>3.上下文应用场景</h3><p>上下文的应用场景</p>
<p>编写一套组件（有多个组件），这些组件之间需要相互配合才能最终完成功能</p>
<p>比如，我们要开发一套表单组件，使用方式如下</p>
<blockquote>
<p>由Form组件提供上下文，然后经过多层给Input，Button组件用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;datas</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">            console.log(datas); //获取表单中的所有数据（对象）</span></span><br><span class="line"><span class="language-xml">            /*</span></span><br><span class="line"><span class="language-xml">                &#123;</span></span><br><span class="line"><span class="language-xml">                    loginId:xxxx,</span></span><br><span class="line"><span class="language-xml">                    loginPwd:xxxx</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            */</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               账号： <span class="tag">&lt;<span class="name">Form.Input</span> <span class="attr">name</span>=<span class="string">&quot;loginId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">               密码： <span class="tag">&lt;<span class="name">Form.Input</span> <span class="attr">name</span>=<span class="string">&quot;loginPwd&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Form.Button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">Form.Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>简单封装一套Form组件</strong></p>
<p>地址：[03. React进阶&#x2F;09. demo表单组件组合&#x2F;react-learn&#x2F;src&#x2F;components&#x2F;common&#x2F;Form&#x2F;index.js · 拾贰&#x2F;frontend-react - 码云 - 开源中国](<a target="_blank" rel="noopener" href="https://gitee.com/xlt-vue/frontend-react/blob/main/03">https://gitee.com/xlt-vue/frontend-react/blob/main/03</a>. React进阶&#x2F;09. demo表单组件组合&#x2F;react-learn&#x2F;src&#x2F;components&#x2F;common&#x2F;Form&#x2F;index.js#)</p>
<p>这里不再写出完整代码，具体查看上述地址</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./formContext&quot;</span>; <span class="comment">// 这里把react.createContext()做了简单封装</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FormInput</span> <span class="keyword">from</span> <span class="string">&quot;./FormInput&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">FormButton</span> <span class="keyword">from</span> <span class="string">&quot;./FormButton&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Form</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">formData</span>: &#123;&#125;, <span class="comment">//表单数据对象</span></span><br><span class="line">        <span class="comment">//修改formData中的数据</span></span><br><span class="line">        <span class="attr">changeFormData</span>: <span class="function">(<span class="params">name, val</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">formData</span>: &#123;</span><br><span class="line">                    ...<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">formData</span>,</span><br><span class="line">                    [name]: val</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">submit</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onSubmit</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onSubmit</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">formData</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="attr">onSubmit</span>: <span class="title class_">PropTypes</span>.<span class="property">func</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Form</span>.<span class="property">Input</span> = <span class="title class_">FormInput</span></span><br><span class="line"><span class="title class_">Form</span>.<span class="property">Button</span> = <span class="title class_">FormButton</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Test.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Form</span> <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;datas</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    console.log(datas);</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        账号： <span class="tag">&lt;<span class="name">Form.Input</span> <span class="attr">name</span>=<span class="string">&quot;loginId&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        密码： <span class="tag">&lt;<span class="name">Form.Input</span> <span class="attr">name</span>=<span class="string">&quot;loginPwd&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Form.Button</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">Form.Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、PureComponent"><a href="#六、PureComponent" class="headerlink" title="六、PureComponent"></a>六、PureComponent</h2><p>纯组件，用于避免不必要的渲染（运行render函数），从而提升效率</p>
<p>优化：如果一个组件的属性和状态，都没有发生变化，重新渲染组件是没有必要的</p>
<blockquote>
<p>比如说有一个组件树：A组件是App组件的子组件，Child1和Child2是A组件的子组件，SubChild1是Child1组件的子组件，只要A组件进行了setState就会触发重新渲染，哪怕是setState({})。重新渲染之前会运行shouldComponentUpdate，因为它默认返回true，所以就会重新渲染。因为A组件进行了重新渲染，A组件的子组件都会运行shouldComponentUpdate，然后默认重新渲染。</p>
<p>优化点：没有必要重新渲染的话，在适当的时候让shouldComponentUpdate返回一个false。如果A组件返回false,就不会重新渲染，它的子组件就不会重新渲染。</p>
<p>补充：componentDidMount是在render函数运行后再运行的，详情看生命周期，所以正常来说，如果在componentDidMount中进行了setState，会再次运行render函数也就是再次重新渲染。</p>
<p>举个栗子：这里口头表述了，没看到代码在哪里，也不想自己敲&#x3D;_&#x3D;，就是有一个ToDoList组件，里面有一个状态list包含任务信息，并且一开始会发送请求获取信息，然后该组件中有两个子组件，一个TaskInput，一个TaskList，TaskInput接收一个方法onAdd，用来添加任务。TaskList接收list用来渲染Task组件，Task组件用来渲染单个任务。这时有两个点需要优化：</p>
<p>1.因为TaskInput在ToDoList组件内，ToDoList组件添加文章时，需要setState重新渲染，从而导致TaskInput组件也重新渲染，但是TaskInput并不需要重新渲染。</p>
<p>2.添加文章后，TaskList也会重新渲染，但是如果添加之前有9条，添加后10条，前9条是不变的，并不需要重新渲染</p>
</blockquote>
<p>PureComponent是一个组件，如果某个组件继承自该组件，则该组件的shouldComponentUpdate会进行优化，对属性和状态进行浅比较，如果相等则不会重新渲染</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题2的解决</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 浅比较</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">obj1</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">obj2</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">ObjectEqual</span>(<span class="params">obj1,obj2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> prop <span class="keyword">in</span> obj1)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title class_">Object</span>.<span class="title function_">is</span>(obj1[prop], obj2[prop])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在Task组件中加上下面这段代码，会发现每添加一次Task组件中的render函数只会运行一次，因为其他之前的数据都没变</span></span><br><span class="line"><span class="comment">// 这就是PureComponent的原理</span></span><br><span class="line"><span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">    <span class="comment">// 该函数的运行次数取决于之前有多少条数据，通过对比，决定是否更新，之前10条数据就会运行10次</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">ObjectEqual</span>(<span class="variable language_">this</span>.<span class="property">props</span>, nextProps) &amp;&amp; <span class="title class_">ObjectEqual</span>(<span class="variable language_">this</span>.<span class="property">state</span>,nextState))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123; <span class="comment">// 效果和上面处理完的一样</span></span><br><span class="line">    <span class="comment">// 继承PureComponent 就不用写上面的优化代码了</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PureComponent 相当于</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PureComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>) &#123;</span><br><span class="line">        <span class="comment">// 该函数的运行次数取决于之前有多少条数据，通过对比，决定是否更新，之前10条数据就会运行10次</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">ObjectEqual</span>(<span class="variable language_">this</span>.<span class="property">props</span>, nextProps) &amp;&amp; <span class="title class_">ObjectEqual</span>(<span class="variable language_">this</span>.<span class="property">state</span>,nextState))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把类组件继承Component改成PureComponent 就可以解决上面的两个问题了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 另外这里有个很重要的点，之前就说过这里再重复一遍，父组件传给子组件的函数尽量先定义好再传，不要直接写个箭头函数进去，不然每次等于传了个新的函数，虽然长的一样但是地址并不一样，依然会使得子组件重新渲染</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ol>
<li>PureComponent进行<strong>浅比较</strong></li>
<li>为了效率， 应该尽量使用PureComponent&lt;深比较效率更低&gt;</li>
<li>要求不要改动之前的状态，永远是创建新的状态来覆盖之前的状态（Immutable，不可变对象）</li>
<li>有一个第三方JS库，Immutable.js, 它专门用于制作不可变对象</li>
</ol>
  <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2的原因:如果继承的是PureComponent，执行函数后，数据并不会增加，因为这里没有新的数组产生，给tasks的还是之前的那个数组地址，浅比较比较不出来</span></span><br><span class="line"><span class="comment">// 产生新数组的方法[],new Array()</span></span><br><span class="line">handleAdd = <span class="function"><span class="params">newTask</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">tasks</span>.<span class="title function_">push</span>(newTask);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">tasks</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">tasks</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>函数组件，使用React.memo函数制作纯组件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Task</span>(<span class="params">props</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> (</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">className</span>=<span class="string">&#123;props.isFinish</span> ? &quot;<span class="attr">finish</span>&quot; <span class="attr">:</span> &quot;&quot;&#125;&gt;</span>&#123;this.props.name&#125;<span class="tag">&lt;/&gt;</span></span></span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Task</span>.<span class="property">propTypes</span> = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span>.<span class="property">isRequired</span>,</span><br><span class="line">	<span class="attr">isFinish</span>: <span class="title class_">PropTypes</span>.<span class="property">bool</span>.<span class="property">isRequired</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">React</span>.<span class="title function_">memo</span>(<span class="title class_">Task</span>)</span><br><span class="line">            </span><br><span class="line"><span class="comment">// memo 其实是一个高阶组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">memo</span>(<span class="params">FuncComp</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">Memo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">FuncComp</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、render-props"><a href="#七、render-props" class="headerlink" title="七、render props"></a>七、render props</h2><p>有时候，某些组件的各种功能及其处理逻辑几乎完全相同，只是显示的界面不一样，建议下面的方式认选其一来解决重复代码的问题（横切关注点）</p>
<ol>
<li><p>render props&lt;一般用于ui渲染不一样&gt;</p>
<ol>
<li>某个组件，需要某个属性</li>
<li>该属性是一个函数，函数的返回值用于渲染</li>
<li>函数的参数会传递为需要的数据</li>
<li>注意纯组件的属性（尽量避免每次传递的render props的地址不一致）</li>
<li>通常该属性的名字叫做render(并没有强制要求)</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./style.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该组件用于监听鼠标的变化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">MouseListener</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    divRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">    handleMouseMove = <span class="function"><span class="params">e</span> =&gt;</span> &#123; <span class="comment">// 把函数提出来，不直接写箭头函数，是为了纯组件PureComponent的使用</span></span><br><span class="line">        <span class="comment">//更新x和y的值</span></span><br><span class="line">        <span class="keyword">const</span> &#123; left, top &#125; = <span class="variable language_">this</span>.<span class="property">divRef</span>.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">        <span class="keyword">const</span> x = e.<span class="property">clientX</span> - left;</span><br><span class="line">        <span class="keyword">const</span> y = e.<span class="property">clientY</span> - top;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            x,</span><br><span class="line">            y</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.divRef&#125;</span> <span class="attr">className</span>=<span class="string">&quot;point&quot;</span> <span class="attr">onMouseMove</span>=<span class="string">&#123;this.handleMouseMove&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;this.props.render ? this.props.render(this.state) : &quot;默认值&quot;&#125;</span></span><br><span class="line"><span class="language-xml">                &#123;/** 把需要的参数传递过去 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MouseListener</span> <span class="keyword">from</span> <span class="string">&quot;./MouseListener&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 把函数提出来，不直接写箭头函数，是为了纯组件PureComponent的使用</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderPoint</span> = mouse =&gt; <span class="language-xml"><span class="tag">&lt;&gt;</span>横坐标：&#123;mouse.x&#125;，纵坐标：&#123;mouse.y&#125;<span class="tag">&lt;/&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderDiv</span> = mouse =&gt; <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> <span class="attr">100</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">100</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">background:</span> &quot;#<span class="attr">008c8c</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">position:</span> &quot;<span class="attr">absolute</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">left:</span> <span class="attr">mouse.x</span> <span class="attr">-</span> <span class="attr">50</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">top:</span> <span class="attr">mouse.y</span> <span class="attr">-</span> <span class="attr">50</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">MouseListener</span> <span class="attr">render</span>=<span class="string">&#123;renderPoint&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">MouseListener</span> <span class="attr">render</span>=<span class="string">&#123;renderDiv&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>HOC&lt;更牛，扩展性更强&gt;</p>
</li>
</ol>
 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;<span class="title class_">PureComponent</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./style.css&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withMouseListener</span>(<span class="params">Comp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">MouseListener</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">y</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        divRef = <span class="title class_">React</span>.<span class="title function_">createRef</span>()</span><br><span class="line"></span><br><span class="line">        handleMouseMove = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//更新x和y的值</span></span><br><span class="line">            <span class="keyword">const</span> &#123; left, top &#125; = <span class="variable language_">this</span>.<span class="property">divRef</span>.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">            <span class="keyword">const</span> x = e.<span class="property">clientX</span> - left;</span><br><span class="line">            <span class="keyword">const</span> y = e.<span class="property">clientY</span> - top;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                x,</span><br><span class="line">                y</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;this.divRef&#125;</span> <span class="attr">className</span>=<span class="string">&quot;point&quot;</span> <span class="attr">onMouseMove</span>=<span class="string">&#123;this.handleMouseMove&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...this.props</span>&#125; <span class="attr">x</span>=<span class="string">&#123;this.state.x&#125;</span> <span class="attr">y</span>=<span class="string">&#123;this.state.y&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">import</span> withMouseListener <span class="keyword">from</span> <span class="string">&quot;./withMouseListener&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Point</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>横坐标：&#123;props.x&#125;，纵坐标：&#123;props.y&#125;<span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MoveDiv</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width:</span> <span class="attr">100</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">height:</span> <span class="attr">100</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">background:</span> &quot;#<span class="attr">008c8c</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">position:</span> &quot;<span class="attr">absolute</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">left:</span> <span class="attr">props.x</span> <span class="attr">-</span> <span class="attr">50</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">top:</span> <span class="attr">props.y</span> <span class="attr">-</span> <span class="attr">50</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MousePoint</span> = <span class="title function_">withMouseListener</span>(<span class="title class_">Point</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MouseDiv</span> = <span class="title function_">withMouseListener</span>(<span class="title class_">MoveDiv</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">MousePoint</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">MouseDiv</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、Portals"><a href="#八、Portals" class="headerlink" title="八、Portals"></a>八、Portals</h2><p>插槽：将一个React元素渲染到指定的DOM容器中</p>
<p>ReactDOM.createPortal(React元素, 真实的DOM容器)，该函数返回一个React元素</p>
<blockquote>
<p>下面的例子中，如果不加ReactDOM.createPortal，他会按照元素结构正常渲染，加过之后，就会将ChildA返回的内容渲染到.modal这个元素里。</p>
<p>但是从react调试工具上来看元素结构还是不变的，说明虚拟dom的结构和真实dom结构是可以有差异的</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildA</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">ReactDOM</span>.<span class="title function_">createPortal</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-a&quot;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">marginTop:</span> <span class="attr">200</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildA<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ChildB</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.modal&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ChildB</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;child-b&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ChildB<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;app&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            console.log(&quot;App被点击了&quot;, e.target)</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>App<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ChildA</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/** 尽管ChildA在真实的dom中不在app中，但是点击ChildA，仍然会冒泡触发事件，说明事件冒泡是根据虚拟DOM树来冒泡的，与真实的DOM树无关 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意事件冒泡</strong></p>
<ol>
<li>React中的事件是包装过的，看上去和真实dom的一样，其实是有区别的，比如有的事件参数不同</li>
<li>它的事件冒泡是根据虚拟DOM树来冒泡的，与真实的DOM树无关。</li>
</ol>
<h2 id="九、错误边界"><a href="#九、错误边界" class="headerlink" title="九、错误边界"></a>九、错误边界</h2><p>默认情况下，若一个组件在<strong>渲染期间</strong>（render）发生错误，会导致整个组件树全部被卸载，无法渲染</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Comp1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> &quot;<span class="attr">90</span>%&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">border:</span> &quot;<span class="attr">2px</span> <span class="attr">solid</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comp1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Comp2</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getDatas</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Comp2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> datas = <span class="title function_">getDatas</span>();</span><br><span class="line">    <span class="keyword">const</span> spans = datas.<span class="title function_">map</span>(<span class="function"><span class="params">it</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>某一项<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>)</span><br><span class="line">    <span class="comment">// 这个地方会报错datas的原型上没有map，自己处理不了，然后抛出错误，给它的父组件处理，它的父组件处理不了就会继续往上，最后组件树卸载</span></span><br><span class="line">    <span class="comment">// 注意：这个报错只会在开发的时候在页面报错，生产环境直接白屏</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> &quot;<span class="attr">70</span>%&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> &quot;<span class="attr">70</span>%&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">border:</span> &quot;<span class="attr">2px</span> <span class="attr">solid</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;spans&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comp2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Comp3</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> &quot;<span class="attr">90</span>%&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">height:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">border:</span> &quot;<span class="attr">2px</span> <span class="attr">solid</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comp3<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Comp1</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Comp3</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>错误边界：是一个组件，该组件会捕获到<strong>渲染期间（render）</strong>子组件发生的错误，并有能力阻止错误继续传播</p>
<p><strong>让某个组件捕获错误</strong></p>
<ol>
<li>编写生命周期函数 getDerivedStateFromError（16版本后出现的<a target="_blank" rel="noopener" href="https://react.docschina.org/reference/react/Component#static-getderivedstatefromerror">Component – React 中文文档</a>）<ol>
<li>静态函数</li>
<li>运行时间点：渲染子组件的过程中，发生错误之后，在更新页面之前</li>
<li><strong>注意：只有子组件发生错误，才会运行该函数，自己发生错误不会运行</strong></li>
<li>该函数返回一个对象，React会将该对象的属性覆盖掉当前组件的state，类似于setState</li>
<li>参数：错误对象</li>
<li>通常，该函数用于改变状态</li>
</ol>
</li>
<li>编写生命周期函数 componentDidCatch<ol>
<li>实例方法</li>
<li>运行时间点：渲染子组件的过程中，发生错误，更新页面之后，也就是组件树卸载后，由于其运行时间点比较靠后，因此不太会在该函数中改变状态</li>
<li>通常，该函数用于记录错误消息</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">ErrorBound</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">hasError</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发生错误了&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">hasError</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidCatch</span>(<span class="params">error, info</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;记录错误信息&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//     throw new Error(&quot;asfasdfasf&quot;);捕获不到</span></span><br><span class="line">        <span class="comment">// &#125;, 1000);</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">hasError</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>出现错误了！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">children</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ErrorBound</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Comp1</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ErrorBound</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Comp3</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>细节</strong></p>
<p>某些错误，错误边界组件无法捕获</p>
<ol>
<li>自身的错误</li>
<li>异步的错误</li>
<li>事件中的错误，比如点击事件报错</li>
</ol>
<p>总结：仅处理渲染子组件期间的<strong>同步</strong>错误</p>
<h2 id="十、React中的事件"><a href="#十、React中的事件" class="headerlink" title="十、React中的事件"></a>十、React中的事件</h2><blockquote>
<p>如果开发的是纯粹React应用，根本用不到，如果和第三方基于原生dom插件混用，需要注意一下。</p>
<p>因为react事件和原生dom事件可能有些不一样，这里讲的不深</p>
</blockquote>
<p>这里的事件：React内置的DOM组件中的事件（如：按钮的onclick）</p>
<blockquote>
<p>当时react设计的时候，如果给每个真实的dom元素去写事件的话，那页面中会充斥各种事件，会影响执行效率</p>
</blockquote>
<ol>
<li>给document注册事件</li>
<li>几乎所有的元素的事件处理，均在document的事件中处理（onFocus不冒泡）<ol>
<li>一些不冒泡的事件，是直接在元素上监听</li>
<li>一些document上面没有的事件，直接在元素上监听</li>
</ol>
</li>
<li>在document的事件处理，React会根据虚拟DOM树的完成事件函数的调用</li>
</ol>
<blockquote>
<p>虚拟dom结构：App-&gt;CompA-&gt;Comp1-&gt;Comp2,给三个子组件都绑定点击事件，它是怎么进行事件冒泡的呢</p>
<p>真实的dom结构：document-&gt;body-&gt;…..，</p>
<p>事件监听全在document上，不会监听三个子组件生成的事件，当dom中发生一个click事件的时候，它会去虚拟dom树上面去找，document上有一个队列，从Comp2上的事件从下往上调用</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">var</span> prev;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(&quot;react: 按钮被点击了&quot;);</span></span><br><span class="line"><span class="language-xml">            	e.stopPropagation(); </span></span><br><span class="line"><span class="language-xml">            	// 如果给button外面再包一层div，并绑定一个点击事件，点击button并不会触发div上的点击事件阻止事件在虚拟DOM树中冒泡</span></span><br><span class="line"><span class="language-xml">           &#125;&#125;&gt;按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#root&quot;</span>).<span class="property">onClick</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;真实的dom事件，id为root的dom元素被点击了&quot;</span>)</span><br><span class="line">    <span class="comment">// 点击button如果是正常的执行顺序是：先输出按钮被点击了，然后事件冒泡再输出dom元素被点击了</span></span><br><span class="line">    <span class="comment">// 但是点击之后发现恰恰相反</span></span><br><span class="line">    <span class="comment">// 因为按钮事件的调用要等到冒泡到document的时候才调用，也就是冒泡到最外层元素才会调用，所以先运行root</span></span><br><span class="line">    e.<span class="title function_">stopPropagation</span>(); <span class="comment">// 如果在这里阻止冒泡，按钮的点击事件就不会运行了，因为到root那里就结束了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>React的事件参数，并非真实的DOM事件参数，是React合成的一个对象，该对象类似于真实DOM的事件参数</p>
<ol>
<li><p>stopPropagation，阻止事件在虚拟DOM树中冒泡</p>
</li>
<li><p>nativeEvent，可以得到真实的DOM事件对象</p>
</li>
<li><p>为了提高执行效率，React使用事件对象池来处理事件对象</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">var</span> prev;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        console.log(prev === e); // true，事件参数e被重用了</span></span><br><span class="line"><span class="language-xml">        console.log(&quot;react: div被点击了&quot;)</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">onFocus</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            console.log(&quot;react：文本获得了焦点&quot;)</span></span><br><span class="line"><span class="language-xml">        &#125;&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            console.log(&quot;react: 按钮被点击了&quot;);</span></span><br><span class="line"><span class="language-xml">            prev = e;</span></span><br><span class="line"><span class="language-xml">            e.persist() // 持久化后，可以重用</span></span><br><span class="line"><span class="language-xml">            setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(e.type); // 会报错，不能重用，因为为了节约内存空间，第一次用完后，e中的属性都会设为null</span></span><br><span class="line"><span class="language-xml">            &#125;, 1000);</span></span><br><span class="line"><span class="language-xml">            // e.nativeEvent.stopPropagation() </span></span><br><span class="line"><span class="language-xml">            // 上面的写法无法阻止真实dom事件冒泡，因为触发该事件时都冒泡到document上了，虚拟的也阻止不了，因为nativeEvent是真实的dom事件对象</span></span><br><span class="line"><span class="language-xml">            // e.nativeEvent.stopImmediatePropagation() 一般遇不到，我也不太理解</span></span><br><span class="line"><span class="language-xml">            // console.log(e.isPropagationStopped());</span></span><br><span class="line"><span class="language-xml">            // e.stopPropagation();</span></span><br><span class="line"><span class="language-xml">            // console.log(e.isPropagationStopped());// 如果为true就是阻止了事件冒泡后面不再进行</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#root&quot;</span>).<span class="property">onFocus</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;阻止focus事件冒泡&quot;</span>) <span class="comment">// 这个不会运行，因为focus事件根本不冒泡</span></span><br><span class="line">    e.<span class="title function_">stopPropagation</span>(); <span class="comment">// focus事件仍然会运行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>注意事项</strong></p>
<ol>
<li>如果给真实的DOM注册事件，阻止了事件冒泡，则会导致react的相应事件无法触发</li>
<li>如果给真实的DOM注册事件，事件会先于React事件运行</li>
<li>通过React的事件中阻止事件冒泡，无法阻止真实的DOM事件冒泡</li>
<li>可以通过nativeEvent.stopImmediatePropagation()，阻止document上剩余事件的执行</li>
<li>在事件处理程序中，不要异步的使用事件对象，如果一定要使用，需要调用persist函数</li>
</ol>
<h2 id="十一、渲染原理▲"><a href="#十一、渲染原理▲" class="headerlink" title="十一、渲染原理▲"></a>十一、渲染原理▲</h2><blockquote>
<p>复杂，官网讲的不多，资料也少，官网主要说的是diff算法是渲染原理的一个步骤，听不懂就再看看视频</p>
</blockquote>
<p>渲染：生成用于显示的对象，以及将这些对象形成真实的DOM对象</p>
<ul>
<li>React元素：React Element，通过React.createElement创建（语法糖：JSX）<ul>
<li>例如：</li>
<li><code>&lt;div&gt;&lt;h1&gt;标题&lt;/h1&gt;&lt;/div&gt;</code></li>
<li><code>&lt;App /&gt;</code></li>
</ul>
</li>
<li>React节点：专门用于渲染到UI界面的对象，React会通过React元素，创建React节点，ReactDOM一定是通过React节点来进行渲染的，但是React节点不一定来自于元素，比如文本节点，空节点，数组节点。注：普通对象不能创建文本节点</li>
<li>节点类型：<ul>
<li>React DOM节点：创建该节点的React元素类型是一个字符串 <code>&lt;div&gt;&lt;div/&gt;</code></li>
<li>React 组件节点：创建该节点的React元素类型是一个函数或是一个类 <code>&lt;App /&gt;类组件或函数组件</code></li>
<li>React 文本节点：由字符串、数字创建的 <code>Hello World</code></li>
<li>React 空节点：由null、undefined、false、true <code>null</code></li>
<li>React 数组节点：该节点由一个数组创建 <code>[1,2,3,4,5]</code></li>
</ul>
</li>
<li>真实DOM：通过document.createElement创建的dom元素</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/17/6789faa631638.png"></p>
<h3 id="1-首次渲染-新节点渲染"><a href="#1-首次渲染-新节点渲染" class="headerlink" title="1.首次渲染(新节点渲染)"></a>1.首次渲染(新节点渲染)</h3><ol>
<li>通过参数的值创建节点 <code>ReactDom.render(参数,document.getElementById(&#39;root&#39;)),参数不能为普通对象，普通对象不能渲染</code></li>
<li>根据不同的节点，做不同的事情<ol>
<li>文本节点：通过document.createTextNode创建真实的文本节点</li>
<li>空节点：什么都不做，但是该节点对象是存在的</li>
<li>数组节点：遍历数组，将数组每一项递归创建节点（回到第1步&lt;通过参数的值创建节点&gt;进行反复操作，直到遍历结束）</li>
<li>DOM节点：通过document.createElement创建真实的DOM对象，然后立即设置该真实DOM元素的各种属性，然后遍历对应React元素的children属性，递归操作（回到第1步进行反复操作，直到遍历结束）。注意：child元素创建完真实的DOM对象后都会将该真实DOM加入到父元素的真实DOM对象中，第一个根节点要最后才加入到容器中。</li>
<li>组件节点<ol>
<li>函数组件：调用函数(该函数必须返回一个可以生成节点的内容)，将该函数的返回结果递归生成节点（回到第1步进行反复操作，直到遍历结束）</li>
<li>类组件：<ol>
<li>创建该类的实例</li>
<li>立即调用对象的生命周期方法：static getDerivedStateFromProps</li>
<li>运行该对象的render方法，拿到节点对象（将该节点递归操作，回到第1步进行反复操作）</li>
<li>第三步完成后，将该组件的componentDidMount加入到执行队列（先进先出，先进先执行），当整个虚拟DOM树全部构建完毕，并且将真实的DOM对象加入到容器中后，执行该队列。注意：在这个队列中，子组件的componentDidMount先执行，之后才是父组件执行，因为我们看执行步骤可以知道要等到第3步完成后，才会执行第四步，当子组件执行完第四步的时候，父组件还处于第三步呢；如果是两个并列的组件节点，就是先执行上面的再执行下面的，因为是遍历来的，先是第一个再是第二个</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>生成出虚拟DOM树之后，将该树保存起来，以便后续使用</li>
<li>将之前生成的真实的DOM对象，加入到容器中。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;assaf&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        标题</span></span><br><span class="line"><span class="language-xml">        &#123;[&quot;abc&quot;, null, <span class="tag">&lt;<span class="name">p</span>&gt;</span>段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span>]&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;undefined&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(app, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>以上代码生成的虚拟DOM树：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/17/6789faf6ee4f1.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Comp1</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comp1 &#123;props.n&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Comp1</span> <span class="attr">n</span>=<span class="string">&#123;5&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(app, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>以上代码生成的虚拟DOM树：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/17/6789fb238e249.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Comp1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Comp1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Comp1</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>;</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(app, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>以上代码生成的虚拟DOM树：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/17/6789fb555307e.png"></p>
<h3 id="2-更新节点"><a href="#2-更新节点" class="headerlink" title="2.更新节点"></a>2.更新节点</h3><p>更新的场景：</p>
<ol>
<li>重新调用ReactDOM.render，触发根节点更新</li>
<li>在类组件的实例对象中调用setState，会导致该实例所在的节点更新，子组件实例更新不会导致父组件更新，此时体现了单项数据流的好处，提高了效率</li>
</ol>
<p><strong>节点的更新</strong></p>
<ul>
<li>如果调用的是ReactDOM.render，进入根节点的<strong>对比（diff）更新</strong></li>
<li>如果调用的是setState&lt;下面的是调用setState的组件节点执行的，也就是Comp1&gt;<ul>
<li><ol>
<li>运行生命周期函数，static getDerivedStateFromProps</li>
</ol>
</li>
<li><ol start="2">
<li>运行shouldComponentUpdate，如果该函数返回false，终止当前流程</li>
</ol>
</li>
<li><ol start="3">
<li>运行render，得到一个新的节点&lt;组件节点只有一个子节点&gt;，进入该新的节点的<strong>对比更新</strong></li>
</ol>
</li>
<li><ol start="4">
<li>将生命周期函数getSnapshotBeforeUpdate加入执行队列，以待将来执行</li>
</ol>
</li>
<li><ol start="5">
<li>将生命周期函数componentDidUpdate加入执行队列，以待将来执行</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>后续步骤&lt;上面的两种后续步骤都是这样&gt;：</p>
<ol>
<li>更新虚拟DOM树</li>
<li>完成真实的DOM更新</li>
<li>依次调用执行队列中的componentDidMount</li>
<li>依次调用执行队列中的getSnapshotBeforeUpdate</li>
<li>依次调用执行队列中的componentDidUpdate</li>
</ol>
<h4 id="对比更新"><a href="#对比更新" class="headerlink" title="对比更新"></a>对比更新</h4><p>将新产生的节点&lt;也就是从组件节点返回的节点开始，不包含组件节点&gt;，对比之前虚拟DOM中的节点，发现差异，完成更新</p>
<p>问题：对比之前DOM树中哪个节点</p>
<p>React为了提高对比效率，做出以下假设</p>
<ol>
<li>假设节点不会出现层次的移动（对比时，直接找到旧树中对应位置的节点进行对比）</li>
<li>不同的节点类型会生成不同的结构（比如说，div-&gt;span）<ol>
<li>相同的节点类型：节点本身类型相同（之前是文本节点，现在还是），如果是由React元素<jsx>生成，type值还必须一致（类型相同）</li>
<li>其他的，都属于不相同的节点类型</li>
</ol>
</li>
<li>多个兄弟通过唯一标识（key）来确定对比的新节点</li>
</ol>
<p>key值的作用：用于通过旧节点，寻找对应的新节点，如果某个旧节点有key值，则其更新时，会寻找相同层级中的相同key值的节点，进行对比。没有key会去找同一层次同一位置的节点。</p>
<p><strong>key值应该在一个范围内唯一（兄弟节点中），并且应该保持稳定</strong></p>
<blockquote>
<p>如果元素结构相同，节点就不会更新，比如两个表单，登录和注册，结构相同，通过按钮切换两个表单，发现切换后，账号和密码Input输入框中的值都没有清空，就是因为元素结构相同，节点没有更新。此时可以给两个表单中的input输入框分别加上不同的key就可以解决，没有找到相同的key，就会进入没有找到对比目标执行相应逻辑。</p>
<p>注意：key在同一层次是不能重复的，不同层次可以重复，因为对比key是对比的同一层次的key。</p>
<p>数组节点用map渲染的时候需要添加key，就是这个原因，如果不加key，如果数组发生了某种变化（push的时候除外），可能整个数组节点生成的真实dom都要卸载重建，严重影响效率</p>
</blockquote>
<h5 id="找到了对比的目标"><a href="#找到了对比的目标" class="headerlink" title="找到了对比的目标"></a>找到了对比的目标</h5><p>判断节点类型是否一致</p>
<ul>
<li><strong>一致</strong></li>
</ul>
<p>根据不同的节点类型，做不同的事情</p>
<p><strong>空节点</strong>：不做任何事情</p>
<p><strong>DOM节点</strong>：</p>
<ol>
<li>直接重用之前的真实DOM对象</li>
<li>将其属性的变化记录下来&lt;一定会做&gt;，以待将来统一完成更新（现在不会真正的变化，变化发生在后续步骤2）</li>
<li>遍历该新的React元素&lt;render返回的元素&gt;的子元素，<strong>递归对比更新</strong></li>
</ol>
<p><strong>文本节点</strong>：</p>
<ol>
<li>直接重用之前的真实DOM对象</li>
<li>将新的文本<code>nodeValue</code>变化记录下来，将来统一完成更新</li>
</ol>
<p><strong>组件节点</strong>：</p>
<p><strong>函数组件</strong>：重新调用函数，得到一个节点对象，进入<strong>递归对比更新</strong></p>
<p><strong>类组件</strong>：</p>
<ol>
<li>重用之前的实例</li>
<li>调用生命周期方法getDerivedStateFromProps</li>
<li>调用生命周期方法shouldComponentUpdate，若该方法返回false，终止</li>
<li>运行render，得到新的节点对象，进入<strong>递归对比更新</strong></li>
<li>将该对象的getSnapshotBeforeUpdate加入队列</li>
<li>将该对象的componentDidUpdate加入队列</li>
</ol>
<p><strong>数组节点</strong>：遍历数组进行<strong>递归对比更新</strong></p>
<ul>
<li><strong>不一致</strong></li>
</ul>
<p>整体上，卸载旧的节点，全新创建新的节点</p>
<blockquote>
<p>只要层级节点不一致，就会当作不一致来执行下面步骤，比如说：</p>
<p>App-&gt;ChildA-&gt;Child1</p>
<p>App-&gt;ChildB-&gt;Child1</p>
<p>Child1并不会重用</p>
<p>App-&gt;div-&gt;h1</p>
<p>App-&gt;div-&gt;h1</p>
<p>会重用，因为节点类型一样。所以如果页面局部变化，尽量保持节点类型和节点结构不变，或者通过给同一层次加上key解决</p>
</blockquote>
<p><strong>创建新节点</strong>&lt;先&gt;</p>
<p>进入新节点的挂载流程&lt;新节点首次渲染&gt;</p>
<p><strong>卸载旧节点</strong>&lt;后&gt;</p>
<ol>
<li><strong>文本节点、DOM节点、数组节点、空节点、函数组件节点</strong>：直接放弃该节点，如果节点有子节点，递归卸载节点</li>
<li><strong>类组件节点</strong>：<ol>
<li>直接放弃该节点</li>
<li>调用该节点的componentWillUnMount函数</li>
<li>递归卸载子节点</li>
</ol>
</li>
</ol>
<h5 id="没有找到对比的目标"><a href="#没有找到对比的目标" class="headerlink" title="没有找到对比的目标"></a>没有找到对比的目标</h5><p>新的DOM树中有节点被删除</p>
<p>新的DOM树中有节点添加</p>
<ul>
<li>创建新加入的节点</li>
<li>卸载多余的旧节点</li>
</ul>
<h2 id="十二、工具"><a href="#十二、工具" class="headerlink" title="十二、工具"></a>十二、工具</h2><h3 id="1-严格模式"><a href="#1-严格模式" class="headerlink" title="1.严格模式"></a>1.严格模式</h3><p>StrictMode(<code>React.StrictMode</code>)，本质是一个组件，该组件不进行UI渲染（<code>像React.Fragment &lt;&gt; &lt;/&gt;</code>），它的作用是，在渲染内部组件时，发现不合适的代码。例如：</p>
<ul>
<li>识别不安全的生命周期</li>
<li>关于使用过时字符串 ref API 的警告</li>
<li>关于使用废弃的 findDOMNode 方法的警告</li>
<li>检测意外的副作用<ul>
<li>React要求，副作用代码仅出现在以下生命周期函数中</li>
<li><ol>
<li>ComponentDidMount</li>
</ol>
</li>
<li><ol start="2">
<li>ComponentDidUpdate</li>
</ol>
</li>
<li><ol start="3">
<li>ComponentWillUnMount</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>副作用：一个函数中，做了一些会影响函数外部数据的事情，例如：</p>
<ol>
<li>异步处理</li>
<li>改变参数值</li>
<li>setState（可能是异步的）</li>
<li>本地存储</li>
<li>改变函数外部的变量</li>
</ol>
<p>相反的，如果一个函数没有副作用，则可以认为该函数是一个纯函数</p>
<p>在严格模式下，虽然不能监控到具体的副作用代码，但它会将不能具有副作用的函数调用两遍，以便发现问题。（这种情况，仅在开发模式下有效）</p>
<ul>
<li>检测过时的 context API</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span></span><br><span class="line"><span class="comment">// 用法如下</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>((</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line">), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="2-Profiler"><a href="#2-Profiler" class="headerlink" title="2.Profiler"></a>2.Profiler</h3><p>性能分析工具（在react开发者工具里用的）</p>
<p>分析某一次或多次提交（更新），涉及到的组件的渲染时间</p>
<p>火焰图：得到某一次提交，每个组件总的渲染时间以及自身的渲染时间</p>
<p>排序图：得到某一次提交，每个组件自身渲染时间的排序</p>
<p>组件图：某一个组件，在多次提交中，自身渲染花费的时间</p>
<h1 id="HOOK"><a href="#HOOK" class="headerlink" title="HOOK"></a>HOOK</h1><h2 id="一、HOOK简介"><a href="#一、HOOK简介" class="headerlink" title="一、HOOK简介"></a>一、HOOK简介</h2><p>HOOK是React16.8.0之后出现</p>
<p>组件：无状态组件（函数组件）、类组件</p>
<p>类组件中的麻烦：</p>
<ol>
<li><p>this指向问题</p>
</li>
<li><p>繁琐的生命周期</p>
</li>
<li><p>其他问题</p>
</li>
</ol>
<p>HOOK专门用于增强函数组件的功能（HOOK在类组件中是不能使用的），使之理论上可以成为类组件的替代品</p>
<p>官方强调：没有必要更改已经完成的类组件，官方目前没有计划取消类组件，只是鼓励使用函数组件</p>
<p>HOOK（钩子）本质上是一个函数(命名上总是以use开头)，该函数可以挂载任何功能</p>
<p>HOOK种类：</p>
<ol>
<li>useState</li>
<li>useEffect</li>
<li>其他…</li>
</ol>
<h2 id="二、State-Hook"><a href="#二、State-Hook" class="headerlink" title="二、State Hook"></a>二、State Hook</h2><p>State Hook是一个在函数组件中使用的函数（useState），用于在函数组件中使用状态</p>
<p>useState</p>
<ul>
<li>函数有一个参数，这个参数的值表示状态的默认值</li>
<li>函数的返回值是一个数组，该数组一定包含两项，建议用解构的方式来写<ul>
<li>第一项：当前状态的值</li>
<li>第二项：改变状态的函数</li>
</ul>
</li>
</ul>
<p>一个函数组件中可以有多个状态，这种做法非常有利于横向切分关注点。</p>
<p><strong>注意的细节</strong></p>
<ol>
<li><p>useState最好写到函数的起始位置，便于阅读</p>
</li>
<li><p>useState严禁出现在代码块（判断、循环）中，可能会影响状态表格某项的位置</p>
</li>
<li><p>useState返回的函数（数组的第二项），引用不变（节约内存空间）</p>
</li>
<li><p>使用函数改变数据，若数据和之前的数据完全相等（使用Object.is比较），不会导致重新渲染，以达到优化效率的目的。</p>
</li>
<li><p>使用函数改变数据，传入的值不会和原来的数据进行合并，而是直接替换。</p>
</li>
<li><p>如果要实现强制刷新组件</p>
<ol>
<li>类组件：使用forceUpdate函数</li>
<li>函数组件：使用一个空对象的useState</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// import React, &#123; Component &#125; from &#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export default class App extends Component &#123;</span></span><br><span class="line"><span class="comment">//     render() &#123;</span></span><br><span class="line"><span class="comment">//         return (</span></span><br><span class="line"><span class="comment">//             &lt;div&gt;</span></span><br><span class="line"><span class="comment">//                 &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//                     //不会运行shouldComponentUpdate</span></span><br><span class="line"><span class="comment">//                     this.forceUpdate();//强制重新渲染</span></span><br><span class="line"><span class="comment">//                 &#125;&#125;&gt;强制刷新&lt;/button&gt;</span></span><br><span class="line"><span class="comment">//             &lt;/div&gt;</span></span><br><span class="line"><span class="comment">//         )</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;App Render&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> [, forceUpdate] = <span class="title function_">useState</span>(&#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span> &gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                forceUpdate(&#123;&#125;);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;强制刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>如果某些状态之间没有必然的联系，应该分化为不同的状态，而不要合并成一个对象</strong></p>
</li>
<li><p>和类组件的状态一样，函数组件中改变状态可能是异步的（在DOM事件中），多个状态变化会合并以提高效率，此时，不能信任之前的状态，而应该使用回调函数的方式改变状态。如果状态变化要使用到之前的状态，尽量传递函数。</p>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;App render&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">//使用一个状态，该状态的默认值是0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            // setN(n - 1);</span></span><br><span class="line"><span class="language-xml">            // setN(n - 1);</span></span><br><span class="line"><span class="language-xml">            setN(prevN =&gt; prevN - 1); //传入的函数，在事件完成之后统一运行</span></span><br><span class="line"><span class="language-xml">            setN(prevN =&gt; prevN - 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;n&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            // setN(n + 1) //不会立即改变，事件运行完成之后一起改变</span></span><br><span class="line"><span class="language-xml">            // setN(n + 1) //此时，n的值仍然是0</span></span><br><span class="line"><span class="language-xml">            setN(prevN =&gt; prevN + 1); //传入的函数，在事件完成之后统一运行</span></span><br><span class="line"><span class="language-xml">            setN(prevN =&gt; prevN + 1);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>State Hook原理</strong></p>
<p>函数式组件只要状态值发生改变就会重新渲染，每次重新渲染都会重新调用函数，重新调用函数时，按道理来说<code>state hook</code>也会重新运行，state应该被再赋予初始值，为什么会看到状态的改变呢，这就涉及<code>state hook</code>的原理了。</p>
<p>当运行一个函数组件时（调用该函数），会生成一个组件节点，该节点会持有一个引用，因为这个函数组件是通过<code>React.createElement()</code>创建的<code>react</code>元素，所以它会持有一个元素对象，该元素对象中有该函数的引用。比如组件<code>App</code>，<code>const app = &lt;App /&gt;; console.log(app); app.type = app函数</code>。</p>
<p>所以我们可以通过该元素节点，找到元素对象，然后找到函数引用。函数组件在渲染的时候直接运行该函数即可，运行该函数时它会做这些事情。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/20/678dfa7d4dfa8.png"></p>
<p>另外如果有两个App组件，它们的状态并不会共享，这是因为状态表格是附着在节点上的，两个App是两个节点，但是它们的函数引用是同一个。</p>
<h2 id="三、Effect-Hook"><a href="#三、Effect-Hook" class="headerlink" title="三、Effect Hook"></a>三、Effect Hook</h2><p>Effect Hook：用于在函数组件中处理副作用</p>
<p>副作用：</p>
<ol>
<li>ajax请求</li>
<li>计时器</li>
<li>其他异步操作</li>
<li>更改真实DOM对象</li>
<li>本地存储</li>
<li>其他会对外部产生影响的操作</li>
</ol>
<p>函数：useEffect，该函数接收一个函数作为参数，接收的函数就是需要进行副作用操作的函数</p>
<p><strong>细节</strong></p>
<ol>
<li><p>副作用函数的运行时间点，是在页面完成真实的UI渲染之后(组件销毁不会运行)。因此它的执行是异步的，并且不会阻塞浏览器</p>
<ol>
<li>与类组件中componentDidMount和componentDidUpdate的区别</li>
<li>componentDidMount和componentDidUpdate，更改了真实DOM，但是用户还没有看到UI更新，同步的。</li>
<li>useEffect中的副作用函数，更改了真实DOM，并且用户已经看到了UI更新，异步的。</li>
</ol>
</li>
<li><p>每个函数组件中，可以多次使用useEffect，但不要放入判断或循环等代码块中，原因同<code>useState</code>。</p>
</li>
<li><p>useEffect中的副作用函数，可以有返回值，返回值必须是一个函数，该函数叫做清理函数</p>
<ol>
<li>该函数运行时间点，在每次运行副作用函数之前</li>
<li>首次渲染组件不会运行</li>
<li>组件被销毁时一定会运行</li>
</ol>
</li>
<li><p>useEffect函数，可以传递第二个参数</p>
<ol>
<li>第二个参数是一个数组</li>
<li>数组中记录该副作用的依赖数据</li>
<li>当组件重新渲染后，只有依赖数据与上一次不一样的时，才会执行副作用</li>
<li>所以，当传递了依赖数据之后，如果数据没有发生变化（如果你想实现下面两点，可以只传一个空数组）<ol>
<li>副作用函数仅在第一次渲染后运行</li>
<li>清理函数仅在卸载组件后运行</li>
</ol>
</li>
</ol>
</li>
<li><p>副作用函数中，如果使用了函数上下文中的变量，则由于闭包的影响，会导致副作用函数中变量不会实时变化。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 首次渲染+点击5次 会依次打印 0 1 2 3 4 5，n使用的是外部作用域的值，每次点击会重新调用函数，因为闭包的存在打印的还是之前的变量n √</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(n); <span class="comment">//n指向，当前App函数调用时的n</span></span><br><span class="line">        &#125;, <span class="number">5000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;n&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                setN(n + 1);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;n+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>副作用函数在每次注册时，会覆盖掉之前的副作用函数，因此，尽量保持副作用函数稳定，否则控制起来会比较复杂。</p>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;odd 副作用函数&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;odd 清理函数&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;even 副作用函数&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;even 清理函数&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [, forceUpdate] = <span class="title function_">useState</span>(&#123;&#125;)</span><br><span class="line">    <span class="title function_">useEffect</span>(n % <span class="number">2</span> === <span class="number">0</span> ? func2 : func1); <span class="comment">// 不稳定</span></span><br><span class="line">    n++;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                forceUpdate(&#123;&#125;);</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;强制刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、自定义Hook"><a href="#四、自定义Hook" class="headerlink" title="四、自定义Hook"></a>四、自定义Hook</h2><p>State Hook： useState<br>Effect Hook：useEffect</p>
<p>自定义Hook：将一些常用的、跨越多个组件的Hook功能，抽离出去形成一个函数，该函数就是自定义Hook，自定义Hook，由于其内部需要使用Hook功能，所以它本身也需要按照Hook的规则实现：</p>
<ol>
<li>函数名必须以use开头</li>
<li>调用自定义Hook函数时，应该放到顶层</li>
</ol>
<p>例如：</p>
<ol>
<li>很多组件都需要在第一次加载完成后，获取所有学生数据</li>
<li>很多组件都需要在第一次加载完成后，启动一个计时器，然后在组件销毁时卸载</li>
</ol>
<blockquote>
<p>使用Hook的时候，如果没有严格按照Hook的规则进行，eslint的一个插件（eslint-plugin-react-hooks）会报出警告</p>
<p>使用HOC高阶组件也可以实现代码抽离效果，但是比起自定义Hook，比较繁琐，且会让组件层次变深。而且如果有多个层次的代码需要抽离，就要定义多个高阶组件，不如自定义Hook方便简洁。Hook能完成更细粒度的封装。（renderProps也可以实现，具体可以回看前面的）</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getAllStudents &#125; <span class="keyword">from</span> <span class="string">&quot;../services/student&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当组件首次加载完成后，获取所有学生数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useAllStudents</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [students, setStudents] = <span class="title function_">useState</span>([])</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        (<span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">            <span class="keyword">const</span> stus = <span class="keyword">await</span> <span class="title function_">getAllStudents</span>();</span><br><span class="line">            <span class="title function_">setStudents</span>(stus);</span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> students;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据页码和页容量获取学生数据，得到一个响应结果</span></span><br><span class="line"><span class="comment"> * 并且，当页码和页容量变化时，将重新获取学生数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useAllStudents</span>(<span class="params">page = <span class="number">1</span>, limit = <span class="number">10</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [resp, setResp] = <span class="title function_">useState</span>()</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> resp = <span class="keyword">await</span> <span class="title function_">getStudents</span>(page, limit);</span><br><span class="line">            <span class="title function_">setResp</span>(resp);</span><br><span class="line">        &#125;)();</span><br><span class="line">    &#125;, [page, limit])</span><br><span class="line">    <span class="keyword">return</span> resp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> stus = <span class="title function_">useAllStudents</span>(); <span class="comment">// 就等于把上述代码放到一个函数里执行了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、Reducer-Hook"><a href="#五、Reducer-Hook" class="headerlink" title="五、Reducer Hook"></a>五、Reducer Hook</h2><p>Flux：Facebook出品的一个数据流框架</p>
<ol>
<li>规定了数据是单向流动的</li>
<li>数据存储在数据仓库中（目前，可以认为state就是一个存储数据的仓库）</li>
<li>action是改变数据的唯一原因（本质上就是一个对象，action有两个属性）<ol>
<li>type：字符串，动作的类型</li>
<li>payload：任意类型，动作发生后的附加信息</li>
<li>例如，如果是添加一个学生，action可以描述为：<ol>
<li><code>&#123; type:&quot;addStudent&quot;, payload: &#123;学生对象的各种信息&#125; &#125;</code></li>
</ol>
</li>
<li>例如，如果要删除一个学生，action可以描述为：<ol>
<li><code>&#123; type:&quot;deleteStudent&quot;, payload: 学生id &#125;</code></li>
</ol>
</li>
</ol>
</li>
<li>具体改变数据的是一个函数，该函数叫做reducer<ol>
<li>该函数接收两个参数<ol>
<li>state：表示当前数据仓库中的数据</li>
<li>action：描述了如何去改变数据，以及改变数据的一些附加信息</li>
</ol>
</li>
<li>该函数必须有一个返回结果，用于表示数据仓库变化之后的数据<ol>
<li>Flux要求，对象是不可变的，如果返回对象，必须创建新的对象</li>
</ol>
</li>
<li>reducer必须是纯函数，不能有任何副作用</li>
</ol>
</li>
<li>如果要触发reducer，不可以直接调用，而是应该调用一个辅助函数dispatch<ol>
<li>该函数仅接收一个参数：action</li>
<li>该函数会间接去调用reducer，以达到改变数据的目的</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个简单的flux数据流</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该函数，根据当前的数据，已经action，生成一个新的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; state </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; action </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;increase&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;decrease&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> (state === <span class="number">0</span>) &#123; <span class="comment">// 在这里只改变数据，与组件无关，纯净</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用的useReducer函数 官方提供相同的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; reducer reducer函数，标准格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; initialState 初始状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; initFunc 用于计算初始值的函数，该函数的返回值会作为初始值，第二个参数会当作参数传入到该函数中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">useReducer</span>(<span class="params">reducer, initialState, initFunc</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initFunc? <span class="title function_">initFunc</span>(initialState): initialState)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> newState = <span class="title function_">reducer</span>(state, action)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`日志：n的值  <span class="subst">$&#123;state&#125;</span>-&gt;<span class="subst">$&#123;newState&#125;</span>`</span>)</span><br><span class="line">        <span class="title function_">setState</span>(newState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [state, dispatch];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 将下面两段代码抽离成通用的useReducer函数</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> newN = <span class="title function_">reducer</span>(n,action)</span><br><span class="line">        <span class="title function_">setN</span>(newN)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// const [n, dispatch] = useReducer(reducer, 0) 作用同上</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                dispatch(&#123; type: &quot;decrease&quot; &#125;)</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;n&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                dispatch(&#123; type: &quot;increase&quot; &#125;)</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、Context-Hook"><a href="#六、Context-Hook" class="headerlink" title="六、Context Hook"></a>六、Context Hook</h2><p>用于获取上下文数据，比起过去的方法可以减少组件嵌套</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = <span class="title class_">React</span>.<span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// function Test() &#123;</span></span><br><span class="line"><span class="comment">//     return &lt;ctx.Consumer&gt;</span></span><br><span class="line"><span class="comment">//         &#123;value =&gt; &lt;h1&gt;Test，上下文的值：&#123;value&#125;&lt;/h1&gt;&#125;</span></span><br><span class="line"><span class="comment">//     &lt;/ctx.Consumer&gt;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="title function_">useContext</span>(ctx);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Test，上下文的值：&#123;value&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ctx.Provider</span> <span class="attr">value</span>=<span class="string">&quot;abc&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Test</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ctx.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、Callback-Hook"><a href="#七、Callback-Hook" class="headerlink" title="七、Callback Hook"></a>七、Callback Hook</h2><p>函数名：useCallback</p>
<p>用于得到一个固定引用值的函数，通常用它进行性能优化</p>
<p>useCallback:</p>
<p>该函数有两个参数：</p>
<ol>
<li>函数，useCallback会固定该函数的引用，只要依赖项没有发生变化，则始终返回之前函数的地址</li>
<li>数组，记录依赖项</li>
</ol>
<p>该函数返回：引用相对固定的函数地址</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.PureComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Test Render&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.props.text&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.props.onClick&#125;</span>&gt;</span>改变文本<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Parent Render&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> [txt, setTxt] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setTxt</span>(txt + <span class="number">1</span>)</span><br><span class="line">    &#125;, [txt])</span><br><span class="line">	<span class="comment">/** const handleClick =  () =&gt; &#123;</span></span><br><span class="line"><span class="comment">        setTxt(txt + 1) 这样写的话每次调用Parent同样会生成一个新的函数地址</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 函数的地址每次渲染都发生了变化，导致了子组件跟着重新渲染，若子组件是经过优化的组件，则可能导致优化失效 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Test</span> <span class="attr">text</span>=<span class="string">&#123;txt&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 这样写Parent组件和Test组件都不会重新渲染，因为txt的值没变，Parent不会重新渲染，从而Test也就不会重新渲染 */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;/* <span class="tag">&lt;<span class="name">Test</span> <span class="attr">text</span>=<span class="string">&#123;txt&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span> setTxt(1)&#125; /&gt; */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;n&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    setN(parseInt(e.target.value))</span></span><br><span class="line"><span class="language-xml">                    &#123;/* 这样写Parent组件和Test组件都会重新渲染，n改变了，Parent组件重新渲染理所当然，但是txt没变为什么Test组件也会重新渲染呢（这里的						前提是Test组件onClick传入的是一个箭头函数），因为每次调用Parent，都会生成一个新的箭头函数，地址改变了 */&#125;</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Parent</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、Memo-Hook"><a href="#八、Memo-Hook" class="headerlink" title="八、Memo Hook"></a>八、Memo Hook</h2><p>用于保持一些比较稳定的数据，通常用于性能优化</p>
<p><strong>如果React元素本身的引用没有发生变化，一定不会重新渲染</strong></p>
<blockquote>
<p>useCallback 一般用于固定函数引用，useMemo可以用于固定任何值</p>
<p>为什么要做这些事情呢，因为相比于类组件每次只运行一次构造函数，之后都是调用生命周期和render方法。而函数组件每次都会调用这个函数，有些东西需要在多次调用函数的时候保持统一，不管是为了效率或是其他。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Parent Render&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> [txt, setTxt] = <span class="title function_">useState</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> handleClick = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      	<span class="comment">// 仔细看与useCallBack那个函数的区别，useCallBack固定的是传递的函数的地址，而useMemo是传递的函数的返回值的地址</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">setTxt</span>(txt + <span class="number">1</span>)</span><br><span class="line">    &#125;, [txt])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Test</span> <span class="attr">text</span>=<span class="string">&#123;txt&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;n&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    setN(parseInt(e.target.value))</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>举例使用</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useMemo &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Item</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&quot;Item Render &quot; + props.value);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;props.value&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [range,] = <span class="title function_">useState</span>(&#123; <span class="attr">min</span>: <span class="number">1</span>, <span class="attr">max</span>: <span class="number">10000</span> &#125;)</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> list = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> list = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = range.<span class="property">min</span>; i &lt;= range.<span class="property">max</span>; i++) &#123;</span><br><span class="line">            list.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> <span class="attr">value</span>=<span class="string">&#123;i&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;, [range.<span class="property">min</span>, range.<span class="property">max</span>]) <span class="comment">// 只要range不变就不会重新计算</span></span><br><span class="line">    <span class="comment">// 补充：list数组和上次是一样的，不像之前都是用map得到一个新数组，React元素是通过React.createElement()创建的，数组也是通过这种方式创建			   的，生成一个数组节点，数组没变化，数组里面的React元素也不会变化，如果这个React元素本身没有发生变化，一定不会重新渲染，甚至连对比更新都不会进行。</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// const list = []; 如果改了n,会重新运行函数，从而这段代码也会重新运行，严重影响效率</span></span><br><span class="line">    <span class="comment">// for (let i = range.min; i &lt;= range.max; i++) &#123;</span></span><br><span class="line">    <span class="comment">//     list.push(&lt;Item key=&#123;i&#125; value=&#123;i&#125;&gt;&lt;/Item&gt;)</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;list&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;n&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    setN(parseInt(e.target.value))</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、Ref-Hook"><a href="#九、Ref-Hook" class="headerlink" title="九、Ref Hook"></a>九、Ref Hook</h2><p>useRef函数：</p>
<ol>
<li>一个参数：默认值</li>
<li>返回一个固定的对象，<code>&#123;current: 值&#125;</code></li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">arr</span> = [];</span><br><span class="line"><span class="comment">// const inpRef = React.createRef(); 直接写在这里，如果创建了两个App组件实例，它们会使用同一个Ref对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* const inpRef = React.createRef();</span></span><br><span class="line"><span class="comment">    window.arr.push(inpRef); // 我们会发现每次重新运行App函数都会创建一个Ref对象，这些对象都不相同，然后添加到数组中，Ref没必要每次都重新创建一个新的</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">const</span> inpRef = <span class="title function_">useRef</span>(); <span class="comment">// 这种写法不会有上述问题，都是同一个Ref对象</span></span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inpRef&#125;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(inpRef.current.value)</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;得到input的值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">value</span>=<span class="string">&#123;n&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    setN(e.target.value)</span></span><br><span class="line"><span class="language-xml">                &#125;&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>补充案例</strong>：可以用useRef给每个节点一个固定的对象</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计时器案例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// let timer; 之前timer是写在这里的，但是会有一个问题，如果App使用多次，其中一个组件卸载，就会导致其他组件的timer被卸载</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [n, setN] = <span class="title function_">useState</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">const</span> timerRef = <span class="title function_">useRef</span>() <span class="comment">// 每一个节点用一个timer</span></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timerRef.<span class="property">current</span> = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(n)</span><br><span class="line">            <span class="title function_">setN</span>(n - <span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timerRef.<span class="property">current</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [n])</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;n&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十、ImperativeHandle-Hook"><a href="#十、ImperativeHandle-Hook" class="headerlink" title="十、ImperativeHandle Hook"></a>十、ImperativeHandle Hook</h2><p>函数：useImperativeHandleHook</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类组件中，直接在父组件中调用子组件内部的方法</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">method</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Test method called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Test Component<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> testRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Test</span> <span class="attr">ref</span>=<span class="string">&#123;testRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                testRef.current.method();</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;点击调用Test组件的method方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef, useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Test</span>(<span class="params">props, ref</span>) &#123; <span class="comment">// ref转发后，会把ref传递到包装的那个组件上去，然后自行处理即可</span></span><br><span class="line">    <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> &#123; <span class="comment">// 第一个参数是传一个ref，第二个参数是给ref.current赋一个初值</span></span><br><span class="line">        <span class="comment">//如果不给依赖项，则每次运行函数组件都会调用该方法</span></span><br><span class="line">        <span class="comment">//如果使用了依赖项，则第一次调用后，会进行缓存，只有依赖项发生变化时才会重新调用函数</span></span><br><span class="line">        <span class="comment">//相当于给 ref.current = 下面返回的对象</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="title function_">method</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Test Component Called&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Test Component<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TestWrapper</span> = <span class="title class_">React</span>.<span class="title function_">forwardRef</span>(<span class="title class_">Test</span>) <span class="comment">// 回忆一下，高阶组件包装函数组件，实现ref转发</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// const [, forceUpdate] = useState(&#123;&#125;)</span></span><br><span class="line">    <span class="keyword">const</span> testRef = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">TestWrapper</span> <span class="attr">ref</span>=<span class="string">&#123;testRef&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                testRef.current.method();</span></span><br><span class="line"><span class="language-xml">                // console.log(testRef)</span></span><br><span class="line"><span class="language-xml">                // forceUpdate(&#123;&#125;)</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;&gt;点击调用Test组件的method方法<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十一、LayoutEffect-Hook"><a href="#十一、LayoutEffect-Hook" class="headerlink" title="十一、LayoutEffect Hook"></a>十一、LayoutEffect Hook</h2><p>useEffect：浏览器渲染完成后，用户看到新的渲染结果之后<br>useLayoutEffectHook：完成了DOM改动，但还没有呈现给用户</p>
<p>它们两个除了时间点不一样，其他没区别。应该尽量使用useEffect，因为它不会导致渲染阻塞，如果出现了问题，再考虑使用useLayoutEffectHook</p>
<blockquote>
<p>补充：如果对dom进行了改动（同步）-&gt;useLayoutEffectHook，它不会立即渲染，而是要等到浏览器下一次渲染时间点到达，然后对比差异进行渲染（异步），用户看到效果-&gt;useEffect。如果要操纵Dom尽量在useLayoutEffectHook进行操作，但是会阻塞渲染。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/21/678f53ad1a814.png"></p>
<h2 id="十二、DebugValue-Hook"><a href="#十二、DebugValue-Hook" class="headerlink" title="十二、DebugValue Hook"></a>十二、DebugValue Hook</h2><p>useDebugValue：用于将自定义Hook的关联数据显示到调试栏</p>
<p>如果创建的自定义Hook通用性比较高，可以选择使用useDebugValue方便调试</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect, useDebugValue &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useTest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [students, ] = <span class="title function_">useState</span>([])</span><br><span class="line">    <span class="title function_">useDebugValue</span>(<span class="string">&quot;学生集合&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> students;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">useState</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="title function_">useState</span>(<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;effect&quot;</span>)</span><br><span class="line">    &#125;, [])</span><br><span class="line">    <span class="title function_">useTest</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十三、React动画"><a href="#十三、React动画" class="headerlink" title="十三、React动画"></a>十三、React动画</h2><p>这里先跳过，回头补充</p>
<h1 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h1><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>React路由</p>
<h3 id="1-站点"><a href="#1-站点" class="headerlink" title="1.站点"></a>1.站点</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/21/678f54c4a7131.png"></p>
<p>无论是使用Vue，还是React，开发的单页应用程序，可能只是该站点的一部分（某一个功能块）</p>
<p>一个单页应用里，可能会划分为多个页面（几乎完全不同的页面效果）（组件）</p>
<p>如果要在单页应用中完成组件的切换，需要实现下面两个功能：</p>
<ol>
<li>根据不同的页面地址，展示不同的组件（核心）</li>
<li>完成无刷新的地址切换</li>
</ol>
<p>我们把实现了以上两个功能的插件，称之为路由</p>
<h3 id="2-React-Router"><a href="#2-React-Router" class="headerlink" title="2.React Router"></a>2.React Router</h3><ol>
<li>react-router：路由核心库，包含诸多和路由功能相关的核心代码</li>
<li>react-router-dom：利用路由核心库，结合实际的页面，实现跟页面路由密切相关的功能</li>
</ol>
<p>如果是在页面中实现路由，需要安装react-router-dom库，该库依赖react-router</p>
<h2 id="二、两种模式"><a href="#二、两种模式" class="headerlink" title="二、两种模式"></a>二、两种模式</h2><p>路由：根据不同的页面地址，展示不同的组件</p>
<p>url地址组成</p>
<p>例：<a target="_blank" rel="noopener" href="https://www.react.com/news/1-2-1.html?a=1&b=2#abcdefg">https://www.react.com:443/news/1-2-1.html?a=1&amp;b=2#abcdefg</a></p>
<ol>
<li>协议名(schema)：https</li>
<li>主机名(host)：<a target="_blank" rel="noopener" href="http://www.react.com/">www.react.com</a><ol>
<li>ip地址</li>
<li>预设值：localhost</li>
<li>域名</li>
<li>局域网中电脑名称</li>
</ol>
</li>
<li>端口号(port)：443<ol>
<li>如果协议是http，端口号是80，则可以省略端口号</li>
<li>如果协议是https，端口号是443，则可以省略端口号</li>
</ol>
</li>
<li>路径(path)：&#x2F;news&#x2F;1-2-1.html</li>
<li>地址参数(search、query)：?a&#x3D;1&amp;b&#x3D;2<ol>
<li>附带的数据</li>
<li>格式：属性名&#x3D;属性值&amp;属性名&#x3D;属性值….</li>
</ol>
</li>
<li>哈希(hash、锚点)<ol>
<li>附带的数据</li>
</ol>
</li>
</ol>
<h3 id="1-Hash-Router-哈希路由"><a href="#1-Hash-Router-哈希路由" class="headerlink" title="1.Hash Router 哈希路由"></a>1.Hash Router 哈希路由</h3><p>根据url地址中的哈希值来确定显示的组件</p>
<blockquote>
<p>原因：hash的变化，不会导致页面刷新<br>这种模式的兼容性最好</p>
<p>浏览器获取hash的方式：window.location.hash</p>
</blockquote>
<h3 id="2-Borswer-History-Router-浏览器历史记录路由"><a href="#2-Borswer-History-Router-浏览器历史记录路由" class="headerlink" title="2.Borswer History Router 浏览器历史记录路由"></a>2.Borswer History Router 浏览器历史记录路由</h3><p>HTML5出现后，新增了History Api，从此以后，浏览器拥有了改变路径而不刷新页面的方式</p>
<p>History表示浏览器的历史记录，它使用栈的方式存储。历史记录是和窗口（标签页）绑定的，每个窗口不相通</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/21/678f5b22d8c28.png"></p>
<ol>
<li>history.length：获取栈中数据量</li>
<li>history.pushState：向当前历史记录栈中加入一条新的记录<ol>
<li>参数1：附加的数据，自定义的数据，可以是任何类型</li>
<li>参数2：页面标题，目前大部分浏览器不支持</li>
<li>参数3：新的地址</li>
</ol>
</li>
<li>history.replaceState：将当前指针指向的历史记录，替换为某个记录<ol>
<li>参数1：附加的数据，自定义的数据，可以是任何类型</li>
<li>参数2：页面标题，目前大部分浏览器不支持</li>
<li>参数3：新的地址</li>
</ol>
</li>
</ol>
<p>根据页面的路径决定渲染哪个组件</p>
<h2 id="三、路由组件"><a href="#三、路由组件" class="headerlink" title="三、路由组件"></a>三、路由组件</h2><p>React-Router 为我们提供了两个重要组件</p>
<h3 id="1-Router组件"><a href="#1-Router组件" class="headerlink" title="1.Router组件"></a>1.Router组件</h3><p>它本身不做任何展示，仅提供路由模式配置，另外，该组件会产生一个上下文，上下文中会提供一些实用的对象和方法，供其他相关组件使用</p>
<ol>
<li>HashRouter：该组件，使用hash模式匹配</li>
<li>BrowserRouter：该组件，使用BrowserHistory模式匹配</li>
</ol>
<p>通常情况下，Router组件只有一个，将该组件包裹整个页面</p>
<h3 id="2-Route组件"><a href="#2-Route组件" class="headerlink" title="2.Route组件"></a>2.Route组件</h3><p>根据不同的地址，展示不同的组件</p>
<p>重要属性：</p>
<ol>
<li>path：匹配的路径<ol>
<li>默认情况下，不区分大小写，可以设置sensitive属性为true，来区分大小写</li>
<li>默认情况下，只匹配初始目录，如果要精确匹配，配置exact属性为true。如果不是精准匹配，浏览器路径改为<code>/a/b</code>，组件A的路径为<code>/a</code>，组件B的路径为<code>/a/b</code>，则两个组件都会显示</li>
<li>如果不写path，则会匹配任意路径</li>
</ol>
</li>
<li>component：匹配成功后要显示的组件</li>
<li>children：<ol>
<li>传递React元素，无论是否匹配，一定会显示children，并且会忽略component属性</li>
<li>传递一个函数，该函数有多个参数，这些参数来自于上下文，该函数返回react元素，则一定会显示返回的元素，并且忽略component属性</li>
</ol>
</li>
</ol>
<p>Route组件可以写到任意的地方，只要保证它是Router组件的后代元素</p>
<h3 id="3-Switch组件"><a href="#3-Switch组件" class="headerlink" title="3.Switch组件"></a>3.Switch组件</h3><p>写到Switch组件中的Route组件，当匹配到第一个Route后，会立即停止匹配（用Switch组件包裹Route组件即可）</p>
<p>由于Switch组件会循环所有子元素，然后让每个子元素去完成匹配，若匹配到，则渲染对应的组件，然后停止循环。因此，不能在Switch的子元素中使用除Route外的其他组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   /a</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>组件A<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//   /b</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>组件B<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任意路径</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">C</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        找不到页面</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/abc&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;D&#125;</span> /&gt;</span> // Route组件可以写到任意的地方，只要保证它是Router组件的后代元素</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">D</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>D组件<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Route组件可以认为是：</span></span><br><span class="line"><span class="comment">// class Route extends React.Component &#123;</span></span><br><span class="line"><span class="comment">//     render() &#123;</span></span><br><span class="line"><span class="comment">//         if (是否匹配(this.props.path)) &#123;</span></span><br><span class="line"><span class="comment">//             const Comp = this.props.component;</span></span><br><span class="line"><span class="comment">//             return &lt;Comp /&gt;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         return null;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/a&quot;</span> <span class="attr">component</span>=<span class="string">&#123;A&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    只要进行了对/a的匹配，也就是渲染了Route组件（不理解看注释代码），不管是否能匹配到，必定会看到，并忽略component属性，如果Route被					 	Switch包裹，就无法显示，因为现在的匹配是Switch进行的，匹配到才会渲染Route组件</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/b&quot;</span> <span class="attr">component</span>=<span class="string">&#123;B&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/c&quot;</span> <span class="attr">component</span>=<span class="string">&#123;C&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>后面的demo可以再看下，主要学习路由怎么设计</strong></p>
<h2 id="四、路由信息"><a href="#四、路由信息" class="headerlink" title="四、路由信息"></a>四、路由信息</h2><p>Router组件会创建一个上下文，并且，向上下文中注入一些信息</p>
<p>该上下文对开发者是隐藏的，Route组件若匹配到了地址，则会将这些上下文中的信息作为属性传入对应的组件</p>
<h3 id="1-history"><a href="#1-history" class="headerlink" title="1.history"></a>1.history</h3><p>它并不是window.history对象，我们利用该对象无刷新跳转地址</p>
<p><strong>为什么没有直接使用history对象</strong></p>
<ol>
<li>React-Router中有两种模式：Hash、History，如果直接使用window.history，只能支持一种模式</li>
<li>当使用windows.history.pushState方法时，没有办法收到任何通知，将导致React无法知晓地址发生了变化，结果导致无法重新渲染组件</li>
</ol>
<ul>
<li>push：将某个新的地址入栈（历史记录栈）<ul>
<li>参数1：新的地址</li>
<li>参数2：可选，附带的状态数据</li>
</ul>
</li>
<li>replace：将某个新的地址替换掉当前栈中的地址</li>
<li>go: 与window.history一致</li>
<li>forward: 与window.history一致</li>
<li>back: 与window.history一致</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">push</span>(<span class="string">&#x27;/abc&#x27;</span>,<span class="string">&#x27;参数&#x27;</span>) <span class="comment">// 跳转完成后，上下文数据发生变化，组件重新渲染</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="property">location</span>.<span class="property">state</span> <span class="comment">// 拿到传递的参数，这个并不常用，因为一般参数都写在路径上面</span></span><br></pre></td></tr></table></figure>

<h3 id="2-location"><a href="#2-location" class="headerlink" title="2.location"></a>2.location</h3><p>与history.location完全一致，是同一个对象，但是，与window.location不同</p>
<p>location对象中记录了当前地址的相关信息</p>
<p>我们通常使用第三方库<code>query-string</code>，用于解析地址栏中的数据，比如把传递的参数字符串<code>?a=1&amp;b=2&amp;c=3</code>给解析成一个对象，具体查看该库文档</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="property">location</span> === <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="3-match"><a href="#3-match" class="headerlink" title="3.match"></a>3.match</h3><p>该对象中保存了，路由匹配的相关信息</p>
<ul>
<li>isExact：事实上，当前的路径和路由配置的路径是否是精确匹配的</li>
<li>params：获取路径规则中对应的数据</li>
</ul>
<p>实际上，在书写Route组件的path属性时，可以书写一个<code>string pattern</code>（字符串正则）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Route</span> path=<span class="string">&#x27;/news/:year/:month/:day&#x27;</span>&gt;&lt;/<span class="title class_">Route</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/news/:year?/:month?/:day?&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span> <span class="comment">// 和正则一样，加上问号代表这个参数可有可无</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/news/:year(\d+)/:month(\d+)/:day(\d+)&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span> <span class="comment">// 参数都要是数字</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/news/:year(\d+)/:month(\d+)/:day(\d+)/*&#x27;</span> <span class="attr">exact</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span> <span class="comment">// 前面的年月日得符合规则，后面还需要有内容，什么都行</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;[</span>&#x27;/<span class="attr">news</span>&#x27;,&#x27;/<span class="attr">news</span>/<span class="attr">:year</span>/<span class="attr">:month</span>/<span class="attr">:day</span>&#x27;,&#x27;/<span class="attr">n</span>&#x27;]&#125; <span class="attr">exact</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span> <span class="comment">// 补充，路径可以写数组，符合其中一个就会匹配成功</span></span><br></pre></td></tr></table></figure>

<p>react-router使用了第三方库：Path-to-RegExp，该库的作用是，将一个字符串正则转换成一个真正的正则表达式。</p>
<p><strong>向某个页面传递数据的方式：</strong></p>
<ol>
<li>使用state：在push页面时，加入state</li>
<li><strong>利用search：把数据填写到地址栏中的？后</strong></li>
<li>利用hash：把数据填写到hash后</li>
<li><strong>params：把数据填写到路径中</strong><code>例如：/news/2019/8/6</code></li>
</ol>
<h3 id="4-非路由组件获取路由信息"><a href="#4-非路由组件获取路由信息" class="headerlink" title="4.非路由组件获取路由信息"></a>4.非路由组件获取路由信息</h3><p>某些组件，并没有直接放到Route中，而是嵌套在其他普通组件中，因此，它的props中没有路由信息，如果这些组件需要获取到路由信息，可以使用下面两种方式：</p>
<ol>
<li>将路由信息从父组件一层一层传递到子组件</li>
<li>使用react-router提供的高阶组件withRouter，包装要使用的组件，该高阶组件会返回一个新组件，新组件将向提供的组件注入路由信息。</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span>, withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AWrapper</span> = <span class="title function_">withRouter</span>(A);</span><br><span class="line"></span><br><span class="line"><span class="comment">// function withRouter(Comp) &#123;</span></span><br><span class="line"><span class="comment">//     return function routerWrapper(props) &#123;</span></span><br><span class="line"><span class="comment">//         //获取上下文中的信息</span></span><br><span class="line"><span class="comment">//         return &lt;Comp &#123;...props&#125; history=&#123;上下文中的history&#125; /&gt;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">News</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>新闻列表<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">AWrapper</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(props)</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        props.history.push(&quot;/&quot;); // 如果不用withRouter包装，会报错，因为没有直接放到Route中，因此，它的props中没有路由信息</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;点击返回<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Index</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NotFound</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>找不到页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/news&quot;</span> <span class="attr">component</span>=<span class="string">&#123;News&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Index&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;NotFound&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>后面的demo也可以再看下，主要学习根据页面路径重新查询，主要在于将页面路径和查询条件混合，页面路径改变，就等于路由上下文改变，会触发重新渲染，用条件查询的时候也用history.push改变页面路径参数</strong></p>
<h2 id="五、其他组件"><a href="#五、其他组件" class="headerlink" title="五、其他组件"></a>五、其他组件</h2><p>已学习：</p>
<ul>
<li>Router：BrowswerRouter、HashRouter</li>
<li>Route</li>
<li>Switch</li>
<li>高阶函数：withRouter</li>
</ul>
<h3 id="1-Link"><a href="#1-Link" class="headerlink" title="1.Link"></a>1.Link</h3><p>生成一个无刷新跳转的a元素</p>
<ul>
<li><p>to</p>
<ul>
<li>字符串：跳转的目标地址</li>
<li>对象：<ul>
<li>pathname：url路径</li>
<li>search</li>
<li>hash</li>
<li>state：附加的状态信息</li>
</ul>
</li>
</ul>
</li>
<li><p>replace：bool，表示是否是替换当前地址，默认是false</p>
</li>
<li><p>innerRef：可以将内部的a元素的ref附着在传递的对象或函数参数上</p>
<ul>
<li>函数</li>
<li>ref对象</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">NavBar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">innerRef</span>=<span class="string">&#123;node</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-xml">            console.log(node) // 打印的是内部a元素的ref</span></span><br><span class="line"><span class="language-xml">        &#125;&#125; to=&quot;/a&quot; style=&#123;&#123; marginRight: 20 &#125;&#125;&gt;去a页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">replace</span> <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">pathname:</span> &quot;/<span class="attr">b</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">hash:</span> &quot;#<span class="attr">abc</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">search:</span> &quot;?<span class="attr">a</span>=<span class="string">1&amp;b</span>=<span class="string">2</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span>去b页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手写Link</span></span><br><span class="line"><span class="comment">/* eslint &#123;&quot;jsx-a11y/anchor-is-valid&quot;:&quot;off&quot;, &quot;no-script-url&quot;:&quot;off&quot;&#125; */</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Link</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;props.to&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            e.preventDefault();</span></span><br><span class="line"><span class="language-xml">            props.history.push(props.to)</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;&gt;&#123;props.children&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">Link</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-NavLink"><a href="#2-NavLink" class="headerlink" title="2.NavLink"></a>2.NavLink</h3><p>是一种特殊的Link，Link组件具备的功能，它都有</p>
<p>它具备的额外功能是：根据当前地址和链接地址，来决定该链接的样式</p>
<ul>
<li>activeClassName: 匹配时使用的类名</li>
<li>activeStyle: 匹配时使用的内联样式</li>
<li>exact: 是否精确匹配</li>
<li>sensitive：匹配时是否区分大小写</li>
<li>strict：是否严格匹配最后一个斜杠</li>
</ul>
<h3 id="3-Redirect"><a href="#3-Redirect" class="headerlink" title="3.Redirect"></a>3.Redirect</h3><p>重定向组件，当加载到该组件时，会自动跳转（无刷新）到另外一个地址</p>
<ul>
<li>to：跳转的地址<ul>
<li>字符串</li>
<li>对象</li>
</ul>
</li>
<li>push: 默认为false，表示跳转使用替换的方式，设置为true后，则使用push的方式跳转</li>
<li>from：当匹配到from地址规则时才进行跳转 <code>&lt;Redirect from=&quot;/abc/:id&quot; to=&quot;/a/:id&quot; /&gt; to的那个地址可以拿到from那个地址传的id</code></li>
<li>exact: 是否精确匹配from</li>
<li>sensitive：from匹配时是否区分大小写</li>
<li>strict：from是否严格匹配最后一个斜杠</li>
</ul>
<h2 id="六、常见应用"><a href="#六、常见应用" class="headerlink" title="六、常见应用"></a>六、常见应用</h2><p><strong>路由嵌套</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">&#123;match&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>User组件固定的区域<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">update</span>`&#125;&gt;</span>用户信息<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">pay</span>`&#125;&gt;</span>充值<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123; /* 这样写的目的是防止上级路由路径更换，这里还得一个个改,match.url得到的是匹配地方的路径 **/ &#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">height:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">background:</span> &quot;<span class="attr">lightblue</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">border:</span> &quot;<span class="attr">2px</span> <span class="attr">solid</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">margin:</span> &quot;<span class="attr">0</span> <span class="attr">auto</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* User组件变化的区域：根据地址的不同发生变化 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">update</span>`&#125; <span class="attr">component</span>=<span class="string">&#123;UserUpdate&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">pay</span>`&#125; <span class="attr">component</span>=<span class="string">&#123;UserPay&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>修改用户信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserPay</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户充值<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/u&quot;</span> <span class="attr">component</span>=<span class="string">&#123;User&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 其他组件 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>抽离路径规则</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">user</span>: &#123;</span><br><span class="line">        <span class="attr">root</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">        <span class="attr">update</span>: <span class="string">&quot;/update&quot;</span>,</span><br><span class="line">        <span class="attr">pay</span>: &#123;</span><br><span class="line">            <span class="attr">root</span>: <span class="string">&quot;/pay&quot;</span>,</span><br><span class="line">            <span class="attr">afterPay</span>: <span class="string">&quot;/after&quot;</span>,</span><br><span class="line">            <span class="attr">before</span>: <span class="string">&quot;/before&quot;</span> <span class="comment">// /user/pay/before</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setConfig</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">_setConfig</span>(config, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将该对象的每一个字符串属性，前面添加baseStr</span></span><br><span class="line"><span class="comment"> * 如果属性名为root，则直接添加baseStr</span></span><br><span class="line"><span class="comment"> * 如果属性名不是root，则添加baseStr/root属性值</span></span><br><span class="line"><span class="comment"> * 如果属性不是字符串，递归调用该方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; obj </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; baseStr </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_setConfig</span>(<span class="params">obj, baseStr</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newBaseUrl = baseStr + (obj.<span class="property">root</span> === <span class="literal">undefined</span> ? <span class="string">&quot;&quot;</span> : obj.<span class="property">root</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = obj[prop];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prop === <span class="string">&quot;root&quot;</span>) &#123;</span><br><span class="line">                obj[prop] = baseStr + value;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                obj[prop] = newBaseUrl + value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">_setConfig</span>(obj[prop], newBaseUrl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setConfig</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> config;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span>  routeConfig <span class="keyword">from</span> <span class="string">&quot;./RouteConfig&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">User</span>(<span class="params">&#123; match &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>User组件固定的区域<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;routeConfig.user.update&#125;</span>&gt;</span>用户信息<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;routeConfig.user.pay.root&#125;</span>&gt;</span>充值<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">width:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">height:</span> <span class="attr">500</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">background:</span> &quot;<span class="attr">lightblue</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">border:</span> &quot;<span class="attr">2px</span> <span class="attr">solid</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">margin:</span> &quot;<span class="attr">0</span> <span class="attr">auto</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* User组件变化的区域：根据地址的不同发生变化 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;routeConfig.user.update&#125;</span> <span class="attr">component</span>=<span class="string">&#123;UserUpdate&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;routeConfig.user.pay.root&#125;</span> <span class="attr">component</span>=<span class="string">&#123;UserPay&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>修改用户信息<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">UserPay</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户充值<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;routeConfig.user.root&#125;</span> <span class="attr">component</span>=<span class="string">&#123;User&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 其他组件 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、受保护的页面"><a href="#七、受保护的页面" class="headerlink" title="七、受保护的页面"></a>七、受保护的页面</h2><p>就是某些页面需要某种认证才能访问，例如登录</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/22/679088574a4c4.png"></p>
<p>访问某个页面，需要判断用户是否登录，就是看仓库是否有登录信息，可以在生命周期或者useEffect进行判断，但是需要校验的页面多了，就会有很多重复性的代码，受到之前高阶组件和自定义hook的启发，我们可以自定义一个路由组件，需要校验的路由直接把<code>Route</code>组件换成该组件即可，该组件封装主要用到render属性。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Redirect</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> loginInfo <span class="keyword">from</span> <span class="string">&quot;./loginInfo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">ProtectedRoute</span>(<span class="params">&#123; component: Component, children, render, ...rest &#125;</span>) &#123; </span><br><span class="line">	<span class="comment">// 去除掉传过来的component，children，render属性</span></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> &#123;<span class="attr">...rest</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">render</span>=<span class="string">&#123;values</span> =&gt;</span> &#123; </span></span><br><span class="line"><span class="language-xml">            // render和children的区别在于：render是匹配后才会运行，children无论是否匹配都会运行</span></span><br><span class="line"><span class="language-xml">            if (loginInfo.isLogin) &#123;</span></span><br><span class="line"><span class="language-xml">                //可以正常展示页面</span></span><br><span class="line"><span class="language-xml">                return <span class="tag">&lt;<span class="name">Component</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">            else &#123;</span></span><br><span class="line"><span class="language-xml">                // return <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                //     <span class="attr">pathname:</span> &quot;/<span class="attr">login</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                //     <span class="attr">search:</span> &quot;?<span class="attr">returnurl</span>=<span class="string">&quot; + values.location.pathname // 把当前路径带过去，方便登录后重新返回该页，地址栏里有返回路径</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                // &#125;&#125; /&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                return &lt;Redirect to=&#123;&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="tag"><span class="language-xml">                    pathname: &quot;</span>/<span class="attr">login</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">state:</span> <span class="attr">values.location.pathname</span> // <span class="attr">把当前路径带过去</span>，<span class="attr">方便登录后重新返回该页</span>，<span class="attr">地址栏里没有返回路径</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                &#125;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    /&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、实现vue路由模式"><a href="#八、实现vue路由模式" class="headerlink" title="八、实现vue路由模式"></a>八、实现vue路由模式</h2><p>路由配置文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&quot;./Home&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">News</span> <span class="keyword">from</span> <span class="string">&quot;./News&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NewsHome</span> <span class="keyword">from</span> <span class="string">&quot;./NewsHome&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NewsDetail</span> <span class="keyword">from</span> <span class="string">&quot;./NewsDetail&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">NewsSearch</span> <span class="keyword">from</span> <span class="string">&quot;./NewsSearch&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;/news&quot;</span>, <span class="attr">component</span>: <span class="title class_">News</span>, <span class="attr">name</span>: <span class="string">&quot;news&quot;</span>,</span><br><span class="line">        <span class="attr">children</span>: [</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;newsHome&quot;</span>, <span class="attr">exact</span>: <span class="literal">true</span>, <span class="attr">component</span>: <span class="title class_">NewsHome</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&quot;/dl&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;newsDetail&quot;</span>, <span class="attr">exact</span>: <span class="literal">true</span>, <span class="attr">component</span>: <span class="title class_">NewsDetail</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">path</span>: <span class="string">&quot;/ser&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;newsSearch&quot;</span>, <span class="attr">exact</span>: <span class="literal">true</span>, <span class="attr">component</span>: <span class="title class_">NewsSearch</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;home&quot;</span>, <span class="attr">component</span>: <span class="title class_">Home</span> &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>实现view-router：看不懂的话，可以选择性看看视频，这节主要是为了说明react-router的灵活性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> routeConfig <span class="keyword">from</span> <span class="string">&quot;./routeConfig&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据一个路由配置数组，遍历该数组，得到一组Route组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; routes </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRoutes</span>(<span class="params">routes, basePath</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title class_">Array</span>.<span class="title function_">isArray</span>(routes)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> rs = routes.<span class="title function_">map</span>(<span class="function">(<span class="params">rt, i</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; children, name, path, <span class="attr">component</span>: <span class="title class_">Component</span>, ...rest &#125; = rt;</span><br><span class="line">        <span class="keyword">let</span> newPath = <span class="string">`<span class="subst">$&#123;basePath&#125;</span><span class="subst">$&#123;path&#125;</span>`</span>;</span><br><span class="line">        newPath = newPath.<span class="title function_">replace</span>(<span class="regexp">/\/\//g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> &#123;<span class="attr">...rest</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">path</span>=<span class="string">&#123;newPath&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                <span class="attr">render</span>=<span class="string">&#123;values</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    return <span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...values</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123;getRoutes(rt.children, newPath)&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Component</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            /&gt;</span></span><br><span class="line">        )</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;rs&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Route组件，根据不同的路径，渲染顶级页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootRouter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/* 返回一组Route */&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;getRoutes(routeConfig, &quot;/&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以根据路由配置中的name跳转</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> routeConfig <span class="keyword">from</span> <span class="string">&quot;./routeConfig&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">BetterLink</span>(<span class="params">&#123; to, ...rest &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.<span class="property">name</span> &amp;&amp; <span class="keyword">typeof</span> to !== <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">        to.<span class="property">pathname</span> = <span class="title function_">getPathFromName</span>(to.<span class="property">name</span>, <span class="string">&quot;/&quot;</span>, routeConfig);</span><br><span class="line">        <span class="keyword">if</span> (to.<span class="property">pathname</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">`name属性值<span class="subst">$&#123;to.name&#125;</span>无效`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Link</span> &#123;<span class="attr">...rest</span>&#125; <span class="attr">to</span>=<span class="string">&#123;to&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据name的值，查找对应的path，没有考虑有params的情况</span></span><br><span class="line"><span class="comment"> * 如果有，会比较复杂，需要用到第三方库path-to-regexp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; name </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPathFromName</span>(<span class="params">name, baseUrl, routesArr</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> routesArr) &#123;</span><br><span class="line">        <span class="keyword">let</span> newPath = baseUrl + item.<span class="property">path</span>;</span><br><span class="line">        newPath = newPath.<span class="title function_">replace</span>(<span class="regexp">/\/\//g</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">name</span> === name) &#123;</span><br><span class="line">            <span class="keyword">return</span> newPath;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(item.<span class="property">children</span>)) &#123;</span><br><span class="line">                <span class="keyword">const</span> path = <span class="title function_">getPathFromName</span>(name, newPath, item.<span class="property">children</span>)</span><br><span class="line">                <span class="keyword">if</span> (path !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> path;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、导航守卫"><a href="#九、导航守卫" class="headerlink" title="九、导航守卫"></a>九、导航守卫</h2><p>导航守卫：当离开一个页面，进入另一个页面时，触发的事件</p>
<p>history对象</p>
<ul>
<li>listen: 添加一个监听器，监听地址的变化，当地址发生变化时，会调用传递的函数<ul>
<li>参数：函数，运行时间点：发生在即将跳转到新页面时<ul>
<li>参数1：location对象，记录当前的地址信息</li>
<li>参数2：action，一个字符串，表示进入该地址的方式<ul>
<li>POP：出栈<ul>
<li>通过点击浏览器后退、前进</li>
<li>调用history.go</li>
<li>调用history.goBack</li>
<li>调用history.goForward</li>
</ul>
</li>
<li>PUSH：入栈<ul>
<li>history.push</li>
</ul>
</li>
<li>REPLACE：替换<ul>
<li>history.replace</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>返回结果：函数，可以调用该函数取消监听</li>
</ul>
</li>
<li>block：设置一个阻塞，并同时设置阻塞消息，当页面发生跳转时，会进入阻塞，并将阻塞消息传递到路由根组件的getUserConfirmation方法。<ul>
<li>返回一个回调函数，用于取消阻塞器</li>
</ul>
</li>
</ul>
<p>路由根组件</p>
<ul>
<li>getUserConfirmation（该函数不设置阻塞是没用的）<ul>
<li>参数：函数<ul>
<li>参数1：阻塞消息（这里的参数1，是block传过来的，所以这两种类型也是block的参数类型）<ul>
<li>字符串消息</li>
<li>函数，函数的返回结果是一个字符串，用于表示阻塞消息<ul>
<li>参数1：location对象</li>
<li>参数2：action值</li>
</ul>
</li>
</ul>
</li>
<li>参数2：回调函数，调用该函数并传递true，则表示进入到新页面，否则，不做任何操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>写一个监听功能</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> prevLoaction, location, action, unBlock; <span class="comment">// 将在阻塞中获取的信息保存在全局变量里，方便在getUserConfirmation中拿到</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_GuardHelper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//添加阻塞，可以控制页面能不能跳转，阻塞只能设置一个，如果写了多个，后面会覆盖前面的。阻塞不管在哪个组件中添加，都会触发，因为上下文对象是同一个</span></span><br><span class="line">        unBlock = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">block</span>(<span class="function">(<span class="params">newLocation, ac</span>) =&gt;</span> &#123;</span><br><span class="line">            prevLoaction = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>;</span><br><span class="line">            location = newLocation;</span><br><span class="line">            action = ac;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加一个监听器，不能控制页面能不能跳转</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">unListen</span> = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">listen</span>(<span class="function">(<span class="params">location, action</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onChange</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> prevLoaction = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">location</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onChange</span>(prevLoaction, location, action, <span class="variable language_">this</span>.<span class="property">unListen</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">unBlock</span>();<span class="comment">//取消阻塞</span></span><br><span class="line">        <span class="comment">//卸载监听器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">unListen</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">GuardHelper</span> = <span class="title function_">withRouter</span>(_GuardHelper); <span class="comment">// 获取上下文</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RouteGuard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    handleConfirm = <span class="function">(<span class="params">msg, commit</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">onBeforeChange</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onBeforeChange</span>(prevLoaction, location, action, commit, unBlock);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_">commit</span>(<span class="literal">true</span>); <span class="comment">// 调用该函数才会跳转，默认值是window.confirm(msg)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">getUserConfirmation</span>=<span class="string">&#123;this.handleConfirm&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">GuardHelper</span> <span class="attr">onChange</span>=<span class="string">&#123;this.props.onChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RouteGuard</span>;</span><br></pre></td></tr></table></figure>

<p><strong>简单使用</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RouteGuard</span> <span class="keyword">from</span> <span class="string">&#x27;./RouteGuard&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Page1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Page2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">RouteGuard</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onBeforeChange</span>=<span class="string">&#123;(prev,</span> <span class="attr">cur</span>, <span class="attr">action</span>, <span class="attr">commit</span>, <span class="attr">unBlock</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(`页面想要从$&#123;prev.pathname&#125;跳转到$&#123;cur.pathname&#125;，跳转方式是$&#123;action&#125;，允许跳转`)</span></span><br><span class="line"><span class="language-xml">                commit(true);</span></span><br><span class="line"><span class="language-xml">                unBlock();//取消阻塞，仅阻塞了一次</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            onChange=&#123;(prevLocation, location, action, unListen) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                console.log(`日志：从$&#123;prevLocation.pathname&#125;进入页面$&#123;location.pathname&#125;，进入方式$&#123;action&#125;`)</span></span><br><span class="line"><span class="language-xml">                unListen();//取消监听，仅监听了一次</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/page1&quot;</span>&gt;</span>页面1<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/page2&quot;</span>&gt;</span>页面2<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/page1&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/page2&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page2&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">RouteGuard</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十、常见应用-路由切换动画"><a href="#十、常见应用-路由切换动画" class="headerlink" title="十、常见应用 - 路由切换动画"></a>十、常见应用 - 路由切换动画</h2><p>第三方动画库：react-transition-group</p>
<p>CSSTransition：用于为内部的DOM元素添加类样式，通过in属性决定内部的DOM处于退出还是进入阶段。</p>
<blockquote>
<p>这里不太重要，什么时候需要使用再看。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CSSTransition</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-transition-group&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;animate.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 该组件外不能套Switch</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">TransitionRoute</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">component</span>: <span class="title class_">Component</span>, ...rest &#125; = props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> &#123;<span class="attr">...rest</span>&#125; &gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;(&#123; match &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                return <span class="tag">&lt;<span class="name">CSSTransition</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">in</span>=<span class="string">&#123;match</span> ? <span class="attr">true</span> <span class="attr">:</span> <span class="attr">false</span>&#125; // <span class="attr">通过路由信息中的match判断判断路径是否匹配</span>，<span class="attr">从而判断内部的DOM处于退出还是进入阶段</span>。</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">classNames</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">enter:</span> &quot;<span class="attr">animated</span> <span class="attr">fast</span> <span class="attr">fadeInRight</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                        <span class="attr">exit:</span> &quot;<span class="attr">animated</span> <span class="attr">fast</span> <span class="attr">fadeOutLeft</span>&quot;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">mountOnEnter</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">unmountOnExit</span>=<span class="string">&#123;true&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                &gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Component</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十一、滚动条复位"><a href="#十一、滚动条复位" class="headerlink" title="十一、滚动条复位"></a>十一、滚动条复位</h2><p>单页应用程序的通病，因为是无刷新跳转，因为浏览器不知道页面变化了，滚动条不会恢复到顶部</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> timer1, timer2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 滚动条横向和纵向动画复位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">resetScroll</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer1);</span><br><span class="line">    <span class="built_in">clearInterval</span>(timer2);</span><br><span class="line">    <span class="keyword">var</span> html = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">    timer1 = <span class="title function_">animate</span>(html.<span class="property">scrollTop</span>, <span class="number">0</span>, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        html.<span class="property">scrollTop</span> = val;</span><br><span class="line">    &#125;)</span><br><span class="line">    timer2 = <span class="title function_">animate</span>(html.<span class="property">scrollLeft</span>, <span class="number">0</span>, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">        html.<span class="property">scrollLeft</span> = val;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在300毫秒之内，从指定的初始值，变化到结束值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; start </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; end </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params">start, end, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> tick = <span class="number">16</span>; <span class="comment">//每隔16毫秒完成一次变化</span></span><br><span class="line">    <span class="keyword">var</span> total = <span class="number">300</span>; <span class="comment">//总时间为1000毫秒</span></span><br><span class="line">    <span class="keyword">var</span> times = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(total / tick); <span class="comment">//变化的次数</span></span><br><span class="line">    <span class="keyword">var</span> curTimes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> dis = (end - start) / times; <span class="comment">//总距离/次数，每次运动的距离</span></span><br><span class="line">    <span class="keyword">var</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        curTimes++;</span><br><span class="line">        start += dis;</span><br><span class="line">        <span class="keyword">if</span> (curTimes === times) &#123;</span><br><span class="line">            start = end;</span><br><span class="line">            <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">callback</span>(start);</span><br><span class="line">    &#125;, tick)</span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-高阶组件"><a href="#1-高阶组件" class="headerlink" title="1.高阶组件"></a>1.高阶组件</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> reset <span class="keyword">from</span> <span class="string">&quot;./resetScroll&quot;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">withScroll</span>(<span class="params">Comp</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">ScrollWrapper</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">reset</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Comp</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-使用useEffect"><a href="#2-使用useEffect" class="headerlink" title="2.使用useEffect"></a>2.使用useEffect</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> reset <span class="keyword">from</span> <span class="string">&quot;./resetScroll&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">useScroll</span>(<span class="params">pathname</span>) &#123;</span><br><span class="line">    <span class="title function_">useEffect</span>(reset, [pathname])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-使用自定义的导航守卫"><a href="#3-使用自定义的导航守卫" class="headerlink" title="3.使用自定义的导航守卫"></a>3.使用自定义的导航守卫</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Route</span>, <span class="title class_">NavLink</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RouteGuard</span> <span class="keyword">from</span> <span class="string">&#x27;./RouteGuard&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span></span><br><span class="line"><span class="keyword">import</span> reset <span class="keyword">from</span> <span class="string">&quot;./resetScroll&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">RouteGuard</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;(prevLocation,</span> <span class="attr">location</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                if(prevLocation.pathname !== location.pathname)&#123; // 防止点击跳转相同的页面也会调用</span></span><br><span class="line"><span class="language-xml">                    reset();</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/page1&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page1&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/page2&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page2&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;nav&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/page1&quot;</span>&gt;</span>页面1<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/page2&quot;</span>&gt;</span>页面2<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">RouteGuard</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十二、阻止跳转"><a href="#十二、阻止跳转" class="headerlink" title="十二、阻止跳转"></a>十二、阻止跳转</h2><p>封装通用的添加阻塞组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prompt</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        <span class="attr">when</span>: <span class="literal">false</span>, <span class="comment">//当when为true的时候，添加阻塞</span></span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;&quot;</span> <span class="comment">//当阻塞时，跳转页面的提示消息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleBlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentDidUpdate</span>(<span class="params">prevProps, prevState</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleBlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title function_">handleBlock</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">when</span>) &#123;</span><br><span class="line">            <span class="comment">//添加阻塞</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">unBlock</span> = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">block</span>(<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">unBlock</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">unBlock</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">unBlock</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">unBlock</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withRouter</span>(<span class="title class_">Prompt</span>)</span><br></pre></td></tr></table></figure>

<p>简单使用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Prompt</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Page2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">val</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Prompt</span> <span class="attr">when</span>=<span class="string">&#123;this.state.val</span> !== <span class="string">&quot;&quot;</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">message</span>=<span class="string">&quot;别乱来，会导致数据丢失，真的要跳转吗？&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;this.state.val&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                    <span class="attr">onChange</span>=<span class="string">&#123;e</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                        this.setState(&#123;</span></span><br><span class="line"><span class="language-xml">                            val: e.target.value</span></span><br><span class="line"><span class="language-xml">                        &#125;)</span></span><br><span class="line"><span class="language-xml">                    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">                &gt;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Router源码"><a href="#Router源码" class="headerlink" title="Router源码"></a>Router源码</h1><p>先跳过。</p>
<h1 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h1><h2 id="一、Redux核心概念"><a href="#一、Redux核心概念" class="headerlink" title="一、Redux核心概念"></a>一、Redux核心概念</h2><p>action  reducer  store</p>
<h3 id="1-MVC"><a href="#1-MVC" class="headerlink" title="1.MVC"></a>1.MVC</h3><p>它是一个UI的解决方案，用于降低UI，以及UI关联的数据的复杂度。</p>
<p><strong>传统的服务器端的MVC</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/23/679199e9a75e3.png"></p>
<p>环境：</p>
<ol>
<li>服务端需要响应一个完整的HTML</li>
<li>该HTML中包含页面需要的数据</li>
<li>浏览器仅承担渲染页面的作用</li>
</ol>
<p>以上的这种方式叫做<strong>服务端渲染</strong>，即服务器端将完整的页面组装好之后，一起发送给客户端。</p>
<p>服务器端需要处理UI中要用到的数据，并且要将数据嵌入到页面中，最终生成一个完整的HTML页面响应。</p>
<p>为了降低处理这个过程的复杂度，出现了MVC模式。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/23/67919a03d13bb.png"></p>
<p><strong>Controller</strong>: 处理请求，组装这次请求需要的数据<br><strong>Model</strong>：需要用于UI渲染的数据模型<br><strong>View</strong>：视图，用于将模型组装到界面中</p>
<p><strong>前端MVC模式的困难</strong></p>
<p>React解决了   数据 -&gt; 视图   的问题</p>
<ol>
<li>前端的controller要比服务器复杂很多，因为前端中的controller处理的是用户的操作，而用户的操作场景是复杂的。</li>
<li>对于那些组件化的框架（比如vue、react），它们使用的是单向数据流。若需要共享数据，则必须将数据提升到顶层组件，然后数据再一层一层传递，极其繁琐。 虽然可以使用上下文来提供共享数据，但对数据的操作难以监控，容易导致调试错误的困难，以及数据还原的困难（比如数据出了问题，难以定位）。并且，若开发一个大中型项目，共享的数据很多，会导致上下文中的数据变得非常复杂。</li>
</ol>
<p>比如，上下文中有如下格式的数据：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">value = &#123;</span><br><span class="line">    <span class="attr">users</span>:[&#123;&#125;,&#123;&#125;,&#123;&#125;],</span><br><span class="line">    <span class="attr">addUser</span>: <span class="keyword">function</span>(<span class="params">u</span>)&#123;&#125;,</span><br><span class="line">    <span class="attr">deleteUser</span>: <span class="keyword">function</span>(<span class="params">u</span>)&#123;&#125;,</span><br><span class="line">    <span class="attr">updateUser</span>: <span class="keyword">function</span>(<span class="params">u</span>)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-前端需要一个独立的数据解决方案"><a href="#2-前端需要一个独立的数据解决方案" class="headerlink" title="2.前端需要一个独立的数据解决方案"></a>2.前端需要一个独立的数据解决方案</h3><p><strong>Flux</strong></p>
<p>Facebook提出的数据解决方案，它的最大历史意义，在于它引入了action的概念</p>
<p>action是一个普通的对象，用于描述要干什么。<strong>action是触发数据变化的唯一原因</strong></p>
<p>store表示数据仓库，用于存储共享数据。还可以根据不同的action更改仓库中的数据</p>
<p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> loginAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;login&quot;</span>,</span><br><span class="line">    <span class="attr">payload</span>: &#123;</span><br><span class="line">        <span class="attr">loginId</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="attr">loginPwd</span>:<span class="string">&quot;123123&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> deleteAction = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">    <span class="attr">payload</span>: <span class="number">1</span>  <span class="comment">// 用户id为1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Redux</strong></p>
<p>在Flux基础上，引入了reducer的概念</p>
<p>reducer：处理器，用于根据action来处理数据，处理后的数据会被仓库重新保存。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/23/67919a1aef5a6.png"></p>
<h2 id="二、使用Redux管理数据"><a href="#二、使用Redux管理数据" class="headerlink" title="二、使用Redux管理数据"></a>二、使用Redux管理数据</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//假设仓库中仅存放了一个数字，该数字的变化可能是+1或-1</span></span><br><span class="line"><span class="comment">//约定action的格式：&#123;type:&quot;操作类型&quot;, payload:附加数据&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reducer本质上就是一个普通函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> state 之前仓库中的状态（数据）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> action 描述要作什么的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="comment">//返回一个新的状态</span></span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;increase&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="string">&quot;decrease&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;<span class="comment">//如果是一个无效的操作类型，数据不变</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">store</span> = <span class="title function_">createStore</span>(reducer, <span class="number">10</span>); <span class="comment">// 创建数据仓库(reducer,数据默认值) 返回一个仓库对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> action = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;increase&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">store</span>.<span class="title function_">getState</span>()); <span class="comment">//得到仓库中当前的数据</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">store</span>.<span class="title function_">dispatch</span>(action); <span class="comment">//向仓库分发action</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">store</span>.<span class="title function_">getState</span>()); <span class="comment">//得到仓库中当前的数据</span></span><br></pre></td></tr></table></figure>

<h2 id="三、Action"><a href="#三、Action" class="headerlink" title="三、Action"></a>三、Action</h2><ol>
<li><p>action是一个plain-object（平面对象，也就是一个普通对象）</p>
<ol>
<li>它的__proto__指向Object.prototype</li>
</ol>
</li>
<li><p>通常，使用payload属性表示附加数据（没有强制要求）</p>
</li>
<li><p>action中必须有type属性，该属性用于描述操作的类型</p>
<ol>
<li>但是，没有对type的类型做出要求</li>
</ol>
</li>
<li><p>在大型项目，由于操作类型非常多，为了避免硬编码（hard code），会将action的类型存放到一个或一些单独的文件中(样板代码)。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// actionTypes.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">INCREASE</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;increase&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">DECREASE</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;decrease&quot;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">SET</span> = <span class="title class_">Symbol</span>(<span class="string">&quot;set&quot;</span>); <span class="comment">// 用symbol避免名字冲突</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>为了方面传递action，通常会使用action创建函数(action creator)来创建action</p>
<ol>
<li>action创建函数应为无副作用的纯函数(就是简单的输入输出)<ol>
<li>不能以任何形式改动参数</li>
<li>不可以有异步</li>
<li>不可以对外部环境中的数据造成影响</li>
</ol>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// number-action.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">&quot;./action-type&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到一个用于增加数字操作的action</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getIncreaseAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: actionTypes.<span class="property">INCREASE</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getDecreaseAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: actionTypes.<span class="property">DECREASE</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getSetAction</span>(<span class="params">newNumber</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: actionTypes.<span class="property">SET</span>,</span><br><span class="line">        <span class="attr">payload</span>: newNumber</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了方便利用action创建函数来分发（触发）action，redux提供了一个函数<code>bindActionCreators</code>，该函数用于增强action创建函数的功能，使它不仅可以创建action，并且创建后会自动完成分发。</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, bindActionCreators &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> actionTypes <span class="keyword">from</span> <span class="string">&quot;./action/action-type&quot;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> numberActions <span class="keyword">from</span> <span class="string">&quot;./action/number-action&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//假设仓库中仅存放了一个数字，该数字的变化可能是+1或-1</span></span><br><span class="line"><span class="comment">//约定action的格式：&#123;type:&quot;操作类型&quot;, payload:附加数据&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reducer本质上就是一个普通函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> state 之前仓库中的状态（数据）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> action 描述要作什么的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">    <span class="comment">//返回一个新的状态</span></span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">INCREASE</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">DECREASE</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">SET</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> action.<span class="property">payload</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;<span class="comment">//如果是一个无效的操作类型，数据不变</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一个参数，是action创建函数合并的对象，第二个参数是仓库的dispatch函数</span></span><br><span class="line"><span class="comment">//得到一个新的对象，新对象中的属性名与第一个参数的属性名一致</span></span><br><span class="line"><span class="keyword">const</span> boundActions = <span class="title function_">bindActionCreators</span>(numberActions, store.<span class="property">dispatch</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>()); <span class="comment">//得到仓库中当前的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//得到一个increase action，并直接分发</span></span><br><span class="line">boundActions.<span class="title function_">getIncreaseAction</span>(); <span class="comment">//向仓库分发action</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>()); <span class="comment">//得到仓库中当前的数据</span></span><br><span class="line"></span><br><span class="line">boundActions.<span class="title function_">getSetAction</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(store.<span class="title function_">getState</span>()); <span class="comment">//得到仓库中当前的数据</span></span><br></pre></td></tr></table></figure>

<h2 id="四、Reducer"><a href="#四、Reducer" class="headerlink" title="四、Reducer"></a>四、Reducer</h2><p>Reducer是用于改变数据的函数</p>
<ol>
<li><p>一个数据仓库，有且仅有一个reducer，并且通常情况下，一个工程只有一个仓库，因此，一个系统，只有一个reducer</p>
</li>
<li><p>为了方便管理，通常会将reducer放到单独的文件中。</p>
</li>
<li><p>reducer被调用的时机</p>
<ol>
<li><p>通过store.dispatch，分发了一个action，此时，会调用reducer</p>
</li>
<li><p>当创建一个store的时候，会调用一次reducer</p>
<ol>
<li>可以利用这一点，用reducer初始化状态</li>
<li>创建仓库时，不传递任何默认状态</li>
<li>将reducer的参数state设置一个默认值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * reducer本质上就是一个普通函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> state 之前仓库中的状态（数据）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> action 描述要作什么的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state = <span class="number">10</span>, action</span>) &#123; <span class="comment">// 当创建仓库，不传递任何默认状态时，也就是默认状态为undefined，会给state设为默认值10</span></span><br><span class="line">    <span class="comment">//返回一个新的状态</span></span><br><span class="line">    <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">INCREASE</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">DECREASE</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (action.<span class="property">type</span> === actionTypes.<span class="property">SET</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> action.<span class="property">payload</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>reducer内部通常使用switch来判断type值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state = <span class="number">10</span>, action</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.<span class="property">type</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> actionTypes.<span class="property">INCREASE</span>:</span><br><span class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> actionTypes.<span class="property">DECREASE</span>:</span><br><span class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">case</span> actionTypes.<span class="property">SET</span>:</span><br><span class="line">            <span class="keyword">return</span> action.<span class="property">payload</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>reducer必须是一个没有副作用的纯函数</strong></p>
<ol>
<li>为什么需要纯函数<ol>
<li>纯函数有利于测试和调式</li>
<li>有利于还原数据</li>
<li>有利于将来和react结合时的优化</li>
</ol>
</li>
<li>具体要求<ol>
<li>不能改变参数，因此若要让状态变化，必须得到一个新的状态</li>
<li>不能有异步</li>
<li>不能对外部环境造成影响</li>
</ol>
</li>
</ol>
</li>
<li><p>由于在大中型项目中，操作比较复杂，数据结构也比较复杂，因此，需要对reducer进行细分。</p>
<ol>
<li>redux提供了方法，可以帮助我们更加方便的合并reducer</li>
<li>combineReducers: 合并reducer，得到一个新的reducer，该新的reducer管理一个对象，该对象中的每一个属性交给对应的reducer管理。</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loginUserReducer <span class="keyword">from</span> <span class="string">&quot;./loginUser&quot;</span></span><br><span class="line"><span class="keyword">import</span> usersReducer <span class="keyword">from</span> <span class="string">&#x27;./users&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span></span><br><span class="line"><span class="comment">//  手写合并reducer</span></span><br><span class="line"><span class="comment">// export default (state = &#123;&#125;, action) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     const newState = &#123;</span></span><br><span class="line"><span class="comment">//         loginUser: loginUserReducer(state.loginUser, action),</span></span><br><span class="line"><span class="comment">//         users: usersReducer(state.users, action)</span></span><br><span class="line"><span class="comment">//     &#125;;</span></span><br><span class="line"><span class="comment">//     return newState;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">combineReducers</span>(&#123; <span class="comment">// 等同于上述代码，同上返回一个函数</span></span><br><span class="line">    <span class="attr">loginUser</span>: loginUserReducer,</span><br><span class="line">    <span class="attr">users</span>: usersReducer</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="五、Store"><a href="#五、Store" class="headerlink" title="五、Store"></a>五、Store</h2><p>Store：用于保存数据</p>
<p>通过createStore方法创建的对象。</p>
<p>该对象的成员：</p>
<ul>
<li>dispatch：分发一个action</li>
<li>getState：得到仓库中当前的状态</li>
<li>replaceReducer：替换掉当前的reducer（基本不会用）</li>
<li>subscribe：注册一个监听器，监听器是一个无参函数，该分发一个action之后，会运行注册的监听器。该函数会返回一个函数，用于取消监听，监听器可以注册多个。很重要，后面会讲，因为需要监听用到的仓库数据，数据变化，视图需要更新。</li>
</ul>
<h2 id="六、手写createStores"><a href="#六、手写createStores" class="headerlink" title="六、手写createStores"></a>六、手写createStores</h2><p>返回一个对象：</p>
<ul>
<li>dispatch：分发一个action</li>
<li>getState：得到仓库中当前的状态</li>
<li>subscribe：注册一个监听器，监听器是一个无参函数，该分发一个action之后，会运行注册的监听器。该函数会返回一个函数，用于取消监听</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断某个对象是否是一个plain-object</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; obj </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(obj) === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到一个指定长度的随机字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; length </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getRandomString</span>(<span class="params">length</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substr</span>(<span class="number">2</span>, length).<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">join</span>(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现createStore的功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; reducer reducer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; defaultState 默认的状态值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">reducer, defaultState</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentReducer = reducer, <span class="comment">//当前使用的reducer</span></span><br><span class="line">        currentState = defaultState; <span class="comment">//当前仓库中的状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> listeners = [];  <span class="comment">//记录所有的监听器（订阅者）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="comment">//验证action</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(action)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;action must be a plain object&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//验证action的type属性是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;action must has a property of type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        currentState = <span class="title function_">currentReducer</span>(currentState, action)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//运行所有的订阅者（监听器）</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> listener <span class="keyword">of</span> listeners) &#123;</span><br><span class="line">            <span class="title function_">listener</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> currentState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加一个监听器（订阅器）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        listeners.<span class="title function_">push</span>(listener); <span class="comment">//将监听器加入到数组中</span></span><br><span class="line">        <span class="keyword">let</span> isRemove = <span class="literal">false</span>;<span class="comment">//是否已经移除掉了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isRemove) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将listener从数组中移除</span></span><br><span class="line">            <span class="keyword">const</span> index = listeners.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">            listeners.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">            isRemove = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建仓库时，需要分发一次初始的action,也就是之前提到过的，创建仓库时，先调用一次reducer</span></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">`@@redux/INIT<span class="subst">$&#123;getRandomString(<span class="number">7</span>)&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dispatch,</span><br><span class="line">        getState,</span><br><span class="line">        subscribe</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七、手写bindActionCreators"><a href="#七、手写bindActionCreators" class="headerlink" title="七、手写bindActionCreators"></a>七、手写bindActionCreators</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">actionCreators, dispatch</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">&quot;function&quot;</span>) &#123; <span class="comment">// 传函数返回函数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getAutoDispatchActionCreator</span>(actionCreators, dispatch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreators === <span class="string">&quot;object&quot;</span>) &#123; <span class="comment">// 传对象返回对象</span></span><br><span class="line">        <span class="keyword">const</span> result = &#123;&#125;; <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> actionCreators) &#123;</span><br><span class="line">            <span class="keyword">if</span> (actionCreators.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">const</span> actionCreator = actionCreators[key]; <span class="comment">//取出对应的属性值</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">                    result[key] = <span class="title function_">getAutoDispatchActionCreator</span>(actionCreator, dispatch);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;actionCreators must be an object or function which means action creator&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到一个自动分发的action创建函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getAutoDispatchActionCreator</span>(<span class="params">actionCreator, dispatch</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> action = <span class="title function_">actionCreator</span>(...args)</span><br><span class="line">        <span class="title function_">dispatch</span>(action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、手写combineReducers"><a href="#八、手写combineReducers" class="headerlink" title="八、手写combineReducers"></a>八、手写combineReducers</h2><p>组装reducers，返回一个reducer，数据使用一个对象表示，对象的属性名与传递的参数对象保持一致</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> isPlainObject <span class="keyword">from</span> <span class="string">&quot;./utils/isPlainObject&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ActionTypes</span> <span class="keyword">from</span> <span class="string">&quot;./utils/ActionTypes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">validateReducers</span>(<span class="params">reducers</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;reducers must be an object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(reducers)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;reducers must be a plain object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// combineReducers会自行触发传过去的reducer，验证reducer的返回结果是不是undefined</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> reducers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (reducers.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">            <span class="keyword">const</span> reducer = reducers[key];<span class="comment">//拿到reducer</span></span><br><span class="line">            <span class="comment">//传递一个特殊的type值</span></span><br><span class="line">            <span class="keyword">let</span> state = <span class="title function_">reducer</span>(<span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="title class_">ActionTypes</span>.<span class="title function_">INIT</span>() <span class="comment">// 防止reducer里面有硬编码，例如：如果type以 initxxx 开头就返回undefined</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">if</span> (state === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;reducers must not return undefined&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            state = <span class="title function_">reducer</span>(<span class="literal">undefined</span>, &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="title class_">ActionTypes</span>.<span class="title function_">UNKNOWN</span>()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">if</span> (state === <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;reducers must not return undefined&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">reducers</span>) &#123;</span><br><span class="line">    <span class="comment">//1. 验证</span></span><br><span class="line">    <span class="title function_">validateReducers</span>(reducers);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回的是一个reducer函数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">state = &#123;&#125;, action</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> newState = &#123;&#125;; <span class="comment">//要返回的新的状态</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> reducers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (reducers.<span class="title function_">hasOwnProperty</span>(key)) &#123;</span><br><span class="line">                <span class="keyword">const</span> reducer = reducers[key];</span><br><span class="line">                newState[key] = <span class="title function_">reducer</span>(state[key], action);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newState; <span class="comment">//返回状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="九、Redux中间件（Middleware）"><a href="#九、Redux中间件（Middleware）" class="headerlink" title="九、Redux中间件（Middleware）"></a>九、Redux中间件（Middleware）</h2><p>中间件：类似于插件，可以在不影响原本功能、并且不改动原本代码的基础上，对其功能进行增强。在Redux中，中间件主要用于增强dispatch函数。</p>
<p>实现Redux中间件的基本原理，是更改仓库中的dispatch函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, bindActionCreators &#125; <span class="keyword">from</span> <span class="string">&quot;../redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAddUserAction, createDeleteUserAction &#125; <span class="keyword">from</span> <span class="string">&quot;./action/usersAction&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer);</span><br><span class="line"><span class="keyword">const</span> oldDispatch = store.<span class="property">dispatch</span>; <span class="comment">//保留原本的dispatch函数</span></span><br><span class="line">store.<span class="property">dispatch</span> = <span class="keyword">function</span> (<span class="params">action</span>) &#123; <span class="comment">//更改store中的dispatch</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;中间件1&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;旧数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;action&quot;</span>, action);</span><br><span class="line">    <span class="title function_">oldDispatch</span>(action); <span class="comment">// 调用原本的dispatch函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有多个中间件，需要链式调用，每一次都把前面的重新保存。（一层包一层，洋葱模型）</span></span><br><span class="line"><span class="keyword">const</span> oldDispatch = store.<span class="property">dispatch</span>; <span class="comment">//保留原本的dispatch函数</span></span><br><span class="line">store.<span class="property">dispatch</span> = <span class="keyword">function</span> (<span class="params">action</span>) &#123; <span class="comment">//更改store中的dispatch</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;中间件2&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;旧数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;action&quot;</span>, action);</span><br><span class="line">    <span class="title function_">oldDispatch</span>(action);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionCreators = &#123;</span><br><span class="line">    <span class="attr">addUser</span>: createAddUserAction,</span><br><span class="line">    <span class="attr">deleteUser</span>: createDeleteUserAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">bindActionCreators</span>(actionCreators, store.<span class="property">dispatch</span>)</span><br><span class="line"></span><br><span class="line">actions.<span class="title function_">addUser</span>(&#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;abc&quot;</span>, <span class="attr">age</span>: <span class="number">111</span> &#125;)</span><br><span class="line">actions.<span class="title function_">deleteUser</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>Redux中间件书写：</p>
<ul>
<li><p>中间件本身是一个函数，该函数接收一个store参数，表示创建的仓库，该仓库并非一个完整的仓库对象，仅包含getState，dispatch。该函数运行的时间，是在仓库创建之后运行。</p>
<ul>
<li>由于创建仓库后需要自动运行设置的中间件函数，因此，需要在创建仓库时，告诉仓库有哪些中间件</li>
<li>需要调用applyMiddleware函数，将函数的返回结果作为createStore的第二或第三个参数。(有数据默认值则为第三个参数)</li>
</ul>
</li>
<li><p>中间件函数必须返回一个dispatch创建函数</p>
</li>
<li><p>applyMiddleware函数，用于记录有哪些中间件，它会返回一个函数</p>
<ul>
<li>该函数用于记录创建仓库的方法，然后又返回一个函数，用于创建仓库</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, bindActionCreators, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAddUserAction, createDeleteUserAction &#125; <span class="keyword">from</span> <span class="string">&quot;./action/usersAction&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 优雅的写法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logger1</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;中间件1&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;旧数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;action&quot;</span>, action);</span><br><span class="line">    <span class="title function_">next</span>(action);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logger2</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;中间件2&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;旧数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;action&quot;</span>, action);</span><br><span class="line">    <span class="title function_">next</span>(action);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新数据&quot;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// /**</span></span><br><span class="line"><span class="comment">//  * 一个中间件函数</span></span><br><span class="line"><span class="comment">//  * @param &#123;*&#125; store </span></span><br><span class="line"><span class="comment">//  */</span></span><br><span class="line"><span class="comment">// function logger1(store) &#123;</span></span><br><span class="line"><span class="comment">//     return function (next) &#123; //store中的dispatch是最终的dispatch，如果在第一个中间件中调用dispatch会无限递归 next是被上一个中间件包装过的								  dispatch,也就是下一个中间件的dispatch</span></span><br><span class="line"><span class="comment">//         //下面返回的函数，是最终要应用的dispatch</span></span><br><span class="line"><span class="comment">//         return function (action) &#123;</span></span><br><span class="line"><span class="comment">//             console.log(&quot;中间件1&quot;)</span></span><br><span class="line"><span class="comment">//             console.log(&quot;旧数据&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//             console.log(&quot;action&quot;, action);</span></span><br><span class="line"><span class="comment">//             next(action);</span></span><br><span class="line"><span class="comment">//             console.log(&quot;新数据&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//             console.log(&quot;&quot;)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function logger2(store) &#123;</span></span><br><span class="line"><span class="comment">//     return function (next) &#123;</span></span><br><span class="line"><span class="comment">//         //下面返回的函数，是最终要应用的dispatch</span></span><br><span class="line"><span class="comment">//         return function (action) &#123;</span></span><br><span class="line"><span class="comment">//             console.log(&quot;中间件2&quot;)</span></span><br><span class="line"><span class="comment">//             console.log(&quot;旧数据&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//             console.log(&quot;action&quot;, action);</span></span><br><span class="line"><span class="comment">//             next(action);</span></span><br><span class="line"><span class="comment">//             console.log(&quot;新数据&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//             console.log(&quot;&quot;)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//应用中间件，方式1：</span></span><br><span class="line"><span class="comment">// const store = createStore(reducer, applyMiddleware(logger1, logger2));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方式2：</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">applyMiddleware</span>(logger1, logger2)(createStore)(reducer) <span class="comment">// 方式一等同于方式二</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionCreators = &#123;</span><br><span class="line">    <span class="attr">addUser</span>: createAddUserAction,</span><br><span class="line">    <span class="attr">deleteUser</span>: createDeleteUserAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">bindActionCreators</span>(actionCreators, store.<span class="property">dispatch</span>)</span><br><span class="line"></span><br><span class="line">actions.<span class="title function_">addUser</span>(&#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;abc&quot;</span>, <span class="attr">age</span>: <span class="number">111</span> &#125;)</span><br><span class="line">actions.<span class="title function_">deleteUser</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/23/6791ea77cda80.png"></p>
<h2 id="十、手写applyMiddleware"><a href="#十、手写applyMiddleware" class="headerlink" title="十、手写applyMiddleware"></a>十、手写applyMiddleware</h2><p>middleware的本质，是一个调用后可以得到dispatch创建函数的函数</p>
<p>compose：函数组合，将一个数组中的函数进行组合，形成一个新的函数，该函数调用时，实际上是反向调用之前组合的函数</p>
<blockquote>
<p>没咋懂</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...funcs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">args</span> =&gt;</span> args; <span class="comment">//如果没有要组合的函数，则返回的函数原封不动的返回参数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//要组合的函数只有一个</span></span><br><span class="line">        <span class="keyword">return</span> funcs[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> funcs.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="title function_">a</span>(<span class="title function_">b</span>(...args)))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return function (...args) &#123;</span></span><br><span class="line">    <span class="comment">//     let lastReturn = null; //记录上一个函数返回的值，它将作为下一个函数的参数</span></span><br><span class="line">    <span class="comment">//     for (let i = funcs.length - 1; i &gt;= 0; i--) &#123;</span></span><br><span class="line">    <span class="comment">//         const func = funcs[i];</span></span><br><span class="line">    <span class="comment">//         if (i === funcs.length - 1) &#123;//数组最后一项</span></span><br><span class="line">    <span class="comment">//             lastReturn = func(...args)</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//         else &#123;</span></span><br><span class="line">    <span class="comment">//             lastReturn = func(lastReturn)</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     return lastReturn;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">&quot;./compose&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注册中间件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  &#123;<span class="type">...any</span>&#125; middlewares 所有的中间件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">...middlewares</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">createStore</span>) &#123; <span class="comment">//给我创建仓库的函数</span></span><br><span class="line">        <span class="comment">//下面的函数用于创建仓库</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">reducer, defaultState</span>) &#123;</span><br><span class="line">            <span class="comment">//创建仓库</span></span><br><span class="line">            <span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer, defaultState);</span><br><span class="line">            <span class="comment">//初始化一个临时的dispatch。在中间件还未对dispatch进行处理之前，调用了这个dispatch，会抛出一个错误，从而避免使用未经处理的原始dispatch</span></span><br><span class="line">            <span class="keyword">let</span> <span class="title function_">dispatch</span> = (<span class="params"></span>) =&gt; &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;目前还不能使用dispatch&quot;</span>) &#125;;</span><br><span class="line">            <span class="keyword">const</span> simpleStore = &#123;</span><br><span class="line">                <span class="attr">getState</span>: store.<span class="property">getState</span>,</span><br><span class="line">                <span class="comment">// 不能直接传入store.dispatch，因为这是最原始的dispatch,它的地址并没有发生变化,并不是混合之后更新的dispatch</span></span><br><span class="line">                <span class="comment">// 在 Redux 中，中间件的主要作用是在 action 被 dispatch 到 reducer 之前对其进行拦截和处理。为了实现这个功能，我们需要对原始的 dispatch 方法进行增强，让它依次经过所有中间件的处理。而 simpleStore.dispatch 是一个指向外部 dispatch 变量的函数，当外部的 dispatch 变量被更新为经过中间件处理后的 dispatch 函数时，simpleStore.dispatch 自然也就跟着更新了。简而言之，下面这句代码，是为了让每个中间件中如果调用dispatch调用的是最终经过处理的dispatch，就像在thunk中传入的异步函数中调用dispatch就调用的是混合的dispatch，而不是原来的，这点很难理解，不懂的话可以问问豆包。</span></span><br><span class="line">                <span class="attr">dispatch</span>: <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="title function_">dispatch</span>(...args) </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//给dispatch赋值</span></span><br><span class="line">            <span class="comment">//根据中间件数组，得到一个dispatch创建函数的数组</span></span><br><span class="line">            <span class="keyword">const</span> dispatchProducers = middlewares.<span class="title function_">map</span>(<span class="function"><span class="params">mid</span> =&gt;</span> <span class="title function_">mid</span>(simpleStore));</span><br><span class="line">            dispatch = <span class="title function_">compose</span>(...dispatchProducers)(store.<span class="property">dispatch</span>); <span class="comment">// 用多个中间件处理dispatch，传入最初的dispatch进行包装</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                ...store,</span><br><span class="line">                dispatch</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改手写createStore（应用中间件版）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ActionTypes</span> <span class="keyword">from</span> <span class="string">&quot;./utils/ActionTypes&quot;</span></span><br><span class="line"><span class="keyword">import</span> isPlainObject <span class="keyword">from</span> <span class="string">&quot;./utils/isPlainObject&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现createStore的功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; reducer reducer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; defaultState 默认的状态值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; enhanced applyMiddleware(...中间件)返回的函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">createStore</span>(<span class="params">reducer, defaultState, </span>) &#123;</span><br><span class="line">    <span class="comment">//enhanced表示applymiddleware返回的函数</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> defaultState === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">//第二个参数是应用中间件的函数返回值</span></span><br><span class="line">        enhanced = defaultState;</span><br><span class="line">        defaultState = <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhanced === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">//进入applyMiddleWare的处理逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">enhanced</span>(createStore)(reducer, defaultState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentReducer = reducer, <span class="comment">//当前使用的reducer</span></span><br><span class="line">        currentState = defaultState; <span class="comment">//当前仓库中的状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> listeners = [];  <span class="comment">//记录所有的监听器（订阅者）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="comment">//验证action</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">isPlainObject</span>(action)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;action must be a plain object&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//验证action的type属性是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (action.<span class="property">type</span> === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;action must has a property of type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        currentState = <span class="title function_">currentReducer</span>(currentState, action)</span><br><span class="line">        <span class="comment">//运行所有的订阅者（监听器）</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> listener <span class="keyword">of</span> listeners) &#123;</span><br><span class="line">            <span class="title function_">listener</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> currentState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加一个监听器（订阅器）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        listeners.<span class="title function_">push</span>(listener); <span class="comment">//将监听器加入到数组中</span></span><br><span class="line">        <span class="keyword">let</span> isRemove = <span class="literal">false</span>;<span class="comment">//是否已经移除掉了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isRemove) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将listener从数组中移除</span></span><br><span class="line">            <span class="keyword">const</span> index = listeners.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">            listeners.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">            isRemove = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建仓库时，需要分发一次初始的action</span></span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">ActionTypes</span>.<span class="title function_">INIT</span>()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        dispatch,</span><br><span class="line">        getState,</span><br><span class="line">        subscribe</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Redux中间件"><a href="#Redux中间件" class="headerlink" title="Redux中间件"></a>Redux中间件</h1><h2 id="一、redux-logger"><a href="#一、redux-logger" class="headerlink" title="一、redux-logger"></a>一、redux-logger</h2><p>第三方中间件：日志记录<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/redux-logger">redux-logger - npm</a></p>
<blockquote>
<p>注意：logger中间件要放到最后一个，与action有关</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, bindActionCreators, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;../redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAddUserAction, createDeleteUserAction &#125; <span class="keyword">from</span> <span class="string">&quot;./action/usersAction&quot;</span></span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">&quot;redux-logger&quot;</span> <span class="comment">// 引入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer, <span class="title function_">applyMiddleware</span>(logger)); <span class="comment">// 应用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionCreators = &#123;</span><br><span class="line">    <span class="attr">addUser</span>: createAddUserAction,</span><br><span class="line">    <span class="attr">deleteUser</span>: createDeleteUserAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">bindActionCreators</span>(actionCreators, store.<span class="property">dispatch</span>)</span><br><span class="line"></span><br><span class="line">actions.<span class="title function_">addUser</span>(&#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;abc&quot;</span>, <span class="attr">age</span>: <span class="number">111</span> &#125;)</span><br><span class="line">actions.<span class="title function_">deleteUser</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h2 id="二、redux-thunk"><a href="#二、redux-thunk" class="headerlink" title="二、redux-thunk"></a>二、redux-thunk</h2><p>利用中间件进行副作用处理</p>
<ul>
<li>redux-thunk（该中间件一般都放到第一个）</li>
</ul>
<p>thunk允许action（本来都是对象）是一个带有副作用的函数，当action是一个函数被分发时，thunk会阻止action继续向后移交(即next)，会直接调用函数。</p>
<p>thunk会向函数中传递三个参数：</p>
<ul>
<li>dispatch：来自于store.dispatch，不是next，也就是不是被下一个中间件包装后的dispatch</li>
<li>getState：来自于store.getState</li>
<li>extra：来自于用户设置的额外参数（平时用不到）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getAllStudents &#125; <span class="keyword">from</span> <span class="string">&quot;../../services/student&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">fetchUsers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//由于thunk的存在，允许action是一个带有副作用的函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">dispatch</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(&#x27;触发&#x27;) </span></span><br><span class="line">        <span class="comment">// 如果只有这一行代码，thunk会阻止action继续向后移交，日志并不会打印，而且此时action是函数，这就是logger中间件要放到最后一个的原因，如果是第一		   个，会先调用第一个中间件中的dispatch，从而因为action不是对象而报错。注意这里要分清移交是从前往后调用，之前说的是从后往前传递是中间件注册的时候</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 在这里又触发了dispatch，此时action不是一个函数，会继续往后移交，所以日志可以打印</span></span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="title function_">createSetLoadingAction</span>(<span class="literal">true</span>)); <span class="comment">//正在加载 </span></span><br><span class="line">        <span class="keyword">const</span> users = <span class="keyword">await</span> <span class="title function_">getAllStudents</span>(); <span class="comment">// 异步</span></span><br><span class="line">        <span class="keyword">const</span> action = <span class="title function_">createSetUsersAction</span>(users)</span><br><span class="line">        <span class="title function_">dispatch</span>(action)</span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="title function_">createSetLoadingAction</span>(<span class="literal">false</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchUsers &#125; <span class="keyword">from</span> <span class="string">&quot;./action/usersAction&quot;</span></span><br><span class="line"></span><br><span class="line">store.<span class="title function_">dispatch</span>(<span class="title function_">fetchUsers</span>()); <span class="comment">// fetchUsers()返回带有副作用的一个函数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span></span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">&quot;redux-logger&quot;</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">createStore</span>(reducer,</span><br><span class="line">    <span class="title function_">applyMiddleware</span>(</span><br><span class="line">        thunk,</span><br><span class="line">        logger</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/01/23/679211fd938b1.png"></p>
<h2 id="三、手写thunk"><a href="#三、手写thunk" class="headerlink" title="三、手写thunk"></a>三、手写thunk</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createThunkMiddleware</span>(<span class="params">extra</span>) &#123;</span><br><span class="line">    <span class="comment">//该函数返回一个thunk中间件</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">store</span> =&gt;</span> <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">action</span>(store.<span class="property">dispatch</span>, store.<span class="property">getState</span>, extra);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">next</span>(action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> thunk = <span class="title function_">createThunkMiddleware</span>();</span><br><span class="line">thunk.<span class="property">withExtraArgument</span> = createThunkMiddleware;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> thunk;</span><br></pre></td></tr></table></figure>

<p><strong>下一节的demo是具体的使用，可以看一下，学习把数据分离</strong></p>
<h2 id="四、redux-promise"><a href="#四、redux-promise" class="headerlink" title="四、redux-promise"></a>四、redux-promise</h2><p><em>用到的比较少</em></p>
<p>如果action是一个promise，则会等待promise完成，将完成的结果作为action触发，如果action不是一个promise，则判断其payload是否是一个promise，如果是，等待promise完成，然后将得到的结果作为payload的值触发。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 由于使用了redux-promise中间件，因此，允许action是一个promise，在promise中，如果要触发action，则使用resolve</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">fetchStudents</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> action = <span class="title function_">setStudentsAndTotal</span>([&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;aaa&quot;</span> &#125;, &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;bbb&quot;</span> &#125;], <span class="number">2</span>);</span><br><span class="line">            <span class="title function_">resolve</span>(action)</span><br><span class="line">        &#125;, <span class="number">3000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 此时payload是一个promise</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchStudents</span>(<span class="params">condition</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">type</span>: actionTypes.<span class="property">setStudentsAndTotal</span>,</span><br><span class="line">        <span class="attr">payload</span>: <span class="title function_">searchStudents</span>(condition).<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> (&#123;</span><br><span class="line">            <span class="attr">datas</span>: resp.<span class="property">datas</span>,</span><br><span class="line">            <span class="attr">total</span>: resp.<span class="property">cont</span></span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>redux-promise的源码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; isPlainObject, isString &#125; <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span></span><br><span class="line"><span class="keyword">import</span> isPromise <span class="keyword">from</span> <span class="string">&quot;is-promise&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (&#123; dispatch &#125;) =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_">isFSA</span>(action)) &#123;</span><br><span class="line">        <span class="comment">//如果不是一个标准的action</span></span><br><span class="line">        <span class="comment">//如果action是一个promise，则将其resolve的值dispatch，否则，不做任何处理，交给下一个中间件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">isPromise</span>(action) ? action.<span class="title function_">then</span>(dispatch) : <span class="title function_">next</span>(action);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isPromise</span>(action.<span class="property">payload</span>) ?</span><br><span class="line">        action.<span class="property">payload</span></span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">payload</span> =&gt;</span> <span class="title function_">dispatch</span>(&#123; ...action, payload &#125;))</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="title function_">dispatch</span>(&#123; ...action, <span class="attr">payload</span>: error, <span class="attr">error</span>: <span class="literal">true</span> &#125;)) :</span><br><span class="line">        <span class="title function_">next</span>(action)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断一个action是不是标准的flux的action</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; action </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isFSA</span>(<span class="params">action</span>) &#123;</span><br><span class="line">    <span class="comment">//action必须是一个平面对象 plain-object</span></span><br><span class="line">    <span class="comment">//action.type必须是一个字符串</span></span><br><span class="line">    <span class="comment">//action的属性不能包含其他非标准属性  标准属性[&quot;type&quot;, &quot;payload&quot;, &quot;error&quot;, &quot;meta&quot;]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isPlainObject</span>(action)</span><br><span class="line">        &amp;&amp;</span><br><span class="line">        <span class="title function_">isString</span>(action.<span class="property">type</span>)</span><br><span class="line">        &amp;&amp;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">keys</span>(action).<span class="title function_">every</span>(<span class="function"><span class="params">key</span> =&gt;</span> [<span class="string">&quot;type&quot;</span>, <span class="string">&quot;payload&quot;</span>, <span class="string">&quot;error&quot;</span>, <span class="string">&quot;meta&quot;</span>].<span class="title function_">includes</span>(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、迭代器和可迭代协议"><a href="#五、迭代器和可迭代协议" class="headerlink" title="五、迭代器和可迭代协议"></a>五、迭代器和可迭代协议</h2><blockquote>
<p>解决副作用的 redux 中间件<br>redux-thunk：需要改动action，可接收action是一个函数<br>redux-promise：需要改动action，可接收action是一个promise对象，或action的payload是一个promise对象<br>以上两个中间件，会导致action或action创建函数不再纯净。<br>redux-saga将解决这样的问题，它不仅可以保持action、action创建函数、reducer的纯净，而且可以用模块化的方式解决副作用，并且功能非常强大。<br>redux-saga是建立在ES6的生成器基础上的，要熟练的使用saga，必须理解生成器。<br>要理解生成器，必须先理解迭代器和可迭代协议。</p>
</blockquote>
<h3 id="1-迭代"><a href="#1-迭代" class="headerlink" title="1.迭代"></a>1.迭代</h3><p>类似于遍历</p>
<p>遍历：有多个数据组成的集合数据结构（map、set、array等其他类数组），需要从该结构中依次取出数据进行某种处理。</p>
<p>迭代：按照某种逻辑，依次取出下一个数据进行处理。</p>
<blockquote>
<p>类数组都能进行迭代，但是能迭代的不一定能进行遍历。</p>
</blockquote>
<h3 id="2-迭代器-iterator"><a href="#2-迭代器-iterator" class="headerlink" title="2.迭代器 iterator"></a>2.迭代器 iterator</h3><p>JS语言规定，如果一个对象具有next方法，并且next方法满足一定的约束，则该对象是一个迭代器（iterator）。</p>
<p>next方法的约束：该方法必须返回一个对象，该对象至少具有两个属性：</p>
<ul>
<li>value：any类型，下一个数据的值，如果done属性为true，通常，会将value设置为undefined</li>
<li>done：bool类型，是否已经迭代完成</li>
</ul>
<p>通过迭代器的next方法，可以依次取出数据，并可以根据返回的done属性，判定是否迭代结束。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//iterator是一个迭代器</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    <span class="attr">total</span>: <span class="number">3</span>, <span class="comment">//可迭代3次</span></span><br><span class="line">    <span class="attr">i</span>: <span class="number">1</span>, <span class="comment">//当前的迭代次数</span></span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = &#123; <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">            <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">i</span> &gt; <span class="variable language_">this</span>.<span class="property">total</span> ? <span class="literal">undefined</span> : <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">            <span class="attr">done</span>: <span class="variable language_">this</span>.<span class="property">i</span> &gt; <span class="variable language_">this</span>.<span class="property">total</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">i</span>++;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可无限迭代的随机数</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">            <span class="attr">value</span>: <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//要输出斐波拉契数列的前N位</span></span><br><span class="line"><span class="comment">//一个无限的斐波拉契数列 1 1 2 3 5 8 13 21</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">curIndex</span>: <span class="number">1</span>, <span class="comment">//当前取到斐波拉契的第几位了，从1开始</span></span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">curIndex</span> === <span class="number">1</span> || <span class="variable language_">this</span>.<span class="property">curIndex</span> === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">curIndex</span>++;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">value</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="variable language_">this</span>.<span class="property">a</span> + <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">curIndex</span>++;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = <span class="variable language_">this</span>.<span class="property">b</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = c;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">value</span>: c,</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(iterator.<span class="title function_">next</span>().<span class="property">value</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个一个迭代，直到不能迭代位置</span></span><br><span class="line"><span class="keyword">var</span> iterator = &#123;</span><br><span class="line">    <span class="attr">total</span>: <span class="number">3</span>, <span class="comment">//可迭代3次</span></span><br><span class="line">    <span class="attr">i</span>: <span class="number">1</span>, <span class="comment">//当前的迭代次数</span></span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> obj = &#123; <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">            <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">i</span> &gt; <span class="variable language_">this</span>.<span class="property">total</span> ? <span class="literal">undefined</span> : <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">            <span class="attr">done</span>: <span class="variable language_">this</span>.<span class="property">i</span> &gt; <span class="variable language_">this</span>.<span class="property">total</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">i</span>++;</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> next = iterator.<span class="title function_">next</span>();</span><br><span class="line"><span class="keyword">while</span> (!next.<span class="property">done</span>) &#123;</span><br><span class="line">    <span class="comment">//若当前迭代的数据不是迭代器的结束</span></span><br><span class="line">    <span class="comment">//如果当前还有数据</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(next.<span class="property">value</span>);</span><br><span class="line">    next = iterator.<span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="迭代器创建函数-iterator-creator"><a href="#迭代器创建函数-iterator-creator" class="headerlink" title="迭代器创建函数 iterator creator"></a>迭代器创建函数 iterator creator</h4><p>它是指一个函数，调用该函数后，返回一个迭代器，则该函数称之为迭代器创建函数，可以简称位迭代器函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createIterator</span>(<span class="params">total</span>) &#123;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = &#123; <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">                <span class="attr">value</span>: i &gt; total ? <span class="literal">undefined</span> : <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">                <span class="attr">done</span>: i &gt; total</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = <span class="title function_">createIterator</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">var</span> next = iterator.<span class="title function_">next</span>();</span><br><span class="line"><span class="keyword">while</span> (!next.<span class="property">done</span>) &#123;</span><br><span class="line">    <span class="comment">//若当前迭代的数据不是迭代器的结束</span></span><br><span class="line">    <span class="comment">//如果当前还有数据</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(next.<span class="property">value</span>);</span><br><span class="line">    next = iterator.<span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个用户迭代数组的迭代器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createArrayIterator</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>; <span class="comment">//下标从0开始迭代</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">value</span>: arr[i++],</span><br><span class="line">                <span class="attr">done</span>: i &gt; arr.<span class="property">length</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iterator = <span class="title function_">createArrayIterator</span>([<span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure>


<h3 id="3-可迭代协议"><a href="#3-可迭代协议" class="headerlink" title="3.可迭代协议"></a>3.可迭代协议</h3><p>ES6中出现了for-of循环，该循环就是用于迭代某个对象的，因此，for-of循环要求对象必须是可迭代的（对象必须满足可迭代协议）</p>
<p>可迭代协议是用于约束一个对象的，如果一个对象满足下面的规范，则该对象满足可迭代协议，也称之为该对象是可以被迭代的。</p>
<p>可迭代协议的约束如下：</p>
<ol>
<li>对象必须有一个知名符号属性（Symbol.iterator）</li>
<li>该属性必须是一个无参的迭代器创建函数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//obj满足可迭代协议</span></span><br><span class="line"><span class="comment">//obj可被迭代</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> total = <span class="number">3</span>;</span><br><span class="line">        i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> obj = &#123; <span class="comment">//当前这一次迭代到的数据</span></span><br><span class="line">                    <span class="attr">value</span>: i &gt; total ? <span class="literal">undefined</span> : <span class="title class_">Math</span>.<span class="title function_">random</span>(),</span><br><span class="line">                    <span class="attr">done</span>: i &gt; total</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">return</span> obj;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟for-of循环</span></span><br><span class="line"><span class="keyword">var</span> iterator = obj[<span class="title class_">Symbol</span>.<span class="property">iterator</span>]();</span><br><span class="line"><span class="keyword">var</span> result = iterator.<span class="title function_">next</span>();</span><br><span class="line"><span class="keyword">while</span> (!result.<span class="property">done</span>) &#123;</span><br><span class="line">    <span class="comment">//有数据</span></span><br><span class="line">    <span class="keyword">const</span> item = result.<span class="property">value</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item); <span class="comment">//执行循环体</span></span><br><span class="line">    result = iterator.<span class="title function_">next</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-for-of循环的原理"><a href="#4-for-of循环的原理" class="headerlink" title="4.for-of循环的原理"></a>4.for-of循环的原理</h3><p>调用对象的[Symbol.iterator]方法，得到一个迭代器。不断调用next方法，只有返回的done为false，则将返回的value传递给变量，然后进入循环体执行一次。</p>
<h2 id="六、生成器-generator"><a href="#六、生成器-generator" class="headerlink" title="六、生成器 generator"></a>六、生成器 generator</h2><h3 id="1-generator"><a href="#1-generator" class="headerlink" title="1.generator"></a>1.generator</h3><p>生成器：由构造函数Generator创建的对象，该对象既是一个迭代器，同时，又是一个可迭代对象（满足可迭代协议的对象）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//伪代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="keyword">new</span> <span class="title class_">Generator</span>();</span><br><span class="line">generator.<span class="title function_">next</span>();<span class="comment">//它是迭代器具有next方法</span></span><br><span class="line"><span class="keyword">var</span> iterator = generator[<span class="title class_">Symbol</span>.<span class="property">iterator</span>];<span class="comment">//它也是一个可迭代对象，具有Symbol.iterator属性</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> item <span class="keyword">of</span> generator)&#123;</span><br><span class="line">    <span class="comment">//由于它是一个可迭代对象，因此也可以使用for of循环</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：Generator构造函数，不提供给开发者使用，仅作为JS引擎内部使用</strong></p>
<h3 id="2-generator-function"><a href="#2-generator-function" class="headerlink" title="2.generator function"></a>2.generator function</h3><p>生成器函数（生成器创建函数）：该函数用于创建一个生成器。</p>
<p>ES6新增了一个特殊的函数，叫做生成器函数，只要在函数名与function关键字之间加上一个*号，则该函数会自动返回一个生成器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">createGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">// &#123;value:1, done:false&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="title function_">createGenerator</span>(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<p>生成器函数的特点：</p>
<ol>
<li><p>调用生成器函数，会返回一个生成器，而不是执行函数体（因为，生成器函数的函数体执行，受到生成器控制）</p>
</li>
<li><p>每当调用了生成器的next方法，生成器的函数体会从上一次yield的位置（或开始位置）运行到下一个yield</p>
<ol>
<li>yield关键字只能在生成器内部使用，不可以在普通函数内部使用</li>
<li>它表示暂停，并返回一个当前迭代的数据</li>
<li>如果没有下一个yield，到了函数结束，则生成器的next方法得到的结果中的done为true</li>
</ol>
</li>
<li><p>yield关键字后面的表达式返回的数据，会作为当前迭代的数据</p>
</li>
<li><p>生成器函数的返回值，会作为迭代结束时的value</p>
<ol>
<li>但是，如果在结束过后，仍然反复调用next，则value为undefined</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用生成器函数生成一个迭代器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">createArrayIterator</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = arr[i];</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`第<span class="subst">$&#123;i&#125;</span>次迭代`</span>)</span><br><span class="line">        <span class="keyword">yield</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数结束&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="title function_">createArrayIterator</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br></pre></td></tr></table></figure></li>
<li><p>生成器调用next的时候，可以传递参数，该参数会作为生成器函数体上一次yield表达式的值。</p>
<ol>
<li>生成器第一次调用next函数时，传递参数没有任何意义</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">createGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值 result并不是1给的值而是外面next给的参数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result); <span class="comment">// b</span></span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result); <span class="comment">// 后续操作如果不给next传递参数，打印result为undefined</span></span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="title function_">createGenerator</span>(); <span class="comment">//调用后，一定得到一个生成器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result = generator.<span class="title function_">next</span>(); </span><br><span class="line"><span class="comment">//&#123;value:1, done:false&#125; 第一次调用如果传参&#x27;a&#x27;无意义，因为第一次运行会停止在yield，下一次才会给函数体中的result赋值</span></span><br><span class="line"></span><br><span class="line">generator.<span class="title function_">next</span>(<span class="string">&#x27;b&#x27;</span>) <span class="comment">// 第二次调用打印 &quot;生成器函数的函数体 - 运行1&quot;, b 。会将b当作yield1的返回结果传递给result</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!result.<span class="property">done</span>) &#123;</span><br><span class="line">    <span class="comment">//有迭代的值</span></span><br><span class="line">    result = generator.<span class="title function_">next</span>(result.<span class="property">value</span>); <span class="comment">// 保证函数体中的result正确</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>在async和await出现之前用生成器解决异步问题，看不懂再看视频，也不太难懂</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">asyncGetData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="string">&quot;成哥&quot;</span>)</span><br><span class="line">        &#125;, <span class="number">2000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">task</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开始获取数据....&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">yield</span> <span class="title function_">asyncGetData</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;获取到数据：&quot;</span>, data);</span><br><span class="line">    <span class="keyword">const</span> data2 = <span class="keyword">yield</span> <span class="title function_">asyncGetData</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;又获取到了数据：&quot;</span>, data2);</span><br><span class="line">    <span class="keyword">const</span> data3 = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;又获取到了数据：&quot;</span>, data3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用函数：运行一个生成器任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">run</span>(<span class="params">generatorFunction</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> generator = <span class="title function_">generatorFunction</span>(); <span class="comment">//得到一个生成器</span></span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封装了generator的next方法，进行下一次迭代</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">next</span>(<span class="params">nextValue</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> result = generator.<span class="title function_">next</span>(nextValue);</span><br><span class="line">        <span class="keyword">if</span> (result.<span class="property">done</span>) &#123;</span><br><span class="line">            <span class="comment">//迭代结束了</span></span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> value = result.<span class="property">value</span>; <span class="comment">//拿到迭代的数据</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> value.<span class="property">then</span> === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">//迭代的数据是一个Promise，等待拿到数据后再进行下一步</span></span><br><span class="line">            value.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="title function_">next</span>(data));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(result.<span class="property">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">run</span>(task);</span><br><span class="line"><span class="comment">// 循环中能写异步操作吗</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>生成器带有一个throw方法，该方法与next的效果相同，唯一的区别在于：</p>
<ol>
<li>next方法传递的参数会被返回成一个正常值</li>
<li>throw方法传递的参数是一个错误对象，会导致生成器函数内部发生一个错误，报错将无法往下继续运行，和正常报错一样。</li>
</ol>
</li>
<li><p>生成器带有一个return方法，该方法会直接结束生成器函数（就等于函数体中return）</p>
</li>
<li><p>若需要在生成器内部调用其他生成器，注意：如果直接调用，得到的是一个生成器，如果加入*号调用，则进入其生成器内部执行。如果是<code>yield* 函数()</code>调用生成器函数，则该函数的返回结果，为该表达式的结果</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">g2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;g2-开始&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="string">&quot;g1&quot;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;g2-运行1&quot;</span>);</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="string">&quot;g2&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面的函数是一个生成器函数，用于创建生成器</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">createGenerator</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 开始&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">1</span>; <span class="comment">//将1作为第一次的迭代的值</span></span><br><span class="line">    result = <span class="keyword">yield</span>* <span class="title function_">g2</span>(); <span class="comment">//等于运行g2函数体里面的内容 这里的result为g2函数的返回值,不会被next传递的参数影响</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行1&quot;</span>, result);</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">2</span>; <span class="comment">//将2作为第二次迭代的值</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行2&quot;</span>, result);</span><br><span class="line">    result = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;生成器函数的函数体 - 运行3&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;结束&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> generator = <span class="title function_">createGenerator</span>(); <span class="comment">//调用后，一定得到一个生成器</span></span><br></pre></td></tr></table></figure>

<h2 id="七、redux-saga"><a href="#七、redux-saga" class="headerlink" title="七、redux-saga"></a>七、redux-saga</h2><h3 id="1-saga基础"><a href="#1-saga基础" class="headerlink" title="1.saga基础"></a>1.saga基础</h3><blockquote>
<p>中文文档地址：<a target="_blank" rel="noopener" href="https://redux-saga-in-chinese.js.org/">https://redux-saga-in-chinese.js.org/</a></p>
<p>注意：saga没有要求必须是第一个中间件，因为它不会污染action，且不会拦截阻止action的移交</p>
</blockquote>
<ul>
<li>纯净</li>
<li>强大</li>
<li>灵活</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/04/67a181022fb0f.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/store/index</span></span><br><span class="line"><span class="comment">// 用于创建仓库，并导出</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&quot;./reducer&quot;</span></span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">&quot;redux-logger&quot;</span></span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">&quot;redux-saga&quot;</span></span><br><span class="line"><span class="keyword">import</span> rootSaga <span class="keyword">from</span> <span class="string">&quot;./saga&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sagaMid = <span class="title function_">createSagaMiddleware</span>(); <span class="comment">//创建一个saga的中间件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">createStore</span>(reducer,</span><br><span class="line">    <span class="title function_">applyMiddleware</span>(sagaMid, logger)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">sagaMid.<span class="title function_">run</span>(rootSaga); <span class="comment">//启动saga任务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>在saga任务中，如果yield了一个普通数据，saga不作任何处理，仅仅将数据传递给yield表达式（把得到的数据放到next的参数中），因此，在saga中，yield一个普通数据没什么意义。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// saga任务</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* ()&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;saga启动了&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aaa&#x27;</span>, result); <span class="comment">// aaa 2 和上面讲的生成器一样把yield 2的value传递到next函数中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>saga需要你在yield后面放上一些合适的saga指令（saga effects），如果放的是指令，saga中间件会根据不同的指令进行特殊处理，以控制整个任务的流程。</p>
<p>每个指令本质上就是一个函数，该函数调用后，会返回一个指令对象，saga会接收到该指令对象，进行各种处理</p>
<p><strong>一旦saga任务完成（生成器函数运行完成），则saga中间件一定结束</strong></p>
<p><strong>指令前面必须使用yield，以确保该指令的返回结果被saga控制</strong></p>
<ul>
<li>take指令：【阻塞】监听某个action，如果action发生了，才会进行下一步处理，take指令仅监听一次。yield得到的是完整的action对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; take &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes &#125; <span class="keyword">from</span> <span class="string">&#x27;../action/counter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="comment">// 写一个死循环，防止saga任务完成（生成器函数运行完成），保证中间件不会结束，持续监听actionTypes.asyncIncrease</span></span><br><span class="line">        <span class="keyword">const</span> action = <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">asyncIncrease</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发生了异步的increase&quot;</span>, action); </span><br><span class="line">        <span class="comment">// 也就是dispatch了actionTypes.asyncIncrease后，该语句才会输出。如果没有死循环，运行完这句话，再dispatch，不会再次输出，因为saga任务结束了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>all指令：【阻塞】该函数传入一个数组，数组中放入生成器，saga会等待所有的生成器全部完成后才会进一步处理</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> counterTask <span class="keyword">from</span> <span class="string">&quot;./counterTask&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentTask <span class="keyword">from</span> <span class="string">&quot;./studentTask&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">all</span>([<span class="title function_">counterTask</span>(), <span class="title function_">studentTask</span>()]) <span class="comment">// 注意要调用传入，因为传递的是生成器不是生成器函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;saga 完成&quot;</span>) <span class="comment">// 所有生成器完成后才能输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// counterTask</span></span><br><span class="line"><span class="keyword">import</span> &#123; take &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="comment">// 如果是死循环，始终将无法输出</span></span><br><span class="line">        <span class="keyword">const</span> action = <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">asyncIncrease</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听到了async-increase&quot;</span>, action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>takeEvery指令：不断的监听某个action，当某个action到达之后，运行一个函数。takeEvery永远不会结束当前的生成器</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> counterTask <span class="keyword">from</span> <span class="string">&quot;./counterTask&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentTask <span class="keyword">from</span> <span class="string">&quot;./studentTask&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">all</span>([<span class="title function_">counterTask</span>(), <span class="title function_">studentTask</span>()]) <span class="comment">// 注意要调用传入，因为传递的是生成器不是生成器函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;saga 完成&quot;</span>) <span class="comment">// 所有生成器完成后才能输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// counterTask</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncIncrease</span>(<span class="params"></span>) &#123; <span class="comment">// 之所以使用生成器函数，是因为普通函数中不能用指令，不能用yield，如果有些副作用要处理就无法解决</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;触发了asyncIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;触发了asyncDecrease&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// takeEvery永远不会结束当前的生成器，所以&#x27;saga 完成&#x27;将无法输出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncIncrease</span>, asyncIncrease) <span class="comment">// 参数一：监听的action 参数二：运行的某个生成器函数</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncDecrease</span>, asyncDecrease)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听asyncIncrease、asyncDecrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-saga指令1"><a href="#2-saga指令1" class="headerlink" title="2.saga指令1"></a>2.saga指令1</h3><ul>
<li>delay指令：【阻塞】阻塞指定的毫秒数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> counterTask <span class="keyword">from</span> <span class="string">&quot;./counterTask&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentTask <span class="keyword">from</span> <span class="string">&quot;./studentTask&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">all</span>([<span class="title function_">counterTask</span>(), <span class="title function_">studentTask</span>()]) <span class="comment">// 注意要调用传入，因为传递的是生成器不是生成器函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;saga 完成&quot;</span>) <span class="comment">// 所有生成器完成后才能输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// counterTask</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 如果我们希望某些操作延迟一段时间执行</span></span><br><span class="line">    <span class="comment">// setTimeout(() =&gt; &#123;&#125;,timeout) 不要这样写因为里面的函数不能受到saga控制，里面不能使用指令</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>) <span class="comment">// 这样写 √</span></span><br><span class="line">    <span class="comment">// let result = yield delay(2000,123) // 这样写结果为123，没啥用</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;触发了asyncIncrease&quot;</span>,result) <span class="comment">// 默认结果为true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;触发了asyncDecrease&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncIncrease</span>, asyncIncrease) <span class="comment">// 参数一：监听的action 参数二：运行的某个生成器函数</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncDecrease</span>, asyncDecrease)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听asyncIncrease、asyncDecrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>put指令：用于重新触发action，相当于dispatch一个action</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> counterTask <span class="keyword">from</span> <span class="string">&quot;./counterTask&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentTask <span class="keyword">from</span> <span class="string">&quot;./studentTask&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">all</span>([<span class="title function_">counterTask</span>(), <span class="title function_">studentTask</span>()]) <span class="comment">// 注意要调用传入，因为传递的是生成器不是生成器函数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;saga 完成&quot;</span>) <span class="comment">// 所有生成器完成后才能输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// counterTask</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery, delay, put &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>)</span><br><span class="line">	<span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>()) <span class="comment">// 处理完副作用后再次进行dispatch，有点像redux-thunk</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>)</span><br><span class="line">	<span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncIncrease</span>, asyncIncrease) <span class="comment">// 参数一：监听的action 参数二：运行的某个生成器函数</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncDecrease</span>, asyncDecrease)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听asyncIncrease、asyncDecrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每个action都会触发都会往后续移交，并不会被拦截。触发了两个action，先触发asyncIncrease，再触发increase</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/06/67a4542ddd8af.png"></p>
<ul>
<li>call指令：【可能阻塞，如果是promise会阻塞】用于副作用（通常是异步）函数调用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; all &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> counterTask <span class="keyword">from</span> <span class="string">&quot;./counterTask&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentTask <span class="keyword">from</span> <span class="string">&quot;./studentTask&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* saga任务</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">all</span>([<span class="title function_">counterTask</span>(), <span class="title function_">studentTask</span>()])</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;saga 完成&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// studentTask</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, setIsLoading, setStudentsAndTotal &#125; <span class="keyword">from</span> <span class="string">&quot;../action/student/searchResult&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery, put &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; searchStudents &#125; <span class="keyword">from</span> <span class="string">&quot;../../services/student&quot;</span> <span class="comment">// 请求学生数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">fetchStudents</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//设置为正在加载中</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">true</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//当saga发现得到的结果是一个Promise对象，它会自动等待该Promise完成</span></span><br><span class="line">    <span class="comment">//完成之后，会把完成的结果作为值传递到下一次next</span></span><br><span class="line">    <span class="comment">//如果Promise对象被拒绝，saga会使用generator.throw抛出一个错误</span></span><br><span class="line">    <span class="comment">// const resp = yield searchStudents() 这种写法可以但是不推荐，因为saga中yield一般都是saga指令，统一格式方便单元测试</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用call指令</span></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">yield</span> <span class="title function_">call</span>(searchStudents) <span class="comment">// 参数一：函数名 参数二：函数的参数，格式为参数列表 如：1,2,3,4</span></span><br><span class="line">    <span class="comment">// const resp = yield call([&#x27;abc&#x27;,searchStudents]) 如果searchStudents中要用到this可以这样绑定this，此时this为abc</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setStudentsAndTotal</span>(resp.<span class="property">datas</span>, resp.<span class="property">cont</span>))</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">false</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">fetchStudents</span>, fetchStudents);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 fetchStudents&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>apply指令：【可能阻塞】用于副作用（通常是异步）函数调用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用法同call</span></span><br><span class="line"><span class="keyword">const</span> resp = <span class="keyword">yield</span> <span class="title function_">apply</span>(<span class="literal">null</span>,searchStudents,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]) <span class="comment">// 传参方式不同 this 函数名 参数</span></span><br></pre></td></tr></table></figure>

<ul>
<li>select指令：用于得到当前仓库中的数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">fetchStudents</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//设置为正在加载中</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">true</span>))</span><br><span class="line">    <span class="comment">// const state = yield select(); 拿到仓库中的全部数据</span></span><br><span class="line">    <span class="keyword">const</span> condition = <span class="keyword">yield</span> <span class="title function_">select</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">students</span>.<span class="property">condition</span>); <span class="comment">// 对仓库中的数据进行筛选</span></span><br><span class="line">    <span class="comment">//使用call指令，按照当前仓库中的条件</span></span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">yield</span> <span class="title function_">call</span>(searchStudents, condition)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setStudentsAndTotal</span>(resp.<span class="property">datas</span>, resp.<span class="property">cont</span>))</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">false</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>cps指令：【可能阻塞：看回调函数什么时候调用】用于调用那些传统的回调方式的异步函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; actionTypes, setIsLoading, setStudentsAndTotal &#125; <span class="keyword">from</span> <span class="string">&quot;../action/student/searchResult&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery, put, cps, select &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 传统回调模式的异步</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; callback </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mockStudents</span>(<span class="params">condition, callback</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mockStudents&quot;</span>, condition);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">            <span class="comment">//nodejs风格</span></span><br><span class="line">            <span class="title function_">callback</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">                <span class="attr">cont</span>: <span class="number">78</span>,</span><br><span class="line">                <span class="attr">datas</span>: [</span><br><span class="line">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;abc&quot;</span> &#125;,</span><br><span class="line">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;bcd&quot;</span> &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;出错了！！！1&quot;</span>), <span class="literal">null</span>); <span class="comment">// 参数一：错误对象 参数二：数据</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">fetchStudents</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//设置为正在加载中</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">true</span>))</span><br><span class="line">    <span class="keyword">const</span> condition = <span class="keyword">yield</span> <span class="title function_">select</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">students</span>.<span class="property">condition</span>);</span><br><span class="line">    <span class="comment">//使用call指令，按照当前仓库中的条件</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> resp = <span class="keyword">yield</span> <span class="title function_">cps</span>(mockStudents, condition) <span class="comment">// 它会自动传递一个回调函数</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setStudentsAndTotal</span>(resp.<span class="property">datas</span>, resp.<span class="property">cont</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123; <span class="comment">// 无论有没有错误都执行</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">setIsLoading</span>(<span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">fetchStudents</span>, fetchStudents);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听 fetchStudents&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>补充：如果没有副作用（即普通函数），可以不使用指令</strong></p>
<h3 id="3-saga指令2"><a href="#3-saga指令2" class="headerlink" title="3.saga指令2"></a>3.saga指令2</h3><ul>
<li>fork：用于开启一个新的任务，该任务不会阻塞，该函数需要传递一个生成器函数，fork返回了一个对象，类型为Task（这块代码没写全太复杂了，难理解）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; takeEvery, take, delay, put, fork, cancel &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase, decrease &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">asyncIncrease</span>)</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">		这样写调用3次asyncIncrease，会发现increase()只运行了一次，是因为在第一次调用的时候take已经监听结束，由于delay现在还在阻塞中，新的监听还没开始</span></span><br><span class="line"><span class="comment">        	yield delay(2000)</span></span><br><span class="line"><span class="comment">        	yield put(increase());</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">fork</span>(<span class="keyword">function</span>* () &#123; <span class="comment">// 这样写则会运行三次，因为会开一个新的线程，不会阻塞当前任务</span></span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>)</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 以最后一次调用为准，比如说调用三次，只执行第三次，前两次都取消，有点类似于防抖</span></span><br><span class="line"><span class="comment">function* asyncIncrease() &#123;</span></span><br><span class="line"><span class="comment">    let task;</span></span><br><span class="line"><span class="comment">    while (true) &#123;</span></span><br><span class="line"><span class="comment">        yield take(actionTypes.asyncIncrease)</span></span><br><span class="line"><span class="comment">        //监听到了action，并且在开启新任务之前，取消之前的任务</span></span><br><span class="line"><span class="comment">        if (task) &#123;</span></span><br><span class="line"><span class="comment">            //之前有任务</span></span><br><span class="line"><span class="comment">            yield cancel(task) // 可以取消多个任务 cancel(task,t2,t3)</span></span><br><span class="line"><span class="comment">            console.log(&quot;之前的任务被取消掉了&quot;)</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        task = yield fork(function* () &#123;</span></span><br><span class="line"><span class="comment">            yield delay(2000)</span></span><br><span class="line"><span class="comment">            yield put(increase());</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用3次asyncIncrease，decrease()运行了三次，</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">asyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">decrease</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">fork</span>(asyncIncrease)</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">asyncDecrease</span>, asyncDecrease)<span class="comment">// takeEvery就是通过fork来实现的</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听asyncIncrease、asyncDecrease&quot;</span>)<span class="comment">// 先打印出来，说明fork不会阻塞，fork就像开了一个新的线程，它内部会阻塞，与外面无关</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>用takeEvery存在的问题，拿不到上次开启的任务线</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; take, delay, put, fork, takeEvery, cancel &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function takeEvery(actionType, saga) &#123;</span></span><br><span class="line"><span class="comment">//     return fork(function* () &#123;</span></span><br><span class="line"><span class="comment">//         while (true) &#123;</span></span><br><span class="line"><span class="comment">//             const action = yield take(actionType);</span></span><br><span class="line"><span class="comment">//             fork(saga)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">autoIncrease</span>(<span class="params"></span>) &#123; <span class="comment">// 自增任务</span></span><br><span class="line">    <span class="keyword">if</span>(task)&#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">cancel</span>(task); <span class="comment">// 取消的是takeEvery的任务，与它开启的子任务无关。并且取消后就无法开启了（这点靠自己理解）</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;监听到了autoIncrease&quot;</span>) <span class="comment">// 第一次会运行，第二次不会运行，因为第一次运行时，把takeEvery任务取消掉了，第二次无法触发该任务了</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">       <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">       <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    task = <span class="keyword">yield</span> <span class="title function_">takeEvery</span>(actionTypes.<span class="property">autoIncrease</span>, autoIncrease);</span><br><span class="line">    <span class="comment">// 如果调用三次actionTypes.autoIncrease，会开启三个自增任务，且三个互不干扰（这个说法要忽略上面if里面的内容）</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听autoIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/07/67a56a2f29302.png"></p>
<p><em>解决上述问题</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; take, delay, put, fork, takeEvery, cancel &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function takeEvery(actionType, saga) &#123;</span></span><br><span class="line"><span class="comment">//     return fork(function* () &#123;</span></span><br><span class="line"><span class="comment">//         while (true) &#123;</span></span><br><span class="line"><span class="comment">//             const action = yield take(actionType);</span></span><br><span class="line"><span class="comment">//             fork(saga)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">autoIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> task;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">autoIncrease</span>)</span><br><span class="line">        <span class="keyword">if</span>(task)&#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">cancel</span>(task); <span class="comment">// 取消掉之前开启的任务线</span></span><br><span class="line">        &#125;</span><br><span class="line">        task = <span class="keyword">yield</span> <span class="title function_">fork</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">                <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">fork</span>(autoIncrease);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听autoIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>cancel：用于取消一个或多个任务（fork分叉的任务可以被主任务取消），实际上，取消的实现原理，是利用generator.return。cancel可以不传递参数，如果不传递参数，则取消当前任务线。</li>
<li>takeLastest：功能和takeEvery一致，只不过，会自动取消掉之前开启的任务</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; take, delay, put, fork, takeEvery, takeLastest &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">autoIncrease</span>(<span class="params"></span>) &#123; <span class="comment">// 自增任务</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">       <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">       <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">takeLastest</span>(actionTypes.<span class="property">autoIncrease</span>, autoIncrease); <span class="comment">// 实现上面解决的效果</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听autoIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>saga高级用法流程控制，真滴牛叉</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fork, take, delay, put, cancel, cancelled &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自动增加和停止的流程控制</span></span><br><span class="line"><span class="comment"> * 流程：自动增加 -&gt; 停止 -&gt; 自动增加 -&gt; 停止</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">autoTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">autoIncrease</span>); <span class="comment">//只监听autoIncrease</span></span><br><span class="line">        <span class="keyword">const</span> task = <span class="keyword">yield</span> <span class="title function_">fork</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">                    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">yield</span> <span class="title function_">cancelled</span>()) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;自动增加任务被取消掉了！！！&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">stopAutoIncrease</span>); <span class="comment">//转而监听stopAutoIncrease</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">cancel</span>(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">fork</span>(autoTask);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听autoIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>cancelled：判断当前任务线是否被取消掉了</li>
<li>race：【阻塞】竞赛，可以传递多个指令，当其中任何一个指令结束后，会直接结束，与Promise.race类似。返回的结果，是最先完成的指令结果。并且，该函数会自动取消其他的任务</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fork, race, call &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; increase, decrease &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步的得到一个action</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">asyncAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//生成一个1000~5000毫秒的随机时间</span></span><br><span class="line">    <span class="keyword">var</span> duration = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4000</span> + <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="title function_">increase</span>())</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="title function_">decrease</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, duration);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">yield</span> <span class="title function_">race</span>(&#123;</span><br><span class="line">        <span class="attr">action1</span>: <span class="title function_">call</span>(asyncAction),</span><br><span class="line">        <span class="attr">action2</span>: <span class="title function_">call</span>(asyncAction)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>race改造流程控制</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fork, take, delay, put, race, call &#125; <span class="keyword">from</span> <span class="string">&quot;redux-saga/effects&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; actionTypes, increase &#125; <span class="keyword">from</span> <span class="string">&quot;../action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自动增加和停止的流程控制</span></span><br><span class="line"><span class="comment"> * 流程：自动增加 -&gt; 停止 -&gt; 自动增加 -&gt; 停止</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">autoTask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">take</span>(actionTypes.<span class="property">autoIncrease</span>); <span class="comment">//只监听autoIncrease</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="title function_">race</span>(&#123;</span><br><span class="line">            <span class="attr">autoIncrease</span>: <span class="title function_">call</span>(<span class="keyword">function</span>* () &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="keyword">yield</span> <span class="title function_">delay</span>(<span class="number">2000</span>);</span><br><span class="line">                    <span class="keyword">yield</span> <span class="title function_">put</span>(<span class="title function_">increase</span>());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="attr">cancel</span>: <span class="title function_">take</span>(actionTypes.<span class="property">stopAutoIncrease</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span>* () &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="title function_">fork</span>(autoTask);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;正在监听autoIncrease&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="八、手写saga"><a href="#八、手写saga" class="headerlink" title="八、手写saga"></a>八、手写saga</h2><p>先行跳过</p>
<h2 id="九、redux-actions"><a href="#九、redux-actions" class="headerlink" title="九、redux-actions"></a>九、redux-actions</h2><blockquote>
<p>该库用于简化action-types、action-creator以及reducer<br>官网文档：<a target="_blank" rel="noopener" href="https://redux-actions.js.org/">https://redux-actions.js.org/</a></p>
</blockquote>
<h3 id="1-createAction-s"><a href="#1-createAction-s" class="headerlink" title="1.createAction(s)"></a>1.createAction(s)</h3><h4 id="createAction"><a href="#createAction" class="headerlink" title="createAction"></a>createAction</h4><p>该函数用于帮助你创建一个action创建函数（action creator）,但是一般用的是createActions</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现原理</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createAction</span>(<span class="params">type, payloadCreator</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">actionCreator</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> payloadCreator === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> payload = <span class="title function_">payloadCreator</span>(...args)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                type,</span><br><span class="line">                payload</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                type</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actionTypes = &#123;</span><br><span class="line">    <span class="attr">increase</span>: <span class="string">&quot;INCREASE&quot;</span>, <span class="comment">// 用大写符合flux标准</span></span><br><span class="line">    <span class="attr">decrease</span>: <span class="string">&quot;DECREASE&quot;</span>,</span><br><span class="line">    <span class="attr">asyncIncrease</span>: <span class="string">&quot;ASYNC_INCREASE&quot;</span>, <span class="comment">//异步增加</span></span><br><span class="line">    <span class="attr">asyncDecrease</span>: <span class="string">&quot;ASYNC_DECREASE&quot;</span>, <span class="comment">//异步减少</span></span><br><span class="line">    <span class="attr">add</span>: <span class="string">&quot;ADD&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> increase = <span class="title function_">createAction</span>(actionTypes.<span class="property">increase</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	export function increase() &#123;</span></span><br><span class="line"><span class="comment">		return &#123; type: actionTypes.increase &#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="title function_">createAction</span>(actionTypes.<span class="property">add</span>, <span class="function"><span class="params">number</span> =&gt;</span> number, <span class="function">() =&gt;</span> (&#123; <span class="attr">isAdmin</span>: <span class="literal">true</span> &#125;));<span class="comment">//type, payload需要为函数，元数据meta</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	export function add(number) &#123;</span></span><br><span class="line"><span class="comment">    	return &#123; type: actionTypes.add, payload: number &#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="createActions"><a href="#createActions" class="headerlink" title="createActions"></a>createActions</h4><p>该函数用于帮助你创建多个action创建函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createActions &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actionTypes = &#123;</span><br><span class="line">    <span class="attr">increase</span>: <span class="string">&quot;INCREASE&quot;</span>,</span><br><span class="line">    <span class="attr">decrease</span>: <span class="string">&quot;DECREASE&quot;</span>,</span><br><span class="line">    <span class="attr">asyncIncrease</span>: <span class="string">&quot;ASYNC_INCREASE&quot;</span>, <span class="comment">//异步增加</span></span><br><span class="line">    <span class="attr">asyncDecrease</span>: <span class="string">&quot;ASYNC_DECREASE&quot;</span>, <span class="comment">//异步减少</span></span><br><span class="line">    <span class="attr">add</span>: <span class="string">&quot;ADD&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123;increase, decrease, asyncIncrease, asyncDecrease, add&#125; = <span class="title function_">createActions</span>(&#123;</span><br><span class="line">    <span class="attr">INCREASE</span>: <span class="literal">null</span>, <span class="comment">// 没有payload直接写null</span></span><br><span class="line">    <span class="attr">DECREASE</span>: <span class="literal">null</span>, <span class="comment">// key是类型，value是payload</span></span><br><span class="line">    <span class="attr">ASYNC_INCREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ASYNC_DECREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ADD</span>: <span class="function"><span class="params">number</span> =&gt;</span> number</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//actions: 根据传递的对象key生成相应函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    increase: fn(),</span></span><br><span class="line"><span class="comment">    decrease: fn(),</span></span><br><span class="line"><span class="comment">    asyncIncrease: fn(),</span></span><br><span class="line"><span class="comment">    asyncDecrease: fn(),</span></span><br><span class="line"><span class="comment">    add: fn(number)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><em>手写createActions</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createActions</span>(<span class="params">mapToActionCreators</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> mapToActionCreators) &#123;</span><br><span class="line">        <span class="keyword">const</span> payloadCreator = mapToActionCreators[prop]; <span class="comment">//取出属性值</span></span><br><span class="line">        <span class="keyword">const</span> newPropName = <span class="title function_">toSmallCamel</span>(prop); <span class="comment">//得到一个小驼峰命名的属性名</span></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">actionCreator</span> = (<span class="params">...args</span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> payloadCreator === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="attr">type</span>: prop,</span><br><span class="line">                    <span class="attr">payload</span>: <span class="title function_">payloadCreator</span>(...args)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    <span class="attr">type</span>: prop</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 重写toString，让handleAction传递函数名时可以拿到action字符串</span></span><br><span class="line">        actionCreator.<span class="property">toString</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> prop;</span><br><span class="line">        &#125;</span><br><span class="line">        result[newPropName] = actionCreator</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//得到小驼峰命名法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toSmallCamel</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="comment">// ASYNC_INCREASE -&gt;  [&quot;ASYNC&quot;, &quot;INCREASE&quot;] -&gt; [&quot;async&quot;, &quot;Increase&quot;] -&gt; &quot;asyncIncrease&quot;</span></span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&quot;_&quot;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">s, i</span>) =&gt;</span> &#123;</span><br><span class="line">        s = s.<span class="title function_">toLowerCase</span>();</span><br><span class="line">        <span class="keyword">if</span> (i !== <span class="number">0</span> &amp;&amp; s.<span class="property">length</span> &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            s = s[<span class="number">0</span>].<span class="title function_">toUpperCase</span>() + s.<span class="title function_">substr</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;).<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-handleAction-s"><a href="#2-handleAction-s" class="headerlink" title="2.handleAction(s)"></a>2.handleAction(s)</h3><h4 id="handleAction"><a href="#handleAction" class="headerlink" title="handleAction"></a>handleAction</h4><p>简化针对单个action类型的reducer处理，当它匹配到对应的action类型后，会执行对应的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; increase &#125; <span class="keyword">from</span> <span class="string">&quot;../../action/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleAction &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span></span><br><span class="line"><span class="comment">// export default function (state = 10, &#123; type, payload &#125;) &#123;</span></span><br><span class="line"><span class="comment">//     switch (type) &#123;</span></span><br><span class="line"><span class="comment">//         case actionTypes.increase:</span></span><br><span class="line"><span class="comment">//             return state + 1;</span></span><br><span class="line"><span class="comment">//         default:</span></span><br><span class="line"><span class="comment">//             return state;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数一：action类型（不仅可以写字符串，还能写createActions解构出来的函数），参数二：匹配后的函数，参数三：state默认值</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="title function_">handleAction</span>(increase || <span class="string">&#x27;INCREASE&#x27;</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">&#125;, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>

<h4 id="handleActions"><a href="#handleActions" class="headerlink" title="handleActions"></a>handleActions</h4><p>简化针对多个action类型的reducre处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; increase, decrease, add &#125; <span class="keyword">from</span> <span class="string">&quot;../../action/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; handleActions &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// [increase]可以换成INCREASE</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="title function_">handleActions</span>(&#123;</span><br><span class="line">    [increase]: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">    [decrease]: <span class="function"><span class="params">state</span> =&gt;</span> state - <span class="number">1</span>,</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state + action.<span class="property">payload</span></span><br><span class="line">&#125;, <span class="number">5</span>) <span class="comment">// 默认值为5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>

<p><strong>因为代码简化，可以直接把reducer和action放一个文件内</strong>，具体使用还可以看看视频或文档<a target="_blank" rel="noopener" href="https://pan.baidu.com/pfile/video?path=/%E6%88%91%E7%9A%84/%E6%B8%A1%E4%B8%80%E6%95%99%E8%82%B2-%E5%89%8D%E7%AB%AF%E5%A4%A7%E5%B8%88%E8%AF%BE/02+%E5%B0%B1%E4%B8%9A%E6%8F%90%E5%8D%87/07+React/8-14.+redux-actions%E3%80%90itjc8.com%E3%80%91.mp4">百度网盘 - 视频播放</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/action/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createActions, handleActions, combineActions &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">createActions</span>(&#123;</span><br><span class="line">    <span class="attr">INCREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">DECREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ASYNC_INCREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ASYNC_DECREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ADD</span>: <span class="function"><span class="params">number</span> =&gt;</span> number</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increase, decrease, asyncIncrease, asyncDecrease, add &#125; = actions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">handleActions</span>(&#123;</span><br><span class="line">    [increase]: <span class="function"><span class="params">state</span> =&gt;</span> state + <span class="number">1</span>,</span><br><span class="line">    [decrease]: <span class="function"><span class="params">state</span> =&gt;</span> state - <span class="number">1</span>,</span><br><span class="line">    [add]: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state + action.<span class="property">payload</span></span><br><span class="line">&#125;, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-combineActions"><a href="#3-combineActions" class="headerlink" title="3.combineActions"></a>3.combineActions</h3><p>配合createActions和handleActions两个函数，用于处理多个action-type对应同一个reducer处理函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createActions, handleActions, combineActions &#125; <span class="keyword">from</span> <span class="string">&quot;redux-actions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = <span class="title function_">createActions</span>(&#123;</span><br><span class="line">    <span class="attr">INCREASE</span>: <span class="function">() =&gt;</span> <span class="number">1</span>,</span><br><span class="line">    <span class="attr">DECREASE</span>: <span class="function">() =&gt;</span> -<span class="number">1</span>,</span><br><span class="line">    <span class="attr">ASYNC_INCREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ASYNC_DECREASE</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">ADD</span>: <span class="function"><span class="params">number</span> =&gt;</span> number</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increase, decrease, asyncIncrease, asyncDecrease, add &#125; = actions</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	export default handleActions(&#123;</span></span><br><span class="line"><span class="comment">    	[increase]: (state, action) =&gt; state + action.payload, // 可以看出来几个reducer都是一个处理函数</span></span><br><span class="line"><span class="comment">    	[decrease]: (state, action) =&gt; state + action.payload,</span></span><br><span class="line"><span class="comment">    	[add]: (state, action) =&gt; state + action.payload</span></span><br><span class="line"><span class="comment">	&#125;, 5)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并action，只要匹配其中一个就触发相关reducer</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">handleActions</span>(&#123;</span><br><span class="line">    [<span class="title function_">combineActions</span>(increase, decrease, add)]: <span class="function">(<span class="params">state, &#123; payload &#125;</span>) =&gt;</span> state + payload</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h1 id="组件、路由和数据"><a href="#组件、路由和数据" class="headerlink" title="组件、路由和数据"></a>组件、路由和数据</h1><h2 id="一、react-redux"><a href="#一、react-redux" class="headerlink" title="一、react-redux"></a>一、react-redux</h2><ul>
<li>React: 组件化的UI界面处理方案</li>
<li>React-Router: 根据地址匹配路由，最终渲染不同的组件</li>
<li>Redux：处理数据以及数据变化的方案（主要用于处理共享数据）</li>
</ul>
<blockquote>
<p>如果一个组件，仅用于渲染一个UI界面，而没有状态（通常是一个函数组件），该组件叫做<strong>展示组件</strong><br>如果一个组件，仅用于提供数据，没有任何属于自己的UI界面，则该组件叫做<strong>容器组件</strong>，容器组件纯粹是为了给其他组件提供数据。</p>
</blockquote>
<p>react-redux库：链接redux和react</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/07/67a5a1a77b31f.png"></p>
<p><strong>先不用react-redux，手写试试</strong></p>
<blockquote>
<p>补充一下：如果一个组件依赖的store中的某项数据没有发生改变，该组件不会重新渲染，类似纯组件</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../store&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; asyncDecrease, asyncIncrease, increase, decrease &#125; <span class="keyword">from</span> <span class="string">&quot;../store/action/counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//展示组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncDecrease&#125;</span>&gt;</span> 异步减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onDecrease&#125;</span>&gt;</span> 减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onIncrease&#125;</span>&gt;</span> 加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncIncrease&#125;</span>&gt;</span> 异步加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将整个仓库的状态，映射到当前需要的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; state </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">number</span>: state.<span class="property">counter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapDispatchToProps</span>(<span class="params">dispatch</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">onAsyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">asyncDecrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">decrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">increase</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onAsyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">asyncIncrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//容器组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">CounterContainer</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(props);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="title function_">mapStateToProps</span>(store.<span class="title function_">getState</span>());</span><br><span class="line">        store.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 监听仓库，仓库数据改变，改变数据</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">setState</span>(<span class="title function_">mapStateToProps</span>(store.<span class="title function_">getState</span>()))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> eventHandlers = <span class="title function_">mapDispatchToProps</span>(store.<span class="property">dispatch</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Counter</span> &#123;<span class="attr">...this.state</span>&#125; &#123;<span class="attr">...eventHandlers</span>&#125; /&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Provider组件：没有任何UI界面，该组件的作用，是将redux的仓库放到一个上下文中。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Counter</span> <span class="keyword">from</span> <span class="string">&quot;./components/Counter&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">/** Provider提供上下文 */</span></span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;/** 该组件是容器组件CounterContainer，abc可以传到展示组件中 */&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">abc</span>=<span class="string">&#123;123&#125;/</span>&gt;</span> </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>connect：高阶组件，用于链接仓库和组件的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; asyncDecrease, asyncIncrease, increase, decrease &#125; <span class="keyword">from</span> <span class="string">&quot;../store/action/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="comment">//展示组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncDecrease&#125;</span>&gt;</span> 异步减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onDecrease&#125;</span>&gt;</span> 减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onIncrease&#125;</span>&gt;</span> 加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncIncrease&#125;</span>&gt;</span> 异步加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将整个仓库的状态，映射到当前需要的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; state </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state, ownProps</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(ownProps)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">number</span>: state.<span class="property">counter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 映射事件处理函数 这种写法最为推荐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; dispatch </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapDispatchToProps</span>(<span class="params">dispatch</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">onAsyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">asyncDecrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">decrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">increase</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">onAsyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">dispatch</span>(<span class="title function_">asyncIncrease</span>())</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// //connect返回一个高阶组件</span></span><br><span class="line"><span class="comment">// const hoc = connect(mapStateToProps, mapDispatchToProps)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// //传入展示组件，返回一个容器组件</span></span><br><span class="line"><span class="comment">// export default hoc(Counter)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">Counter</span>) <span class="comment">// 参数一：映射的属性 可以传null 参数二：映射的函数 可传null或不传</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>细节一：如果对返回的容器组件加上额外的属性，则这些属性会直接传递到展示组件，ref也是一样</p>
</li>
<li><p>第一个参数：mapStateToProps: </p>
<ul>
<li>参数1：整个仓库的状态</li>
<li>参数2：使用者传递的属性对象</li>
</ul>
</li>
<li><p>第二个参数：</p>
<ul>
<li>情况1：传递一个函数 mapDispatchToProps<ul>
<li>参数1：dispatch函数</li>
<li>参数2：使用者传递的属性对象</li>
<li>函数返回的对象会作为属性传递到展示组件中（作为事件处理函数存在）</li>
</ul>
</li>
<li>情况2：传递一个对象，对象的每个属性是一个action创建函数，当事件触发时，会自动的dispatch函数返回的action</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; asyncDecrease, asyncIncrease, increase, decrease &#125; <span class="keyword">from</span> <span class="string">&quot;../store/action/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="comment">//展示组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncDecrease&#125;</span>&gt;</span> 异步减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onDecrease&#125;</span>&gt;</span> 减 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onIncrease&#125;</span>&gt;</span> 加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncIncrease&#125;</span>&gt;</span> 异步加 <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将整个仓库的状态，映射到当前需要的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; state </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">mapStateToProps</span>(<span class="params">state, ownProps</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">number</span>: state.<span class="property">counter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 情况2</span></span><br><span class="line"><span class="keyword">const</span> creators = &#123;</span><br><span class="line">    <span class="attr">onAsyncDecrease</span>: asyncDecrease,</span><br><span class="line">    <span class="attr">onDecrease</span>: decrease,</span><br><span class="line">    <span class="attr">onIncrease</span>: increase,</span><br><span class="line">    <span class="attr">onAsyncIncrease</span>: asyncIncrease</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, creators)(<span class="title class_">Counter</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>细节二：如果不传递第二个参数，通过connect连接的组件，会自动得到一个属性：dispatch，使得组件有能力自行触发action，但是，不推荐这样做。</p>
</li>
</ul>
</li>
</ul>
<p>​	<strong>流程</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/07/67a5ae1c7e4d2.png"></p>
<h2 id="二、手写react-redux"><a href="#二、手写react-redux" class="headerlink" title="二、手写react-redux"></a>二、手写react-redux</h2><p>先跳过</p>
<h2 id="三、react-redux额外的api"><a href="#三、react-redux额外的api" class="headerlink" title="三、react-redux额外的api"></a>三、react-redux额外的api</h2><blockquote>
<p>详情参考：<a target="_blank" rel="noopener" href="https://react-redux.js.org/api">https://react-redux.js.org/api</a></p>
</blockquote>
<h3 id="1-connect"><a href="#1-connect" class="headerlink" title="1.connect"></a>1.connect</h3><ul>
<li>mergeProps: 一个函数<ul>
<li>参数1：stateProps，该参数的值来自于mapStateToProps返回的值</li>
<li>参数2：dispatchProps，该参数的值来自于mapDispatchToProps返回的值</li>
<li>参数3：ownProps，来自于组件使用者传递的属性</li>
<li>返回值：一个对象，该对象的属性最终会被传递到包装的组件中。</li>
</ul>
</li>
<li>options：配置对象</li>
</ul>
<h3 id="2-connectAdvanced"><a href="#2-connectAdvanced" class="headerlink" title="2.connectAdvanced"></a>2.connectAdvanced</h3><p>该函数和connect一样，也是用于连接React组件和Redux仓库的，只不过它的配置比connect少一些</p>
<p>该函数需要传递两个参数：</p>
<ul>
<li>selectorFactory<ul>
<li>参数1：dispatch</li>
<li>参数2：factoryOptions，配置</li>
<li>返回：函数<ul>
<li>参数1：state</li>
<li>参数2：ownProps</li>
<li>返回的是一个对象：该对象的属性最终，会成为包装的组件的属性</li>
</ul>
</li>
</ul>
</li>
<li>connectOptions</li>
</ul>
<h3 id="3-createProvider"><a href="#3-createProvider" class="headerlink" title="3.createProvider"></a>3.createProvider</h3><p>createProvider(字符串key)：通过一个唯一的key值创建一个Provider组件。用于有多个store的时候，但一般用不到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Provider1</span> = <span class="title function_">createProvider</span>(<span class="string">&quot;p1&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Provider2</span> = <span class="title function_">createProvider</span>(<span class="string">&quot;p2&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="四、redux和router的结合（connected-react-router）"><a href="#四、redux和router的结合（connected-react-router）" class="headerlink" title="四、redux和router的结合（connected-react-router）"></a>四、redux和router的结合（connected-react-router）</h2><p>课前知识</p>
<blockquote>
<ol>
<li>chrome插件：redux-devtools（该插件不能直接使用，需要安装第三方库）</li>
<li>使用npm安装第三方库：redux-devtools-extension（需要修改部分代码，具体使用去npm看文档吧，不再细说）</li>
</ol>
</blockquote>
<p>用于将redux和react-router进行结合</p>
<blockquote>
<p>文档：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/connected-react-router">connected-react-router - npm</a></p>
<p>如果使用到还是看文档吧，因为讲解的版本比较老。</p>
<p>用该库是为了保证数据源统一，路由信息也从仓库中拿到</p>
</blockquote>
<p>本质上，router中的某些数据可能会跟数据仓库中的数据进行联动</p>
<p>该组件会将下面的路由数据和仓库保持同步</p>
<ol>
<li>action：它不是redux的action，它表示当前路由跳转的方式（PUSH、POP、REPLACE）</li>
<li>location：它记录了当前的地址信息</li>
</ol>
<p>该库中的内容：</p>
<h3 id="1-connectRouter"><a href="#1-connectRouter" class="headerlink" title="1.connectRouter"></a>1.connectRouter</h3><p>这是一个函数，调用它，会返回一个用于管理仓库中路由信息的reducer，该函数需要传递一个参数，参数是一个history对象。该对象，可以使用第三方库history得到。（react-router中提供的history对象也是通过该库得到的）</p>
<h3 id="2-routerMiddleware"><a href="#2-routerMiddleware" class="headerlink" title="2.routerMiddleware"></a>2.routerMiddleware</h3><p>该函数会返回一个redux中间件，用于拦截一些特殊的action</p>
<h3 id="3-ConnectedRouter"><a href="#3-ConnectedRouter" class="headerlink" title="3.ConnectedRouter"></a>3.ConnectedRouter</h3><p>这是一个组件，用于向上下文提供一个history对象和其他的路由信息（与react-router提供的信息一致）</p>
<p>之所以需要新制作一个组件，是因为该库必须保证整个过程使用的是同一个history对象</p>
<h3 id="4-一些action创建函数"><a href="#4-一些action创建函数" class="headerlink" title="4.一些action创建函数"></a>4.一些action创建函数</h3><p>就是使用connected-react-router提供的路由跳转方法会触发action</p>
<ul>
<li>push</li>
<li>replace</li>
</ul>
<h2 id="五、手写connected-react-router"><a href="#五、手写connected-react-router" class="headerlink" title="五、手写connected-react-router"></a>五、手写connected-react-router</h2><p>这块需要理解react-router的源码</p>
<h2 id="六、dva"><a href="#六、dva" class="headerlink" title="六、dva"></a>六、dva</h2><blockquote>
<p>官方网站：<a target="_blank" rel="noopener" href="https://dvajs.xiniushu.com/guide/">介绍 | DvaJS</a><br>dva不仅仅是一个第三方库，更是一个框架，它主要整合了redux的相关内容，让我们处理数据更加容易，实际上，dva依赖了很多：react、react-router、redux、redux-saga、react-redux、connected-react-router等。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2025/02/07/67a5d23b5e078.png"></p>
<h3 id="1-dva的使用"><a href="#1-dva的使用" class="headerlink" title="1.dva的使用"></a>1.dva的使用</h3><ol>
<li><p>dva默认导出一个函数，通过调用该函数，可以得到一个dva对象</p>
</li>
<li><p>dva对象.router：路由方法，传入一个函数，该函数返回一个React节点，将来，应用程序启动后，会自动渲染该节点。</p>
</li>
<li><p>dva对象.start: 该方法用于启动dva应用程序，可以认为启动的就是react程序，该函数传入一个选择器，用于选中页面中的某个dom元素，react会将内容渲染到该元素内部。</p>
</li>
<li><p>dva对象.model: 该方法用于定义一个模型，该模型可以理解为redux的action、reducer、redux-saga副作用处理的整合，整合成一个对象，将该对象传入model方法即可。</p>
<ol>
<li>namespace：命名空间，该属性是一个字符串，字符串的值，会被作为仓库中的属性保存（必写）</li>
<li>state：该模型的默认状态（必写）</li>
<li>reducers: 该属性配置为一个对象，对象中的每个方法就是一个reducer，dva约定，方法的名字，就是匹配的action类型</li>
<li>effects: 处理副作用，底层是使用redux-saga实现的，该属性配置为一个对象，对象中的每隔方法均处理一个副作用，方法的名字，就是匹配的action类型。<ol>
<li>函数的参数1：action</li>
<li>参数2：封装好的saga&#x2F;effects对象</li>
</ol>
</li>
<li>subscriptions：配置为一个对象，该对象中可以写任意数量任意名称的属性，每个属性是一个函数，这些函数会在模型加入到仓库中后立即运行。</li>
</ol>
</li>
</ol>
<p><strong>src&#x2F;index.jsx</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span></span><br><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterModel <span class="keyword">from</span> <span class="string">&quot;./models/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentsModel <span class="keyword">from</span> <span class="string">&quot;./models/students&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//得到一个dva对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//在启动之前定义模型</span></span><br><span class="line">app.<span class="title function_">model</span>(counterModel)</span><br><span class="line">app.<span class="title function_">model</span>(studentsModel)</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置根路由，即启动后，要运行的函数，函数的返回结果会被渲染</span></span><br><span class="line">app.<span class="title function_">router</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&quot;#root&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReactDom.render(&lt;App/&gt;, document.getElementById(&quot;root&quot;))</span></span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;models&#x2F;counter</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespace</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">    <span class="attr">state</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="title function_">increase</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">decrease</span>(<span class="params">state</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">add</span>(<span class="params">state, &#123; payload &#125;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state + payload;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">effects</span>: &#123;</span><br><span class="line">        *<span class="title function_">asyncIncrease</span>(<span class="params">action, &#123; call, put &#125;</span>) &#123; <span class="comment">// 可以看成takeEvery(&#x27;counter/asyncIncrease&#x27;, asyncIncrease)</span></span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;increase&quot;</span> &#125;) <span class="comment">// 触发自己模型中的action可以不用加前缀</span></span><br><span class="line">        &#125;,</span><br><span class="line">        *<span class="title function_">asyncDecrease</span>(<span class="params">action, &#123; call, put &#125;</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">call</span>(delay, <span class="number">1000</span>);</span><br><span class="line">            <span class="keyword">yield</span> <span class="title function_">put</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;decrease&quot;</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">subscriptions</span>: &#123;</span><br><span class="line">        <span class="title function_">resizeIncrease</span>(<span class="params">&#123; dispatch &#125;</span>) &#123;</span><br><span class="line">            <span class="comment">//订阅窗口尺寸变化，每次变化让数字增加</span></span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;increase&quot;</span> &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">resizeDecrease</span>(<span class="params">&#123; dispatch, history &#125;</span>) &#123;</span><br><span class="line">            history.<span class="title function_">listen</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;decrease&quot;</span> &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delay</span>(<span class="params">duration</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;, duration);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;Counter.js</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> inp = <span class="title function_">useRef</span>();</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;props.number&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncDecrease&#125;</span>&gt;</span>异步减<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onDecrease&#125;</span>&gt;</span> - <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onIncrease&#125;</span>&gt;</span> + <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onAsyncIncrease&#125;</span>&gt;</span>异步加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;inp&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">                    const n = parseInt(inp.current.value);</span></span><br><span class="line"><span class="language-xml">                    props.onAdd(n);</span></span><br><span class="line"><span class="language-xml">                &#125;&#125;&gt;加上<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = state =&gt; (&#123;</span><br><span class="line">    <span class="attr">number</span>: state.<span class="property">counter</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapDispatchToProps</span> = dispatch =&gt; (&#123;</span><br><span class="line">    <span class="title function_">onIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;counter/increase&quot;</span> <span class="comment">// 需要加上命名空间，触发counter里的increase方法</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&quot;counter/decrease&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onAdd</span>(<span class="params">n</span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;counter/add&quot;</span>, <span class="attr">payload</span>: n &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onAsyncIncrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;counter/asyncIncrease&quot;</span> &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">onAsyncDecrease</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dispatch</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;counter/asyncDecrease&quot;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="title class_">Counter</span>)</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>在dva中同步路由到仓库（其实也是依赖了conected-react-router）<ol>
<li>在调用dva函数时，配置history对象</li>
<li>使用ConnectedRouter提供路由上下文</li>
</ol>
</li>
<li>配置：<ol>
<li>history：同步到仓库的history对象</li>
<li>initialState：创建redux仓库时，使用的默认状态（通常不会配置，因为模型里已经配置了）</li>
<li>onError: 当仓库的运行发生错误的时候，运行的函数</li>
<li>onAction: 可以配置redux中间件，触发action做的事情<ol>
<li>传入一个中间件对象</li>
<li>传入一个中间件数组</li>
</ol>
</li>
<li>onStateChange: 当仓库中的状态发生变化时运行的函数</li>
<li>onReducer：对模型中的reducer的进一步封装</li>
<li>onEffect：类似于对模型中的effect的进一步封装</li>
<li>extraReducers：用于配置额外的reducer，它是一个对象，对象的每一个属性是一个方法，每个方法就是一个需要合并的reducer，方法名即属性名。</li>
<li>extraEnhancers: 它是用于封装createStore函数的，dva会将原来的仓库创建函数作为参数传递，返回一个新的用于创建仓库的函数。函数必须放置到数组中。</li>
</ol>
</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> routerConfig <span class="keyword">from</span> <span class="string">&quot;./routerConfig&quot;</span></span><br><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterModel <span class="keyword">from</span> <span class="string">&quot;./models/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentsModel <span class="keyword">from</span> <span class="string">&quot;./models/students&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const logger = store =&gt; next =&gt; action =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&quot;老状态：&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//     next(action);</span></span><br><span class="line"><span class="comment">//     console.log(&quot;新状态：&quot;, store.getState());</span></span><br><span class="line"><span class="comment">//     console.log(&quot;&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//得到一个dva对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createBrowserHistory</span>(),</span><br><span class="line">    <span class="attr">initialState</span>: &#123;</span><br><span class="line">        <span class="attr">counter</span>: <span class="number">123</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// onError(err, dispatch) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(err.message, dispatch);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// onAction: logger</span></span><br><span class="line">    <span class="comment">// onStateChange(state) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(state.counter);</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// onReducer(reducer) &#123; 该参数是原来的reducer 类似于之前讲过的封装dispatch</span></span><br><span class="line">    <span class="comment">//     return function (state, action) &#123;</span></span><br><span class="line">    <span class="comment">//         console.log(&quot;reducer即将被执行&quot;)</span></span><br><span class="line">    <span class="comment">//         const newState = reducer(state, action);</span></span><br><span class="line">    <span class="comment">//         console.log(&quot;reducer执行结束&quot;)</span></span><br><span class="line">    <span class="comment">//         return newState;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// onEffect(oldEffect, sagaEffects, model, actionType) &#123;</span></span><br><span class="line">    <span class="comment">//     return function* (action) &#123;</span></span><br><span class="line">    <span class="comment">//         console.log(&quot;即将执行副作用代码&quot;)</span></span><br><span class="line">    <span class="comment">//         yield oldEffect(action);</span></span><br><span class="line">    <span class="comment">//         console.log(&quot;副作用代码执行完毕&quot;)</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="attr">extraReducers</span>: &#123;</span><br><span class="line">        <span class="title function_">abc</span>(<span class="params">state = <span class="number">123</span>, action</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">bcd</span>(<span class="params">state = <span class="number">456</span>, action</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">extraEnhancers</span>: [<span class="keyword">function</span> (<span class="params">createStore</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;即将创建仓库1&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createStore</span>(...args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="keyword">function</span> (<span class="params">createStore</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...args</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;即将创建仓库2&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createStore</span>(...args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//在启动之前定义模型</span></span><br><span class="line">app.<span class="title function_">model</span>(counterModel)</span><br><span class="line">app.<span class="title function_">model</span>(studentsModel)</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置根路由，即启动后，要运行的函数，函数的返回结果会被渲染</span></span><br><span class="line">app.<span class="title function_">router</span>(routerConfig)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&quot;#root&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;routerConfig.js</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Counter</span> <span class="keyword">from</span> <span class="string">&quot;./Counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routerRedux, <span class="title class_">NavLink</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&quot;dva/router&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//routerRedux: 里面包含了所有connected-react-router的东西</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> (<span class="params">&#123; history &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// props中会传过来一个history,我们自己配置的history对象</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">routerRedux.ConnectedRouter</span> <span class="attr">history</span>=<span class="string">&#123;history&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&quot;/counter&quot;</span>&gt;</span>计数器<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/counter&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Counter&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">routerRedux.ConnectedRouter</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-手写dva"><a href="#2-手写dva" class="headerlink" title="2.手写dva"></a>2.手写dva</h3><p>跳过</p>
<h3 id="3-dva插件"><a href="#3-dva插件" class="headerlink" title="3.dva插件"></a>3.dva插件</h3><p>通过<code>dva对象.use(插件)</code>，来使用插件，插件本质上就是一个对象，该对象与配置对象相同，dva会在启动时，将传递的插件对象混合到配置中。</p>
<p><strong>myDvaPlugin.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">logger</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;老状态&quot;</span>, store.<span class="title function_">getState</span>())</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(action)</span><br><span class="line">    <span class="title function_">next</span>(action);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;新状态&quot;</span>, store.<span class="title function_">getState</span>())</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">onAction</span>: logger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>src&#x2F;index.js</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> routerConfig <span class="keyword">from</span> <span class="string">&quot;./routerConfig&quot;</span></span><br><span class="line"><span class="keyword">import</span> dva <span class="keyword">from</span> <span class="string">&quot;dva&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> counterModel <span class="keyword">from</span> <span class="string">&quot;./models/counter&quot;</span></span><br><span class="line"><span class="keyword">import</span> studentsModel <span class="keyword">from</span> <span class="string">&quot;./models/students&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory &#125; <span class="keyword">from</span> <span class="string">&quot;history&quot;</span></span><br><span class="line"><span class="keyword">import</span> myDvaPlugin form <span class="string">&#x27;./myDvaPlugin.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createLoading <span class="keyword">from</span> <span class="string">&quot;dva-loading&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//得到一个dva对象</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">dva</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createBrowserHistory</span>()</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">createLoading</span>()); <span class="comment">//使用dva-loading插件</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(myDvaPlugin); <span class="comment">//混合配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在启动之前定义模型</span></span><br><span class="line">app.<span class="title function_">model</span>(counterModel)</span><br><span class="line">app.<span class="title function_">model</span>(studentsModel)</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置根路由，即启动后，要运行的函数，函数的返回结果会被渲染</span></span><br><span class="line">app.<span class="title function_">router</span>(routerConfig)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">start</span>(<span class="string">&quot;#root&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="dva-loading"><a href="#dva-loading" class="headerlink" title="dva-loading"></a>dva-loading</h4><p>该插件会在仓库中加入一个状态，名称为loading，它是一个对象，其中有以下属性</p>
<ul>
<li>global：全局是否正在处理副作用（加载），只要有任何一个模型在处理副作用，则该属性为true</li>
<li>models：一个对象，对象中的属性名以及属性的值，表示哪个对应的模型是否在处理副作用中（加载中）</li>
<li>effects：一个对象，对象中的属性名以及属性的值，表示是哪个action触发了副作用</li>
</ul>
<h2 id="七、umi"><a href="#七、umi" class="headerlink" title="七、umi"></a>七、umi</h2><h3 id="1-umi简介"><a href="#1-umi简介" class="headerlink" title="1.umi简介"></a>1.umi简介</h3><blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://umijs.org/">https://umijs.org/</a></p>
</blockquote>
<ul>
<li>插件化</li>
<li>开箱即用</li>
<li>约定式路由</li>
</ul>
<h4 id="全局安装umi"><a href="#全局安装umi" class="headerlink" title="全局安装umi"></a>全局安装umi</h4><p>提供了一个命令行工具：umi，通过该命令可以对umi工程进行操作</p>
<blockquote>
<p>umi还可以使用对应的脚手架</p>
</blockquote>
<ul>
<li>umi dev: 使用开发模式启动工程</li>
<li>umi build: 打包</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">拾贰</div><div class="post-copyright__author_desc">得失从缘,心无增减</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/12/17/React/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/12/17/React/')">React</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://s2.loli.net/2023/09/01/q6Stn5jbXVzxHmC.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/09/01/q6Stn5jbXVzxHmC.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2023/09/01/Qa1oSxc3nlEeGOt.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/09/01/Qa1oSxc3nlEeGOt.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/12/17/React/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=React&amp;url=http://example.com/2024/12/17/React/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">拾贰</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/React/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>React<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/12/16/%E6%96%B0React/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">新React</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2024/12/16/%E6%96%B0React/" title="新React"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-12-16</div><div class="title">新React</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2023/09/01/NzaWb31teHk5UuX.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/zhheo/Sticker-Heo@latest/Sticker-100/滑稽被子.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">拾贰进行项目开发</b>相关的问题和看法，还有<b style="color:#fff">一些其他的知识</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">拾贰</h1><div class="author-info__desc">得失从缘,心无增减</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/tentwo24" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/2104980654" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5"><span class="toc-number">1.</span> <span class="toc-text">起步</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81React%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">一、React概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFReact%EF%BC%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.什么是React？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-React%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.React的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AF%B9%E6%AF%94Vue"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.对比Vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.学习路径</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Hello-World"><span class="toc-number">1.2.</span> <span class="toc-text">二、Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-React-createElement"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.React.createElement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-JSX"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.JSX</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6%E6%90%AD%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">三、使用脚手架搭建工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.4.</span> <span class="toc-text">四、开发环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-VSCode%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.VSCode配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-VSCode%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.2.</span> <span class="toc-text">2.VSCode插件安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Chrome%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.3.</span> <span class="toc-text">3.Chrome插件安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">React核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81JSX"><span class="toc-number">2.1.</span> <span class="toc-text">一、JSX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFJSX"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.什么是JSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8JSX%E4%B8%AD%E5%B5%8C%E5%85%A5%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.在JSX中嵌入表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%83%E7%B4%A0%E7%9A%84%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7"><span class="toc-number">2.1.3.</span> <span class="toc-text">3.元素的不可变性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-demo%E5%9B%BE%E7%89%87%E5%88%87%E6%8D%A2"><span class="toc-number">2.1.4.</span> <span class="toc-text">4.demo图片切换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%84%E4%BB%B6%E5%92%8C%E7%BB%84%E4%BB%B6%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.</span> <span class="toc-text">二、组件和组件属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.创建一个组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.组件的属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81"><span class="toc-number">2.3.</span> <span class="toc-text">三、组件状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">四、事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%B7%B1%E5%85%A5%E8%AE%A4%E8%AF%86setState"><span class="toc-number">2.5.</span> <span class="toc-text">五、深入认识setState</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.6.</span> <span class="toc-text">六、生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A7%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.6.1.</span> <span class="toc-text">1.旧版生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%B0%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">2.6.2.</span> <span class="toc-text">2.新版生命周期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BC%A0%E9%80%92%E5%85%83%E7%B4%A0%E5%86%85%E5%AE%B9%EF%BC%88vue%E4%B8%AD%E6%8F%92%E6%A7%BD%EF%BC%89"><span class="toc-number">2.7.</span> <span class="toc-text">七、传递元素内容（vue中插槽）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E8%A1%A8%E5%8D%95"><span class="toc-number">2.8.</span> <span class="toc-text">八、表单</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#React%E8%BF%9B%E9%98%B6"><span class="toc-number">3.</span> <span class="toc-text">React进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%B1%9E%E6%80%A7%E9%BB%98%E8%AE%A4%E5%80%BC%E5%92%8C%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="toc-number">3.1.</span> <span class="toc-text">一、属性默认值和类型检查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%B1%9E%E6%80%A7%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.属性默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B1%9E%E6%80%A7%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.属性类型检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Demo"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.Demo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81HOC-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">二、HOC 高阶组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81ref"><span class="toc-number">3.3.</span> <span class="toc-text">三、ref</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Ref%E8%BD%AC%E5%8F%91"><span class="toc-number">3.4.</span> <span class="toc-text">四、Ref转发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Context"><span class="toc-number">3.5.</span> <span class="toc-text">五、Context</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A7%E7%9A%84API"><span class="toc-number">3.5.1.</span> <span class="toc-text">1.旧的API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%B0%E7%89%88API"><span class="toc-number">3.5.2.</span> <span class="toc-text">2.新版API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.上下文应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81PureComponent"><span class="toc-number">3.6.</span> <span class="toc-text">六、PureComponent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81render-props"><span class="toc-number">3.7.</span> <span class="toc-text">七、render props</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Portals"><span class="toc-number">3.8.</span> <span class="toc-text">八、Portals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C"><span class="toc-number">3.9.</span> <span class="toc-text">九、错误边界</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81React%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6"><span class="toc-number">3.10.</span> <span class="toc-text">十、React中的事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%E2%96%B2"><span class="toc-number">3.11.</span> <span class="toc-text">十一、渲染原理▲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A6%96%E6%AC%A1%E6%B8%B2%E6%9F%93-%E6%96%B0%E8%8A%82%E7%82%B9%E6%B8%B2%E6%9F%93"><span class="toc-number">3.11.1.</span> <span class="toc-text">1.首次渲染(新节点渲染)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9B%B4%E6%96%B0%E8%8A%82%E7%82%B9"><span class="toc-number">3.11.2.</span> <span class="toc-text">2.更新节点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E6%9B%B4%E6%96%B0"><span class="toc-number">3.11.2.1.</span> <span class="toc-text">对比更新</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%BE%E5%88%B0%E4%BA%86%E5%AF%B9%E6%AF%94%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="toc-number">3.11.2.1.1.</span> <span class="toc-text">找到了对比的目标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E6%89%BE%E5%88%B0%E5%AF%B9%E6%AF%94%E7%9A%84%E7%9B%AE%E6%A0%87"><span class="toc-number">3.11.2.1.2.</span> <span class="toc-text">没有找到对比的目标</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%B7%A5%E5%85%B7"><span class="toc-number">3.12.</span> <span class="toc-text">十二、工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.12.1.</span> <span class="toc-text">1.严格模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Profiler"><span class="toc-number">3.12.2.</span> <span class="toc-text">2.Profiler</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HOOK"><span class="toc-number">4.</span> <span class="toc-text">HOOK</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81HOOK%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">一、HOOK简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81State-Hook"><span class="toc-number">4.2.</span> <span class="toc-text">二、State Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Effect-Hook"><span class="toc-number">4.3.</span> <span class="toc-text">三、Effect Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89Hook"><span class="toc-number">4.4.</span> <span class="toc-text">四、自定义Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Reducer-Hook"><span class="toc-number">4.5.</span> <span class="toc-text">五、Reducer Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Context-Hook"><span class="toc-number">4.6.</span> <span class="toc-text">六、Context Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Callback-Hook"><span class="toc-number">4.7.</span> <span class="toc-text">七、Callback Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Memo-Hook"><span class="toc-number">4.8.</span> <span class="toc-text">八、Memo Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Ref-Hook"><span class="toc-number">4.9.</span> <span class="toc-text">九、Ref Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81ImperativeHandle-Hook"><span class="toc-number">4.10.</span> <span class="toc-text">十、ImperativeHandle Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81LayoutEffect-Hook"><span class="toc-number">4.11.</span> <span class="toc-text">十一、LayoutEffect Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81DebugValue-Hook"><span class="toc-number">4.12.</span> <span class="toc-text">十二、DebugValue Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81React%E5%8A%A8%E7%94%BB"><span class="toc-number">4.13.</span> <span class="toc-text">十三、React动画</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Router"><span class="toc-number">5.</span> <span class="toc-text">Router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">一、概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AB%99%E7%82%B9"><span class="toc-number">5.1.1.</span> <span class="toc-text">1.站点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-React-Router"><span class="toc-number">5.1.2.</span> <span class="toc-text">2.React Router</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">二、两种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Hash-Router-%E5%93%88%E5%B8%8C%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.1.</span> <span class="toc-text">1.Hash Router 哈希路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Borswer-History-Router-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E8%B7%AF%E7%94%B1"><span class="toc-number">5.2.2.</span> <span class="toc-text">2.Borswer History Router 浏览器历史记录路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6"><span class="toc-number">5.3.</span> <span class="toc-text">三、路由组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Router%E7%BB%84%E4%BB%B6"><span class="toc-number">5.3.1.</span> <span class="toc-text">1.Router组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Route%E7%BB%84%E4%BB%B6"><span class="toc-number">5.3.2.</span> <span class="toc-text">2.Route组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Switch%E7%BB%84%E4%BB%B6"><span class="toc-number">5.3.3.</span> <span class="toc-text">3.Switch组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="toc-number">5.4.</span> <span class="toc-text">四、路由信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-history"><span class="toc-number">5.4.1.</span> <span class="toc-text">1.history</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-location"><span class="toc-number">5.4.2.</span> <span class="toc-text">2.location</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-match"><span class="toc-number">5.4.3.</span> <span class="toc-text">3.match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%9D%9E%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E8%8E%B7%E5%8F%96%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="toc-number">5.4.4.</span> <span class="toc-text">4.非路由组件获取路由信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%85%B6%E4%BB%96%E7%BB%84%E4%BB%B6"><span class="toc-number">5.5.</span> <span class="toc-text">五、其他组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Link"><span class="toc-number">5.5.1.</span> <span class="toc-text">1.Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NavLink"><span class="toc-number">5.5.2.</span> <span class="toc-text">2.NavLink</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Redirect"><span class="toc-number">5.5.3.</span> <span class="toc-text">3.Redirect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8"><span class="toc-number">5.6.</span> <span class="toc-text">六、常见应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.7.</span> <span class="toc-text">七、受保护的页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AE%9E%E7%8E%B0vue%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.8.</span> <span class="toc-text">八、实现vue路由模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB"><span class="toc-number">5.9.</span> <span class="toc-text">九、导航守卫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8-%E8%B7%AF%E7%94%B1%E5%88%87%E6%8D%A2%E5%8A%A8%E7%94%BB"><span class="toc-number">5.10.</span> <span class="toc-text">十、常见应用 - 路由切换动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E6%BB%9A%E5%8A%A8%E6%9D%A1%E5%A4%8D%E4%BD%8D"><span class="toc-number">5.11.</span> <span class="toc-text">十一、滚动条复位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">5.11.1.</span> <span class="toc-text">1.高阶组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8useEffect"><span class="toc-number">5.11.2.</span> <span class="toc-text">2.使用useEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB"><span class="toc-number">5.11.3.</span> <span class="toc-text">3.使用自定义的导航守卫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E9%98%BB%E6%AD%A2%E8%B7%B3%E8%BD%AC"><span class="toc-number">5.12.</span> <span class="toc-text">十二、阻止跳转</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Router%E6%BA%90%E7%A0%81"><span class="toc-number">6.</span> <span class="toc-text">Router源码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redux"><span class="toc-number">7.</span> <span class="toc-text">Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Redux%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">7.1.</span> <span class="toc-text">一、Redux核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MVC"><span class="toc-number">7.1.1.</span> <span class="toc-text">1.MVC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%89%8D%E7%AB%AF%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">7.1.2.</span> <span class="toc-text">2.前端需要一个独立的数据解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8Redux%E7%AE%A1%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-number">7.2.</span> <span class="toc-text">二、使用Redux管理数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Action"><span class="toc-number">7.3.</span> <span class="toc-text">三、Action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Reducer"><span class="toc-number">7.4.</span> <span class="toc-text">四、Reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Store"><span class="toc-number">7.5.</span> <span class="toc-text">五、Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%89%8B%E5%86%99createStores"><span class="toc-number">7.6.</span> <span class="toc-text">六、手写createStores</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%89%8B%E5%86%99bindActionCreators"><span class="toc-number">7.7.</span> <span class="toc-text">七、手写bindActionCreators</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%89%8B%E5%86%99combineReducers"><span class="toc-number">7.8.</span> <span class="toc-text">八、手写combineReducers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Redux%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%88Middleware%EF%BC%89"><span class="toc-number">7.9.</span> <span class="toc-text">九、Redux中间件（Middleware）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%89%8B%E5%86%99applyMiddleware"><span class="toc-number">7.10.</span> <span class="toc-text">十、手写applyMiddleware</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redux%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">Redux中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81redux-logger"><span class="toc-number">8.1.</span> <span class="toc-text">一、redux-logger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81redux-thunk"><span class="toc-number">8.2.</span> <span class="toc-text">二、redux-thunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%89%8B%E5%86%99thunk"><span class="toc-number">8.3.</span> <span class="toc-text">三、手写thunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81redux-promise"><span class="toc-number">8.4.</span> <span class="toc-text">四、redux-promise</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%8D%8F%E8%AE%AE"><span class="toc-number">8.5.</span> <span class="toc-text">五、迭代器和可迭代协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BF%AD%E4%BB%A3"><span class="toc-number">8.5.1.</span> <span class="toc-text">1.迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BF%AD%E4%BB%A3%E5%99%A8-iterator"><span class="toc-number">8.5.2.</span> <span class="toc-text">2.迭代器 iterator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0-iterator-creator"><span class="toc-number">8.5.2.1.</span> <span class="toc-text">迭代器创建函数 iterator creator</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%8D%8F%E8%AE%AE"><span class="toc-number">8.5.3.</span> <span class="toc-text">3.可迭代协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-for-of%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">8.5.4.</span> <span class="toc-text">4.for-of循环的原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E7%94%9F%E6%88%90%E5%99%A8-generator"><span class="toc-number">8.6.</span> <span class="toc-text">六、生成器 generator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-generator"><span class="toc-number">8.6.1.</span> <span class="toc-text">1.generator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-generator-function"><span class="toc-number">8.6.2.</span> <span class="toc-text">2.generator function</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81redux-saga"><span class="toc-number">8.7.</span> <span class="toc-text">七、redux-saga</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-saga%E5%9F%BA%E7%A1%80"><span class="toc-number">8.7.1.</span> <span class="toc-text">1.saga基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-saga%E6%8C%87%E4%BB%A41"><span class="toc-number">8.7.2.</span> <span class="toc-text">2.saga指令1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-saga%E6%8C%87%E4%BB%A42"><span class="toc-number">8.7.3.</span> <span class="toc-text">3.saga指令2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%89%8B%E5%86%99saga"><span class="toc-number">8.8.</span> <span class="toc-text">八、手写saga</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81redux-actions"><span class="toc-number">8.9.</span> <span class="toc-text">九、redux-actions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-createAction-s"><span class="toc-number">8.9.1.</span> <span class="toc-text">1.createAction(s)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#createAction"><span class="toc-number">8.9.1.1.</span> <span class="toc-text">createAction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createActions"><span class="toc-number">8.9.1.2.</span> <span class="toc-text">createActions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-handleAction-s"><span class="toc-number">8.9.2.</span> <span class="toc-text">2.handleAction(s)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#handleAction"><span class="toc-number">8.9.2.1.</span> <span class="toc-text">handleAction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#handleActions"><span class="toc-number">8.9.2.2.</span> <span class="toc-text">handleActions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-combineActions"><span class="toc-number">8.9.3.</span> <span class="toc-text">3.combineActions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E3%80%81%E8%B7%AF%E7%94%B1%E5%92%8C%E6%95%B0%E6%8D%AE"><span class="toc-number">9.</span> <span class="toc-text">组件、路由和数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81react-redux"><span class="toc-number">9.1.</span> <span class="toc-text">一、react-redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%89%8B%E5%86%99react-redux"><span class="toc-number">9.2.</span> <span class="toc-text">二、手写react-redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81react-redux%E9%A2%9D%E5%A4%96%E7%9A%84api"><span class="toc-number">9.3.</span> <span class="toc-text">三、react-redux额外的api</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-connect"><span class="toc-number">9.3.1.</span> <span class="toc-text">1.connect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-connectAdvanced"><span class="toc-number">9.3.2.</span> <span class="toc-text">2.connectAdvanced</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-createProvider"><span class="toc-number">9.3.3.</span> <span class="toc-text">3.createProvider</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81redux%E5%92%8Crouter%E7%9A%84%E7%BB%93%E5%90%88%EF%BC%88connected-react-router%EF%BC%89"><span class="toc-number">9.4.</span> <span class="toc-text">四、redux和router的结合（connected-react-router）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-connectRouter"><span class="toc-number">9.4.1.</span> <span class="toc-text">1.connectRouter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-routerMiddleware"><span class="toc-number">9.4.2.</span> <span class="toc-text">2.routerMiddleware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-ConnectedRouter"><span class="toc-number">9.4.3.</span> <span class="toc-text">3.ConnectedRouter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%80%E4%BA%9Baction%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">9.4.4.</span> <span class="toc-text">4.一些action创建函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%89%8B%E5%86%99connected-react-router"><span class="toc-number">9.5.</span> <span class="toc-text">五、手写connected-react-router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81dva"><span class="toc-number">9.6.</span> <span class="toc-text">六、dva</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-dva%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.6.1.</span> <span class="toc-text">1.dva的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%89%8B%E5%86%99dva"><span class="toc-number">9.6.2.</span> <span class="toc-text">2.手写dva</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-dva%E6%8F%92%E4%BB%B6"><span class="toc-number">9.6.3.</span> <span class="toc-text">3.dva插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dva-loading"><span class="toc-number">9.6.3.1.</span> <span class="toc-text">dva-loading</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81umi"><span class="toc-number">9.7.</span> <span class="toc-text">七、umi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-umi%E7%AE%80%E4%BB%8B"><span class="toc-number">9.7.1.</span> <span class="toc-text">1.umi简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85umi"><span class="toc-number">9.7.1.1.</span> <span class="toc-text">全局安装umi</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/17/React/" title="React">React</a><time datetime="2024-12-17T03:10:03.971Z" title="发表于 2024-12-17 11:10:03">2024-12-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/16/%E6%96%B0React/" title="新React">新React</a><time datetime="2024-12-16T06:27:55.246Z" title="发表于 2024-12-16 14:27:55">2024-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/04/TypeScript%E5%9F%BA%E7%A1%80/" title="TypeScript基础">TypeScript基础</a><time datetime="2024-12-04T09:17:42.905Z" title="发表于 2024-12-04 17:17:42">2024-12-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/27/Vue3/" title="Vue3入门+就业">Vue3入门+就业</a><time datetime="2024-11-27T05:23:16.877Z" title="发表于 2024-11-27 13:23:16">2024-11-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/18/Vue%E9%A1%B9%E7%9B%AE%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86/" title="个人博客后台">个人博客后台</a><time datetime="2024-11-18T06:37:03.534Z" title="发表于 2024-11-18 14:37:03">2024-11-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="拾贰" target="_blank">拾贰</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/HTML-CSS/" style="font-size: 0.88rem;">HTML+CSS<sup>4</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>4</sup></a><a href="/tags/React/" style="font-size: 0.88rem;">React<sup>2</sup></a><a href="/tags/TypeScript/" style="font-size: 0.88rem;">TypeScript<sup>1</sup></a><a href="/tags/Uniapp/" style="font-size: 0.88rem;">Uniapp<sup>2</sup></a><a href="/tags/Vue/" style="font-size: 0.88rem;">Vue<sup>2</sup></a><a href="/tags/Vue2/" style="font-size: 0.88rem;">Vue2<sup>2</sup></a><a href="/tags/Vue3/" style="font-size: 0.88rem;">Vue3<sup>1</sup></a><a href="/tags/Webpack/" style="font-size: 0.88rem;">Webpack<sup>2</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7%E5%BA%93/" style="font-size: 0.88rem;">工具库<sup>1</sup></a><a href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 0.88rem;">工程化<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 拾贰 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>